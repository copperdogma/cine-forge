{
  "evalId": "eval-FSn-2026-03-02T04:17:41",
  "results": {
    "version": 3,
    "timestamp": "2026-03-02T04:17:41.974Z",
    "prompts": [
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "GPT-4.1 Nano",
        "metrics": {
          "score": 1.5514000000000001,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 15238,
          "tokenUsage": {
            "prompt": 1815,
            "completion": 1893,
            "cached": 0,
            "total": 3708,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 3411,
              "prompt": 2284,
              "completion": 1127,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.0009387000000000001
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "GPT-4.1 Mini",
        "metrics": {
          "score": 1.8216,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 37270,
          "tokenUsage": {
            "prompt": 1815,
            "completion": 2557,
            "cached": 0,
            "total": 4372,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 3575,
              "prompt": 2648,
              "completion": 927,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.004817200000000001
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "Gemini 2.5 Flash Lite",
        "metrics": {
          "score": 1.86435,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 7986,
          "tokenUsage": {
            "prompt": 1966,
            "completion": 3223,
            "cached": 0,
            "total": 5189,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 5112,
              "prompt": 4158,
              "completion": 954,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.0014858000000000002
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "GPT-4.1",
        "metrics": {
          "score": 1.9181499999999998,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 40044,
          "tokenUsage": {
            "prompt": 1815,
            "completion": 3934,
            "cached": 0,
            "total": 5749,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 4683,
              "prompt": 3811,
              "completion": 872,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.035102
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "Claude Haiku 4.5",
        "metrics": {
          "score": 1.76935,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 17685,
          "tokenUsage": {
            "prompt": 1923,
            "completion": 3434,
            "cached": 0,
            "total": 5357,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 5467,
              "prompt": 4349,
              "completion": 1118,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.019093
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "Claude Sonnet 4.5",
        "metrics": {
          "score": 1.86435,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 33091,
          "tokenUsage": {
            "prompt": 1923,
            "completion": 3000,
            "cached": 0,
            "total": 4923,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 4908,
              "prompt": 3915,
              "completion": 993,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.050769
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "Claude Sonnet 4.6",
        "metrics": {
          "score": 1.9649,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 63671,
          "tokenUsage": {
            "prompt": 1923,
            "completion": 5199,
            "cached": 0,
            "total": 7122,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 7188,
              "prompt": 6114,
              "completion": 1074,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "Gemini 2.5 Flash",
        "metrics": {
          "score": 1.8441,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 25664,
          "tokenUsage": {
            "prompt": 1966,
            "completion": 2978,
            "cached": 0,
            "total": 8362,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 3418,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 4924,
              "prompt": 3909,
              "completion": 1015,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.0165798
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "Gemini 3 Flash",
        "metrics": {
          "score": 1.8166,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 34054,
          "tokenUsage": {
            "prompt": 1966,
            "completion": 3298,
            "cached": 0,
            "total": 8326,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 3062,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 5373,
              "prompt": 4243,
              "completion": 1130,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.020062999999999998
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "GPT-5.2",
        "metrics": {
          "score": 1.9034499999999999,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 30972,
          "tokenUsage": {
            "prompt": 1813,
            "completion": 3302,
            "cached": 0,
            "total": 5115,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 4249,
              "prompt": 3324,
              "completion": 925,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.04940074999999999
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "Claude Opus 4.6",
        "metrics": {
          "score": 1.89845,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 46241,
          "tokenUsage": {
            "prompt": 1923,
            "completion": 4051,
            "cached": 0,
            "total": 5974,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 5916,
              "prompt": 4966,
              "completion": 950,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.11089000000000002
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "Gemini 2.5 Pro",
        "metrics": {
          "score": 1.8539,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 74693,
          "tokenUsage": {
            "prompt": 1966,
            "completion": 3802,
            "cached": 0,
            "total": 12064,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 6296,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 5843,
              "prompt": 4752,
              "completion": 1091,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.10343750000000002
        }
      },
      {
        "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
        "id": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "provider": "Gemini 3 Pro",
        "metrics": {
          "score": 1.7866,
          "testPassCount": 2,
          "testFailCount": 0,
          "testErrorCount": 0,
          "assertPassCount": 4,
          "assertFailCount": 0,
          "totalLatencyMs": 74600,
          "tokenUsage": {
            "prompt": 1966,
            "completion": 2547,
            "cached": 0,
            "total": 8147,
            "numRequests": 2,
            "completionDetails": {
              "reasoning": 3634,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            },
            "assertions": {
              "total": 4529,
              "prompt": 3492,
              "completion": 1037,
              "cached": 0,
              "numRequests": 0,
              "completionDetails": {
                "reasoning": 0,
                "acceptedPrediction": 0,
                "rejectedPrediction": 0
              }
            }
          },
          "namedScores": {},
          "namedScoresCount": {},
          "cost": 0.078104
        }
      }
    ],
    "results": [
      {
        "cost": 0.0006705000000000001,
        "gradingResult": {
          "pass": true,
          "score": 0.95155,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2338,
            "prompt": 1851,
            "completion": 487,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9831,
              "reason": "change_detection=1.00 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=0.90 | property_extraction=0.97 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.92,
              "reason": "The output performs very well across all 7 criteria:\n\n1. **All 5 entities identified**: Yes — character:billy, character:jane, location:harbor_dock, prop:oar, prop:envelope are all present.\n\n2. **Billy's costume as leather jacket**: Yes — explicitly captured with confidence 1.0.\n\n3. **Billy's costume CHANGE from flannel shirt to leather jacket**: Yes — a change_event is recorded with previous_value 'faded flannel shirt and worn jeans' and new_value 'leather jacket zipped', with supporting evidence quote from the scene text.\n\n4. **Jane's rain jacket and sealed envelope**: Yes — Jane's costume is listed as 'rain jacket' and the envelope is captured as 'sealed ENVELOPE' both as Jane's property and as a separate prop entity.\n\n5. **Billy's flat/resigned emotional state**: Yes — captured as 'flat, possibly resigned' with a change_event from 'tense, jaw tight' to the new state, supported by dialogue evidence.\n\n6. **Change events supported by scene text quotes**: Yes — all change_events include evidence fields with actual quoted text from the scene (e.g., 'BILLY walks along the dock, leather jacket zipped against the wind.', the OAR description, Billy's dialogue).\n\n7. **Confidence scores reasonable**: Yes — explicit text descriptions get high confidence (0.95-1.0), while inferred states like emotional_state get lower confidence (0.7), and atmosphere gets 0.6. This is appropriate calibration.\n\nThe extraction is thorough, capturing not just current states but state transitions with evidence. The oar's position change (from Billy's hand to against a piling) is a nice detail. The envelope's change_events showing previous_value as null (new introduction) is correct. Minor quibble: the oar's position change could have been split into two discrete events rather than one compound value, but this is a minor structural choice. Overall, this is high-quality continuity extraction.",
              "tokensUsed": {
                "total": 2338,
                "prompt": 1851,
                "completion": 487,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_002\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket zipped\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"flat, possibly resigned\\\",\\n          \\\"confidence\\\": 0.7\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"OAR (in right hand, then set against piling)\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"faded flannel shirt and worn jeans\\\",\\n          \\\"new_value\\\": \\\"leather jacket zipped\\\",\\n          \\\"reason\\\": \\\"Costume change between scenes\\\",\\n          \\\"evidence\\\": \\\"BILLY walks along the dock, leather jacket zipped against the wind.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"tense, jaw tight\\\",\\n          \\\"new_value\\\": \\\"flat, possibly resigned\\\",\\n          \\\"reason\\\": \\\"Dialogue and implied demeanor\\\",\\n          \\\"evidence\\\": \\\"BILLY\\\\n(flat)\\\\nI'm always late.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.7\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"OAR (in right hand, then set against piling)\\\",\\n          \\\"reason\\\": \\\"Billy picks up the oar\\\",\\n          \\\"evidence\\\": \\\"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick. He sets the OAR against a piling\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.9\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"character:jane\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"age\\\",\\n          \\\"value\\\": \\\"30s\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"rain jacket\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_characteristics\\\",\\n          \\\"value\\\": \\\"sharp eyes\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"sealed ENVELOPE\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"DAY\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"windy\\\",\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"functional, potentially tense\\\",\\n          \\\"confidence\\\": 0.6\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.8\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"weathered oak with a rope-wrapped grip\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"his father's\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"initially in Billy's right hand, then set against a piling\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"initially in Billy's right hand, then set against a piling\\\",\\n          \\\"reason\\\": \\\"Billy moves the oar\\\",\\n          \\\"evidence\\\": \\\"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick. He sets the OAR against a piling\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"sealed\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Jane\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"held by Jane\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"ownership\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Jane\\\",\\n          \\\"reason\\\": \\\"Jane is holding the envelope\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"held by Jane\\\",\\n          \\\"reason\\\": \\\"Jane is holding the envelope\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "af1a2489-485b-47c8-92e9-bb2a0d27a748",
        "latencyMs": 3366,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 2,
        "provider": {
          "id": "google:gemini-2.5-flash-lite",
          "label": "Gemini 2.5 Flash Lite"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat, possibly resigned\",\n          \"confidence\": 0.7\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"OAR (in right hand, then set against piling)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped\",\n          \"reason\": \"Costume change between scenes\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat, possibly resigned\",\n          \"reason\": \"Dialogue and implied demeanor\",\n          \"evidence\": \"BILLY\\n(flat)\\nI'm always late.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.7\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"OAR (in right hand, then set against piling)\",\n          \"reason\": \"Billy picks up the oar\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick. He sets the OAR against a piling\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"age\",\n          \"value\": \"30s\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_characteristics\",\n          \"value\": \"sharp eyes\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed ENVELOPE\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"DAY\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"functional, potentially tense\",\n          \"confidence\": 0.6\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.8\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak with a rope-wrapped grip\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"his father's\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"initially in Billy's right hand, then set against a piling\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"initially in Billy's right hand, then set against a piling\",\n          \"reason\": \"Billy moves the oar\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick. He sets the OAR against a piling\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": null,\n          \"new_value\": \"Jane\",\n          \"reason\": \"Jane is holding the envelope\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"held by Jane\",\n          \"reason\": \"Jane is holding the envelope\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "prompt": 1005,
            "completion": 1425,
            "total": 2430,
            "numRequests": 1
          },
          "cost": 0.0006705000000000001,
          "raw": {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat, possibly resigned\",\n          \"confidence\": 0.7\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"OAR (in right hand, then set against piling)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped\",\n          \"reason\": \"Costume change between scenes\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat, possibly resigned\",\n          \"reason\": \"Dialogue and implied demeanor\",\n          \"evidence\": \"BILLY\\n(flat)\\nI'm always late.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.7\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"OAR (in right hand, then set against piling)\",\n          \"reason\": \"Billy picks up the oar\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick. He sets the OAR against a piling\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"age\",\n          \"value\": \"30s\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_characteristics\",\n          \"value\": \"sharp eyes\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed ENVELOPE\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"DAY\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"functional, potentially tense\",\n          \"confidence\": 0.6\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.8\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak with a rope-wrapped grip\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"his father's\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"initially in Billy's right hand, then set against a piling\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"initially in Billy's right hand, then set against a piling\",\n          \"reason\": \"Billy moves the oar\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick. He sets the OAR against a piling\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": null,\n          \"new_value\": \"Jane\",\n          \"reason\": \"Jane is holding the envelope\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"held by Jane\",\n          \"reason\": \"Jane is holding the envelope\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    }\n  ]\n}\n```"
                    }
                  ],
                  "role": "model"
                },
                "finishReason": "STOP",
                "index": 0
              }
            ],
            "usageMetadata": {
              "promptTokenCount": 1005,
              "candidatesTokenCount": 1425,
              "totalTokenCount": 2430,
              "promptTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 1005
                }
              ]
            },
            "modelVersion": "gemini-2.5-flash-lite",
            "responseId": "aQ-ladCOGejmqtsPrN3u2AI"
          },
          "cached": false,
          "metadata": {}
        },
        "score": 0.95155,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0003482,
        "gradingResult": {
          "pass": true,
          "score": 0.7521,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 1325,
            "prompt": 859,
            "completion": 466,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.7842,
              "reason": "change_detection=0.50 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=0.70 | json_valid=1.00 | property_extraction=0.82 | Missing required prop: character:billy.emotional_state | Missed change: character:billy.emotional_state",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.72,
              "reason": "Evaluating against the 7 criteria:\n\n1. **All 5 entities identified**: Yes — Billy, Jane, harbor_dock, oar, envelope are all present. ✅\n2. **Billy's costume as leather jacket**: Yes — correctly extracted as 'leather jacket zipped against the wind'. ✅\n3. **Billy's costume CHANGE detected**: Yes — change_event correctly shows previous_value 'faded flannel shirt and worn jeans' → new_value 'leather jacket zipped against the wind', with is_explicit: true. ✅\n4. **Jane's rain jacket and sealed envelope**: Yes — Jane's costume is 'rain jacket', envelope condition is 'sealed'. ✅\n5. **Billy's flat/resigned emotional state**: No — this is missing entirely. There is no 'emotional_state' or 'tone' property for Billy. This is a notable omission for continuity tracking. ❌\n6. **Change events supported by text quotes**: Yes — the evidence field contains 'BILLY walks along the dock, leather jacket zipped against the wind.' which appears to be a scene text quote. ✅\n7. **Confidence scores reasonable**: Generally yes — explicit text items get 0.9-0.95, inferred items like weather ('windy') get 0.8. The overall entity confidences are reasonable. ✅\n\nAdditional notes:\n- The oar's ownership is listed as 'Billy (implied, as he is holding it)' but the scene says it's 'his father's' oar — this is a minor miss on the ownership/provenance detail.\n- Missing Billy's emotional state (flat/resigned) is a significant gap for continuity tracking purposes.\n\nOverall: 5.5 out of 7 critical criteria met. The extraction is solid on physical state tracking and change detection but misses the emotional state entirely and slightly misses oar provenance.",
              "tokensUsed": {
                "total": 1325,
                "prompt": 859,
                "completion": 466,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n{\\\"scene_id\\\":\\\"scene_002\\\",\\\"entity_states\\\":[{\\\"entity_key\\\":\\\"character:billy\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"leather jacket zipped against the wind\\\",\\\"confidence\\\":0.95}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"costume\\\",\\\"previous_value\\\":\\\"faded flannel shirt and worn jeans\\\",\\\"new_value\\\":\\\"leather jacket zipped against the wind\\\",\\\"reason\\\":\\\"Scene shows Billy wearing a zipped leather jacket, indicating a change from previous costume.\\\",\\\"evidence\\\":\\\"BILLY walks along the dock, leather jacket zipped against the wind.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9}],\\\"confidence\\\":0.85},{\\\"entity_key\\\":\\\"character:jane\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"rain jacket\\\",\\\"confidence\\\":0.95}],\\\"change_events\\\":[],\\\"confidence\\\":0.9},{\\\"entity_key\\\":\\\"location:harbor_dock\\\",\\\"properties\\\":[{\\\"key\\\":\\\"lighting\\\",\\\"value\\\":\\\"day\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"time_of_day\\\",\\\"value\\\":\\\"day\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"weather\\\",\\\"value\\\":\\\"windy\\\",\\\"confidence\\\":0.8}],\\\"change_events\\\":[],\\\"confidence\\\":0.85},{\\\"entity_key\\\":\\\"prop:oar\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"weathered oak with a rope-wrapped grip\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"resting in Billy's right hand\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"Billy (implied, as he is holding it)\\\",\\\"confidence\\\":0.9}],\\\"change_events\\\":[],\\\"confidence\\\":0.9},{\\\"entity_key\\\":\\\"prop:envelope\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"sealed\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"held by Jane\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"Jane\\\",\\\"confidence\\\":0.9}],\\\"change_events\\\":[],\\\"confidence\\\":0.9}]}\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "90b3ad3a-5fff-4c18-a0f6-cef33df65869",
        "latencyMs": 5103,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 0,
        "provider": {
          "id": "openai:gpt-4.1-nano",
          "label": "GPT-4.1 Nano"
        },
        "response": {
          "output": "{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped against the wind\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped against the wind\",\n          \"reason\": \"Scene shows Billy wearing a zipped leather jacket, indicating a change from previous costume.\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"day\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"day\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.85\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak with a rope-wrapped grip\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"resting in Billy's right hand\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy (implied, as he is holding it)\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.9\n    }\n  ]\n}",
          "tokenUsage": {
            "total": 1559,
            "prompt": 918,
            "completion": 641,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cached": false,
          "latencyMs": 5103,
          "finishReason": "stop",
          "cost": 0.0003482,
          "guardrails": {
            "flagged": false
          },
          "metadata": {
            "http": {
              "status": 200,
              "statusText": "OK",
              "headers": {
                "access-control-expose-headers": "X-Request-ID",
                "alt-svc": "h3=\":443\"; ma=86400",
                "cf-cache-status": "DYNAMIC",
                "cf-ray": "9d5d97dee83f0b4b-YVR",
                "connection": "keep-alive",
                "content-encoding": "br",
                "content-type": "application/json",
                "date": "Mon, 02 Mar 2026 04:17:47 GMT",
                "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
                "openai-processing-ms": "4881",
                "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
                "openai-version": "2020-10-01",
                "server": "cloudflare",
                "set-cookie": "__cf_bm=_Z6hH5RATAPg.__kPj7AcESOGewqxAP.7YQmnrwQsos-1772425062.2246265-1.0.1.1-GHHBLLjLhZpE10C8hVqyG5_5UEffIkHok2R90syo_VBlo4B37dDx884TGZK5bTDSsmpSbtgbI0uGGvJK2FyKldFyjzTBOxWqkLLBx0IJS6Tij2kcSczQ3oGYraUp_6iX; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:47:47 GMT",
                "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
                "transfer-encoding": "chunked",
                "x-content-type-options": "nosniff",
                "x-openai-proxy-wasm": "v0.1",
                "x-ratelimit-limit-requests": "10000",
                "x-ratelimit-limit-tokens": "10000000",
                "x-ratelimit-remaining-requests": "9999",
                "x-ratelimit-remaining-tokens": "9999096",
                "x-ratelimit-reset-requests": "6ms",
                "x-ratelimit-reset-tokens": "5ms",
                "x-request-id": "req_e78d1c3cf22a4c01b2619f0b86409c05"
              }
            }
          }
        },
        "score": 0.7521,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "http": {
            "status": 200,
            "statusText": "OK",
            "headers": {
              "access-control-expose-headers": "X-Request-ID",
              "alt-svc": "h3=\":443\"; ma=86400",
              "cf-cache-status": "DYNAMIC",
              "cf-ray": "9d5d97dee83f0b4b-YVR",
              "connection": "keep-alive",
              "content-encoding": "br",
              "content-type": "application/json",
              "date": "Mon, 02 Mar 2026 04:17:47 GMT",
              "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
              "openai-processing-ms": "4881",
              "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
              "openai-version": "2020-10-01",
              "server": "cloudflare",
              "set-cookie": "__cf_bm=_Z6hH5RATAPg.__kPj7AcESOGewqxAP.7YQmnrwQsos-1772425062.2246265-1.0.1.1-GHHBLLjLhZpE10C8hVqyG5_5UEffIkHok2R90syo_VBlo4B37dDx884TGZK5bTDSsmpSbtgbI0uGGvJK2FyKldFyjzTBOxWqkLLBx0IJS6Tij2kcSczQ3oGYraUp_6iX; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:47:47 GMT",
              "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
              "transfer-encoding": "chunked",
              "x-content-type-options": "nosniff",
              "x-openai-proxy-wasm": "v0.1",
              "x-ratelimit-limit-requests": "10000",
              "x-ratelimit-limit-tokens": "10000000",
              "x-ratelimit-remaining-requests": "9999",
              "x-ratelimit-remaining-tokens": "9999096",
              "x-ratelimit-reset-requests": "6ms",
              "x-ratelimit-reset-tokens": "5ms",
              "x-request-id": "req_e78d1c3cf22a4c01b2619f0b86409c05"
            }
          },
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0020424,
        "gradingResult": {
          "pass": true,
          "score": 0.9438,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 1655,
            "prompt": 1126,
            "completion": 529,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9676,
              "reason": "change_detection=1.00 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=0.90 | json_valid=1.00 | property_extraction=0.93",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.92,
              "reason": "The output successfully addresses all 7 critical evaluation criteria:\n\n1. **All 5 entities identified**: Billy (character:billy), Jane (character:jane), dock (location:harbor_dock), oar (prop:oar), envelope (prop:envelope) — all present.\n\n2. **Billy's costume correctly extracted**: 'leather jacket zipped against the wind' — correct.\n\n3. **Billy's costume CHANGE detected**: A change_event is recorded from 'faded flannel shirt and worn jeans' to 'leather jacket zipped against the wind' with explicit evidence quoting the scene text ('BILLY walks along the dock, leather jacket zipped against the wind.'). This is a key continuity tracking requirement and it's handled well.\n\n4. **Jane's rain jacket and sealed envelope noted**: Jane's costume is 'rain jacket' and she carries a 'sealed envelope' — both captured correctly.\n\n5. **Billy's flat/resigned emotional state captured**: Emotional state is 'flat' with confidence 0.9, supported by evidence quoting dialogue direction '(flat)'. The change from 'tense, jaw tight' to 'flat' is also tracked as a change event.\n\n6. **Change events supported by scene text quotes**: All three change events for Billy include 'evidence' fields with actual quoted text from the scene. The oar evidence quotes the descriptive text about the weathered oak oar. These are well-sourced.\n\n7. **Confidence scores reasonable**: Explicit text items get high confidence (0.95-1.0), while inferred items like atmosphere and damage get lower confidence (0.7-0.8). This is appropriate calibration.\n\nAdditional strengths: The oar's position change (from Billy's hand to against a piling) is tracked. The envelope's position change (held by Jane, then reached for by Billy) is noted. Ownership is tracked for props.\n\nMinor issues: Jane has no change_events listed, which is appropriate if she's new to the scene. The prop:oar could arguably have a change_event for position change (hand to piling), but it's noted in the properties. Overall this is a thorough and well-structured continuity extraction.",
              "tokensUsed": {
                "total": 1655,
                "prompt": 1126,
                "completion": 529,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n{\\\"scene_id\\\":\\\"scene_002\\\",\\\"entity_states\\\":[{\\\"entity_key\\\":\\\"character:billy\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"leather jacket zipped against the wind\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"emotional_state\\\",\\\"value\\\":\\\"flat\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"props_carried\\\",\\\"value\\\":\\\"weathered oak oar with rope-wrapped grip in right hand\\\",\\\"confidence\\\":1}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"costume\\\",\\\"previous_value\\\":\\\"faded flannel shirt and worn jeans\\\",\\\"new_value\\\":\\\"leather jacket zipped against the wind\\\",\\\"reason\\\":\\\"Billy is now wearing a leather jacket instead of previous clothing\\\",\\\"evidence\\\":\\\"BILLY walks along the dock, leather jacket zipped against the wind.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95},{\\\"property_key\\\":\\\"emotional_state\\\",\\\"previous_value\\\":\\\"tense, jaw tight\\\",\\\"new_value\\\":\\\"flat\\\",\\\"reason\\\":\\\"Billy's tone is flat in dialogue\\\",\\\"evidence\\\":\\\"BILLY\\\\n(flat)\\\\nI'm always late.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9},{\\\"property_key\\\":\\\"props_carried\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"weathered oak oar with rope-wrapped grip in right hand\\\",\\\"reason\\\":\\\"Billy is holding the oar\\\",\\\"evidence\\\":\\\"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1}],\\\"confidence\\\":0.9},{\\\"entity_key\\\":\\\"character:jane\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"rain jacket\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"physical_condition\\\",\\\"value\\\":\\\"no visible injuries\\\",\\\"confidence\\\":0.7},{\\\"key\\\":\\\"emotional_state\\\",\\\"value\\\":\\\"impatient\\\",\\\"confidence\\\":0.8},{\\\"key\\\":\\\"props_carried\\\",\\\"value\\\":\\\"sealed envelope\\\",\\\"confidence\\\":1}],\\\"change_events\\\":[],\\\"confidence\\\":0.85},{\\\"entity_key\\\":\\\"location:harbor_dock\\\",\\\"properties\\\":[{\\\"key\\\":\\\"time_of_day\\\",\\\"value\\\":\\\"day\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"lighting\\\",\\\"value\\\":\\\"daylight\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"weather\\\",\\\"value\\\":\\\"windy\\\",\\\"confidence\\\":0.8},{\\\"key\\\":\\\"damage_or_changes\\\",\\\"value\\\":\\\"none visible\\\",\\\"confidence\\\":0.7},{\\\"key\\\":\\\"atmosphere\\\",\\\"value\\\":\\\"tense, brisk\\\",\\\"confidence\\\":0.7}],\\\"change_events\\\":[],\\\"confidence\\\":0.8},{\\\"entity_key\\\":\\\"prop:oar\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"weathered oak, intact\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"in Billy's right hand, then set against a piling\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"Billy's, his father's\\\",\\\"confidence\\\":1}],\\\"change_events\\\":[],\\\"confidence\\\":0.95},{\\\"entity_key\\\":\\\"prop:envelope\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"sealed, intact\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"held by Jane, then reached for by Billy\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"Jane\\\",\\\"confidence\\\":1}],\\\"change_events\\\":[],\\\"confidence\\\":0.95}]}\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "c91616d8-c1f1-4785-b254-84fb2a01cb73",
        "latencyMs": 14479,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 1,
        "provider": {
          "id": "openai:gpt-4.1-mini",
          "label": "GPT-4.1 Mini"
        },
        "response": {
          "output": "{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped against the wind\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"weathered oak oar with rope-wrapped grip in right hand\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped against the wind\",\n          \"reason\": \"Billy is now wearing a leather jacket instead of previous clothing\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat\",\n          \"reason\": \"Billy's tone is flat in dialogue\",\n          \"evidence\": \"BILLY\\n(flat)\\nI'm always late.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"weathered oak oar with rope-wrapped grip in right hand\",\n          \"reason\": \"Billy is holding the oar\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"no visible injuries\",\n          \"confidence\": 0.7\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"impatient\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed envelope\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.85\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"day\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"lighting\",\n          \"value\": \"daylight\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"none visible\",\n          \"confidence\": 0.7\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"tense, brisk\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.8\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak, intact\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"in Billy's right hand, then set against a piling\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy's, his father's\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed, intact\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane, then reached for by Billy\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    }\n  ]\n}",
          "tokenUsage": {
            "total": 1965,
            "prompt": 918,
            "completion": 1047,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cached": false,
          "latencyMs": 14479,
          "finishReason": "stop",
          "cost": 0.0020424,
          "guardrails": {
            "flagged": false
          },
          "metadata": {
            "http": {
              "status": 200,
              "statusText": "OK",
              "headers": {
                "access-control-expose-headers": "X-Request-ID",
                "alt-svc": "h3=\":443\"; ma=86400",
                "cf-cache-status": "DYNAMIC",
                "cf-ray": "9d5d97dede5f243a-YVR",
                "connection": "keep-alive",
                "content-encoding": "br",
                "content-type": "application/json",
                "date": "Mon, 02 Mar 2026 04:17:56 GMT",
                "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
                "openai-processing-ms": "14280",
                "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
                "openai-version": "2020-10-01",
                "server": "cloudflare",
                "set-cookie": "__cf_bm=Y2BSNvkRV74XwnkOXgE8E5MizZou5upNS0Bwk_fM6Ok-1772425062.2132747-1.0.1.1-JvF9BU2WcY5ITk1obGipjflq2pNLj7ShLubnBTkSuLbDnxx3ntcyMPxVCGEn5r7c6Al.U_y.Rv6FayjjZSYRbLrNxsi4h2Vy3OCnCFdzvzfGOcOH5LJ_uLsLoXKtDAxH; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:47:56 GMT",
                "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
                "transfer-encoding": "chunked",
                "x-content-type-options": "nosniff",
                "x-openai-proxy-wasm": "v0.1",
                "x-ratelimit-limit-requests": "10000",
                "x-ratelimit-limit-tokens": "10000000",
                "x-ratelimit-remaining-requests": "9999",
                "x-ratelimit-remaining-tokens": "9999096",
                "x-ratelimit-reset-requests": "6ms",
                "x-ratelimit-reset-tokens": "5ms",
                "x-request-id": "req_7d53f8b1edda45eaba2141c52b6b17ab"
              }
            }
          }
        },
        "score": 0.9438,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "http": {
            "status": 200,
            "statusText": "OK",
            "headers": {
              "access-control-expose-headers": "X-Request-ID",
              "alt-svc": "h3=\":443\"; ma=86400",
              "cf-cache-status": "DYNAMIC",
              "cf-ray": "9d5d97dede5f243a-YVR",
              "connection": "keep-alive",
              "content-encoding": "br",
              "content-type": "application/json",
              "date": "Mon, 02 Mar 2026 04:17:56 GMT",
              "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
              "openai-processing-ms": "14280",
              "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
              "openai-version": "2020-10-01",
              "server": "cloudflare",
              "set-cookie": "__cf_bm=Y2BSNvkRV74XwnkOXgE8E5MizZou5upNS0Bwk_fM6Ok-1772425062.2132747-1.0.1.1-JvF9BU2WcY5ITk1obGipjflq2pNLj7ShLubnBTkSuLbDnxx3ntcyMPxVCGEn5r7c6Al.U_y.Rv6FayjjZSYRbLrNxsi4h2Vy3OCnCFdzvzfGOcOH5LJ_uLsLoXKtDAxH; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:47:56 GMT",
              "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
              "transfer-encoding": "chunked",
              "x-content-type-options": "nosniff",
              "x-openai-proxy-wasm": "v0.1",
              "x-ratelimit-limit-requests": "10000",
              "x-ratelimit-limit-tokens": "10000000",
              "x-ratelimit-remaining-requests": "9999",
              "x-ratelimit-remaining-tokens": "9999096",
              "x-ratelimit-reset-requests": "6ms",
              "x-ratelimit-reset-tokens": "5ms",
              "x-request-id": "req_7d53f8b1edda45eaba2141c52b6b17ab"
            }
          },
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.008623,
        "gradingResult": {
          "pass": true,
          "score": 0.8465499999999999,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2558,
            "prompt": 1950,
            "completion": 608,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.8431,
              "reason": "change_detection=0.50 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=0.90 | json_valid=0.90 | property_extraction=0.97 | JSON extracted from code block | Missed change: character:billy.emotional_state",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.85,
              "reason": "Let me evaluate against each criterion:\n\n1. **All 5 entities identified**: Yes — Billy, Jane, harbor_dock, oar, envelope are all present. ✓\n\n2. **Billy's costume as leather jacket**: Partially. The output lists Billy's costume as 'faded flannel shirt, worn jeans, leather jacket (zipped)' — it includes the leather jacket but also retains the flannel shirt and jeans from the previous scene. The rubric says Billy arrives wearing a leather jacket (changed from flannel shirt), implying the jacket replaced or covers the flannel. The output treats it as an addition rather than a replacement, which is a reasonable interpretation but slightly ambiguous. ✓ (mostly)\n\n3. **Costume CHANGE detected**: Yes — there's a change_event for costume showing previous_value as 'faded flannel shirt and worn jeans' and new_value adding the leather jacket. The output frames it as an addition rather than a replacement, but it does detect the change. ✓\n\n4. **Jane's rain jacket and sealed envelope**: Yes — Jane's costume is listed as 'rain jacket' and the envelope is noted as 'sealed'. ✓\n\n5. **Billy's flat/resigned emotional state**: Yes — listed as 'flat, resigned, detached'. ✓\n\n6. **Change events supported by actual scene text quotes**: Yes — evidence fields contain what appear to be direct quotes from the scene text (e.g., 'leather jacket zipped against the wind', 'The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick', 'He sets the OAR against a piling and reaches for the envelope'). These read like actual screenplay text. ✓\n\n7. **Confidence scores reasonable**: Yes — explicit details like props and costume get 0.9-0.95, while inferred states like emotional_state get 0.8-0.85, and atmosphere gets 0.75. This is a sensible distribution. ✓\n\nAdditional strengths: The output captures the oar's position change (from hand to piling), the envelope's movement, and provides good structural organization. The change events are well-documented with evidence.\n\nMinor weaknesses: The costume change could be more clearly framed (addition vs. replacement is slightly ambiguous), and the output could have been clearer about whether the flannel is still visible under the jacket. But overall this is a thorough and well-evidenced continuity extraction.",
              "tokensUsed": {
                "total": 2558,
                "prompt": 1950,
                "completion": 608,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_002\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"faded flannel shirt, worn jeans, leather jacket (zipped)\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"flat, resigned, detached\\\",\\n          \\\"confidence\\\": 0.85\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"no visible injuries or changes noted\\\",\\n          \\\"confidence\\\": 0.7\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"OAR (father's, weathered oak with rope-wrapped grip) — held in right hand like a walking stick\\\",\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"faded flannel shirt and worn jeans\\\",\\n          \\\"new_value\\\": \\\"faded flannel shirt, worn jeans, leather jacket (zipped against the wind)\\\",\\n          \\\"reason\\\": \\\"leather jacket added for protection against wind at harbor\\\",\\n          \\\"evidence\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"OAR (father's, weathered oak with rope-wrapped grip) held in right hand\\\",\\n          \\\"reason\\\": \\\"Billy now carries his father's oar to the dock meeting\\\",\\n          \\\"evidence\\\": \\\"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"confidence\\\": 0.88\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"character:jane\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"age\\\",\\n          \\\"value\\\": \\\"30s\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"rain jacket\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"sharp eyes; no visible injuries noted\\\",\\n          \\\"confidence\\\": 0.8\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"impatient, direct\\\",\\n          \\\"confidence\\\": 0.8\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"sealed ENVELOPE\\\",\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.9\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"DAY\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"natural daylight (exterior)\\\",\\n          \\\"confidence\\\": 0.85\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"windy\\\",\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"tense, clandestine meeting; industrial/maritime setting\\\",\\n          \\\"confidence\\\": 0.75\\n        },\\n        {\\n          \\\"key\\\": \\\"damage_or_changes\\\",\\n          \\\"value\\\": \\\"no damage noted; pilings present for mooring\\\",\\n          \\\"confidence\\\": 0.7\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.85\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"weathered oak; intact\\\",\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"in Billy's right hand, held like a walking stick; later set against a piling\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy's (inherited from his father)\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"description\\\",\\n          \\\"value\\\": \\\"weathered oak with rope-wrapped grip\\\",\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"held in Billy's right hand like a walking stick; then set against a piling\\\",\\n          \\\"reason\\\": \\\"Billy sets the oar down to reach for the envelope\\\",\\n          \\\"evidence\\\": \\\"He sets the OAR against a piling and reaches for the envelope\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"confidence\\\": 0.92\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"sealed\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"held by Jane by the boat\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Jane (holding it); Billy reaches for it\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"held by Jane by the boat; Billy reaches for it\\\",\\n          \\\"reason\\\": \\\"Jane presents the envelope to Billy during their meeting\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE. He sets the OAR against a piling and reaches for the envelope\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"confidence\\\": 0.92\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "0425f33d-940d-433a-a781-f7ef47abad82",
        "latencyMs": 8281,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 4,
        "provider": {
          "id": "anthropic:messages:claude-haiku-4-5-20251001",
          "label": "Claude Haiku 4.5"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"faded flannel shirt, worn jeans, leather jacket (zipped)\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat, resigned, detached\",\n          \"confidence\": 0.85\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"no visible injuries or changes noted\",\n          \"confidence\": 0.7\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"OAR (father's, weathered oak with rope-wrapped grip) — held in right hand like a walking stick\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"faded flannel shirt, worn jeans, leather jacket (zipped against the wind)\",\n          \"reason\": \"leather jacket added for protection against wind at harbor\",\n          \"evidence\": \"leather jacket zipped against the wind\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"OAR (father's, weathered oak with rope-wrapped grip) held in right hand\",\n          \"reason\": \"Billy now carries his father's oar to the dock meeting\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.88\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"age\",\n          \"value\": \"30s\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"sharp eyes; no visible injuries noted\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"impatient, direct\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed ENVELOPE\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"DAY\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"lighting\",\n          \"value\": \"natural daylight (exterior)\",\n          \"confidence\": 0.85\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"tense, clandestine meeting; industrial/maritime setting\",\n          \"confidence\": 0.75\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"no damage noted; pilings present for mooring\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.85\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak; intact\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"in Billy's right hand, held like a walking stick; later set against a piling\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy's (inherited from his father)\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"description\",\n          \"value\": \"weathered oak with rope-wrapped grip\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"held in Billy's right hand like a walking stick; then set against a piling\",\n          \"reason\": \"Billy sets the oar down to reach for the envelope\",\n          \"evidence\": \"He sets the OAR against a piling and reaches for the envelope\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.92\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane by the boat\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane (holding it); Billy reaches for it\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"held by Jane by the boat; Billy reaches for it\",\n          \"reason\": \"Jane presents the envelope to Billy during their meeting\",\n          \"evidence\": \"She holds a sealed ENVELOPE. He sets the OAR against a piling and reaches for the envelope\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.92\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "total": 2511,
            "prompt": 983,
            "completion": 1528
          },
          "finishReason": "stop",
          "cost": 0.008623
        },
        "score": 0.8465499999999999,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.019116,
        "gradingResult": {
          "pass": true,
          "score": 0.9715499999999999,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2560,
            "prompt": 2041,
            "completion": 519,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9931,
              "reason": "change_detection=1.00 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=1.00 | property_extraction=0.97",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.95,
              "reason": "The output meets all 7 critical evaluation criteria:\n\n1. **All 5 entities identified**: Billy (character:billy), Jane (character:jane), dock (location:harbor_dock), oar (prop:oar), envelope (prop:envelope) — all present.\n\n2. **Billy's costume correctly extracted**: 'leather jacket zipped against the wind' — correct.\n\n3. **Billy's costume CHANGE detected**: The change_event correctly shows previous_value as 'faded flannel shirt and worn jeans' changing to 'leather jacket zipped against the wind', with evidence quoting the scene text. This is a critical continuity tracking detail and it's handled well.\n\n4. **Jane's rain jacket and sealed envelope**: Both noted — Jane's costume is 'rain jacket' and the envelope is tracked as a separate entity with 'sealed, intact' condition.\n\n5. **Billy's flat/resigned emotional state**: Captured as 'flat, possibly resigned or habitual lateness' with evidence from the dialogue direction '(flat)'.\n\n6. **Change events supported by scene text quotes**: Every change_event includes an 'evidence' field with actual quoted text from the scene (e.g., 'BILLY walks along the dock, leather jacket zipped against the wind', 'The OAR — his father's, weathered oak with a rope-wrapped grip —', etc.).\n\n7. **Confidence scores reasonable**: Explicit text details get high confidence (0.95-1.0), while inferred states like emotional_state and weather get lower confidence (0.7-0.8). This is appropriate.\n\nAdditional strengths: The oar's position change (from Billy's hand to against a piling) is tracked. The envelope's ownership transition (Jane holding, Billy reaching for it) is noted. The weather inference from costume details is a nice touch.\n\nMinor note: The envelope ownership says 'about to hand to Billy' which slightly editorializes beyond what's stated, but the evidence supports Billy reaching for it. This is a very minor issue.\n\nOverall, this is excellent continuity extraction that catches state changes with evidence, not just current state descriptions.",
              "tokensUsed": {
                "total": 2560,
                "prompt": 2041,
                "completion": 519,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n{\\\"scene_id\\\":\\\"scene_002\\\",\\\"entity_states\\\":[{\\\"entity_key\\\":\\\"character:billy\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"leather jacket zipped against the wind\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"props_carried\\\",\\\"value\\\":\\\"OAR (his father's, weathered oak with rope-wrapped grip), carried in right hand like a walking stick (until set against piling)\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"emotional_state\\\",\\\"value\\\":\\\"flat, possibly resigned or habitual lateness\\\",\\\"confidence\\\":0.8}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"costume\\\",\\\"previous_value\\\":\\\"faded flannel shirt and worn jeans\\\",\\\"new_value\\\":\\\"leather jacket zipped against the wind\\\",\\\"reason\\\":\\\"Billy is now described as wearing a leather jacket zipped up, rather than previous flannel shirt and jeans.\\\",\\\"evidence\\\":\\\"BILLY walks along the dock, leather jacket zipped against the wind.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95},{\\\"property_key\\\":\\\"props_carried\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"OAR (his father's, weathered oak with rope-wrapped grip), carried in right hand like a walking stick (until set against piling)\\\",\\\"reason\\\":\\\"Billy is carrying the OAR as he walks.\\\",\\\"evidence\\\":\\\"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"emotional_state\\\",\\\"previous_value\\\":\\\"tense, jaw tight\\\",\\\"new_value\\\":\\\"flat, possibly resigned or habitual lateness\\\",\\\"reason\\\":\\\"Billy's dialogue delivery is described as 'flat', suggesting a change from previous tension.\\\",\\\"evidence\\\":\\\"BILLY (flat) I'm always late.\\\",\\\"is_explicit\\\":false,\\\"confidence\\\":0.8}],\\\"confidence\\\":0.95},{\\\"entity_key\\\":\\\"character:jane\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"rain jacket\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"emotional_state\\\",\\\"value\\\":\\\"impatient or annoyed (inferred from dialogue)\\\",\\\"confidence\\\":0.8},{\\\"key\\\":\\\"props_carried\\\",\\\"value\\\":\\\"sealed envelope\\\",\\\"confidence\\\":1}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"costume\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"rain jacket\\\",\\\"reason\\\":\\\"First appearance; Jane is described as wearing a rain jacket.\\\",\\\"evidence\\\":\\\"JANE (30s, sharp eyes, rain jacket) waiting by the boat.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"emotional_state\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"impatient or annoyed (inferred from dialogue)\\\",\\\"reason\\\":\\\"Jane's first line is 'You're late,' which suggests impatience or annoyance.\\\",\\\"evidence\\\":\\\"JANE You're late.\\\",\\\"is_explicit\\\":false,\\\"confidence\\\":0.8},{\\\"property_key\\\":\\\"props_carried\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"sealed envelope\\\",\\\"reason\\\":\\\"Jane is holding a sealed envelope.\\\",\\\"evidence\\\":\\\"She holds a sealed ENVELOPE.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1}],\\\"confidence\\\":0.95},{\\\"entity_key\\\":\\\"location:harbor_dock\\\",\\\"properties\\\":[{\\\"key\\\":\\\"lighting\\\",\\\"value\\\":\\\"daylight\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"time_of_day\\\",\\\"value\\\":\\\"day\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"weather\\\",\\\"value\\\":\\\"windy, possibly rainy\\\",\\\"confidence\\\":0.8},{\\\"key\\\":\\\"atmosphere\\\",\\\"value\\\":\\\"tense, expectant\\\",\\\"confidence\\\":0.7}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"lighting\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"daylight\\\",\\\"reason\\\":\\\"Scene heading specifies exterior, day.\\\",\\\"evidence\\\":\\\"EXT. HARBOR DOCK - DAY\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"time_of_day\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"day\\\",\\\"reason\\\":\\\"Scene heading specifies day.\\\",\\\"evidence\\\":\\\"EXT. HARBOR DOCK - DAY\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"weather\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"windy, possibly rainy\\\",\\\"reason\\\":\\\"Billy's jacket is zipped against the wind; Jane wears a rain jacket.\\\",\\\"evidence\\\":\\\"leather jacket zipped against the wind... JANE (30s, sharp eyes, rain jacket)\\\",\\\"is_explicit\\\":false,\\\"confidence\\\":0.8},{\\\"property_key\\\":\\\"atmosphere\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"tense, expectant\\\",\\\"reason\\\":\\\"Dialogue and character actions suggest tension and anticipation.\\\",\\\"evidence\\\":\\\"JANE You're late. BILLY (flat) I'm always late.\\\",\\\"is_explicit\\\":false,\\\"confidence\\\":0.7}],\\\"confidence\\\":0.9},{\\\"entity_key\\\":\\\"prop:oar\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"weathered but intact\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"initially in Billy's right hand, then set against a piling\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"Billy (his father's oar)\\\",\\\"confidence\\\":1}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"weathered but intact\\\",\\\"reason\\\":\\\"Described as 'weathered oak with a rope-wrapped grip', but no damage.\\\",\\\"evidence\\\":\\\"The OAR — his father's, weathered oak with a rope-wrapped grip —\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"position\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"initially in Billy's right hand, then set against a piling\\\",\\\"reason\\\":\\\"Billy carries the oar, then sets it against a piling.\\\",\\\"evidence\\\":\\\"rests in his right hand like a walking stick... He sets the OAR against a piling\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"ownership\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"Billy (his father's oar)\\\",\\\"reason\\\":\\\"Oar is described as Billy's father's and is carried by Billy.\\\",\\\"evidence\\\":\\\"The OAR — his father's... rests in his right hand\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1}],\\\"confidence\\\":1},{\\\"entity_key\\\":\\\"prop:envelope\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"sealed, intact\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"in Jane's hand\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"Jane (about to hand to Billy)\\\",\\\"confidence\\\":1}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"sealed, intact\\\",\\\"reason\\\":\\\"Envelope is described as sealed.\\\",\\\"evidence\\\":\\\"She holds a sealed ENVELOPE.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"position\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"in Jane's hand\\\",\\\"reason\\\":\\\"Jane is holding the envelope.\\\",\\\"evidence\\\":\\\"She holds a sealed ENVELOPE.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"ownership\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"Jane (about to hand to Billy)\\\",\\\"reason\\\":\\\"Jane is holding the envelope, and Billy reaches for it.\\\",\\\"evidence\\\":\\\"She holds a sealed ENVELOPE... He sets the OAR against a piling and reaches for the envelope.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1}],\\\"confidence\\\":1}]}\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "010e5c1d-7691-4fc6-bd2a-f61b27a9e079",
        "latencyMs": 19229,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 3,
        "provider": {
          "id": "openai:gpt-4.1",
          "label": "GPT-4.1"
        },
        "response": {
          "output": "{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped against the wind\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"OAR (his father's, weathered oak with rope-wrapped grip), carried in right hand like a walking stick (until set against piling)\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat, possibly resigned or habitual lateness\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped against the wind\",\n          \"reason\": \"Billy is now described as wearing a leather jacket zipped up, rather than previous flannel shirt and jeans.\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"OAR (his father's, weathered oak with rope-wrapped grip), carried in right hand like a walking stick (until set against piling)\",\n          \"reason\": \"Billy is carrying the OAR as he walks.\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat, possibly resigned or habitual lateness\",\n          \"reason\": \"Billy's dialogue delivery is described as 'flat', suggesting a change from previous tension.\",\n          \"evidence\": \"BILLY (flat) I'm always late.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"impatient or annoyed (inferred from dialogue)\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed envelope\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": null,\n          \"new_value\": \"rain jacket\",\n          \"reason\": \"First appearance; Jane is described as wearing a rain jacket.\",\n          \"evidence\": \"JANE (30s, sharp eyes, rain jacket) waiting by the boat.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": null,\n          \"new_value\": \"impatient or annoyed (inferred from dialogue)\",\n          \"reason\": \"Jane's first line is 'You're late,' which suggests impatience or annoyance.\",\n          \"evidence\": \"JANE You're late.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed envelope\",\n          \"reason\": \"Jane is holding a sealed envelope.\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"daylight\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"day\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy, possibly rainy\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"tense, expectant\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": null,\n          \"new_value\": \"daylight\",\n          \"reason\": \"Scene heading specifies exterior, day.\",\n          \"evidence\": \"EXT. HARBOR DOCK - DAY\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": null,\n          \"new_value\": \"day\",\n          \"reason\": \"Scene heading specifies day.\",\n          \"evidence\": \"EXT. HARBOR DOCK - DAY\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": null,\n          \"new_value\": \"windy, possibly rainy\",\n          \"reason\": \"Billy's jacket is zipped against the wind; Jane wears a rain jacket.\",\n          \"evidence\": \"leather jacket zipped against the wind... JANE (30s, sharp eyes, rain jacket)\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        },\n        {\n          \"property_key\": \"atmosphere\",\n          \"previous_value\": null,\n          \"new_value\": \"tense, expectant\",\n          \"reason\": \"Dialogue and character actions suggest tension and anticipation.\",\n          \"evidence\": \"JANE You're late. BILLY (flat) I'm always late.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.7\n        }\n      ],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered but intact\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"initially in Billy's right hand, then set against a piling\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy (his father's oar)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"weathered but intact\",\n          \"reason\": \"Described as 'weathered oak with a rope-wrapped grip', but no damage.\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip —\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"initially in Billy's right hand, then set against a piling\",\n          \"reason\": \"Billy carries the oar, then sets it against a piling.\",\n          \"evidence\": \"rests in his right hand like a walking stick... He sets the OAR against a piling\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": null,\n          \"new_value\": \"Billy (his father's oar)\",\n          \"reason\": \"Oar is described as Billy's father's and is carried by Billy.\",\n          \"evidence\": \"The OAR — his father's... rests in his right hand\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed, intact\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"in Jane's hand\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane (about to hand to Billy)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed, intact\",\n          \"reason\": \"Envelope is described as sealed.\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"in Jane's hand\",\n          \"reason\": \"Jane is holding the envelope.\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": null,\n          \"new_value\": \"Jane (about to hand to Billy)\",\n          \"reason\": \"Jane is holding the envelope, and Billy reaches for it.\",\n          \"evidence\": \"She holds a sealed ENVELOPE... He sets the OAR against a piling and reaches for the envelope.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}",
          "tokenUsage": {
            "total": 3078,
            "prompt": 918,
            "completion": 2160,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cached": false,
          "latencyMs": 19229,
          "finishReason": "stop",
          "cost": 0.019116,
          "guardrails": {
            "flagged": false
          },
          "metadata": {
            "http": {
              "status": 200,
              "statusText": "OK",
              "headers": {
                "access-control-expose-headers": "X-Request-ID",
                "alt-svc": "h3=\":443\"; ma=86400",
                "cf-cache-status": "DYNAMIC",
                "cf-ray": "9d5d9835cd490b4b-YVR",
                "connection": "keep-alive",
                "content-encoding": "br",
                "content-type": "application/json",
                "date": "Mon, 02 Mar 2026 04:18:15 GMT",
                "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
                "openai-processing-ms": "19116",
                "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
                "openai-version": "2020-10-01",
                "server": "cloudflare",
                "set-cookie": "__cf_bm=RwJZKdq.xtcS5pbM8gsItJZDLM3u4527PSMceOKsY7s-1772425076.129048-1.0.1.1-Z7Qt682AlpFRuudsqyqagPeoDrau7ofLuy5nPv3RGUZvtpY18Rbe6FhFcqXi43Vu6ofGh2mulK5tXLVLCxJPUBdoDYiO093lBYYdzReQKMGpGU0iHsSvk9VDKDwXGkLB; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:48:15 GMT",
                "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
                "transfer-encoding": "chunked",
                "x-content-type-options": "nosniff",
                "x-openai-proxy-wasm": "v0.1",
                "x-ratelimit-limit-requests": "10000",
                "x-ratelimit-limit-tokens": "2000000",
                "x-ratelimit-remaining-requests": "9999",
                "x-ratelimit-remaining-tokens": "1999096",
                "x-ratelimit-reset-requests": "6ms",
                "x-ratelimit-reset-tokens": "27ms",
                "x-request-id": "req_19757ed4bf7a46a08c1209f5cbc6bc11"
              }
            }
          }
        },
        "score": 0.9715499999999999,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "http": {
            "status": 200,
            "statusText": "OK",
            "headers": {
              "access-control-expose-headers": "X-Request-ID",
              "alt-svc": "h3=\":443\"; ma=86400",
              "cf-cache-status": "DYNAMIC",
              "cf-ray": "9d5d9835cd490b4b-YVR",
              "connection": "keep-alive",
              "content-encoding": "br",
              "content-type": "application/json",
              "date": "Mon, 02 Mar 2026 04:18:15 GMT",
              "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
              "openai-processing-ms": "19116",
              "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
              "openai-version": "2020-10-01",
              "server": "cloudflare",
              "set-cookie": "__cf_bm=RwJZKdq.xtcS5pbM8gsItJZDLM3u4527PSMceOKsY7s-1772425076.129048-1.0.1.1-Z7Qt682AlpFRuudsqyqagPeoDrau7ofLuy5nPv3RGUZvtpY18Rbe6FhFcqXi43Vu6ofGh2mulK5tXLVLCxJPUBdoDYiO093lBYYdzReQKMGpGU0iHsSvk9VDKDwXGkLB; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:48:15 GMT",
              "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
              "transfer-encoding": "chunked",
              "x-content-type-options": "nosniff",
              "x-openai-proxy-wasm": "v0.1",
              "x-ratelimit-limit-requests": "10000",
              "x-ratelimit-limit-tokens": "2000000",
              "x-ratelimit-remaining-requests": "9999",
              "x-ratelimit-remaining-tokens": "1999096",
              "x-ratelimit-reset-requests": "6ms",
              "x-ratelimit-reset-tokens": "27ms",
              "x-request-id": "req_19757ed4bf7a46a08c1209f5cbc6bc11"
            }
          },
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.021129000000000002,
        "gradingResult": {
          "pass": true,
          "score": 0.9515499999999999,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2168,
            "prompt": 1634,
            "completion": 534,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9531,
              "reason": "change_detection=1.00 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=0.80 | json_valid=0.90 | property_extraction=0.97 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.95,
              "reason": "The output meets all 7 critical evaluation criteria:\n\n1. **All 5 entities identified**: Billy (character:billy), Jane (character:jane), dock (location:harbor_dock), oar (prop:oar), envelope (prop:envelope) — all present.\n\n2. **Billy's costume correctly extracted**: Listed as 'leather jacket zipped, worn jeans' — correct.\n\n3. **Billy's costume CHANGE detected**: A change_event is recorded from 'faded flannel shirt and worn jeans' to 'leather jacket zipped, worn jeans' with evidence quoting the scene text ('BILLY walks along the dock, leather jacket zipped against the wind.') — excellent continuity tracking.\n\n4. **Jane's rain jacket and sealed envelope noted**: Jane's costume is 'rain jacket' (confidence 1.0), and the envelope is listed as 'sealed, intact' — correct.\n\n5. **Billy's flat/resigned emotional state captured**: Listed as 'flat, detached, possibly resigned' with a change_event from 'tense, jaw tight' to this new state, with evidence quoting 'BILLY (flat) I'm always late.' — well done.\n\n6. **Change events supported by scene text quotes**: Both change events (costume and emotional state) include direct evidence quotes from the scene text. The costume change cites 'BILLY walks along the dock, leather jacket zipped against the wind.' and the emotional change cites the dialogue with parenthetical direction.\n\n7. **Confidence scores reasonable**: Explicit text items get high confidence (0.95-1.0), while inferred items like physical_condition get lower confidence (0.6), and atmosphere gets 0.75. This is sensible calibration.\n\nAdditional strengths: The oar's position change (from right hand to against piling) is tracked. The envelope's transfer state is noted. The output structure is clean and well-organized.\n\nMinor note: Jane has no change_events, which is appropriate if she's a new character in this scene. The output handles this correctly with an empty array.\n\nOverall, this is a thorough and well-evidenced continuity extraction that excels at tracking state changes with supporting evidence.",
              "tokensUsed": {
                "total": 2168,
                "prompt": 1634,
                "completion": 534,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_002\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket zipped, worn jeans (carried over from previous scene)\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"no visible injuries or changes\\\",\\n          \\\"confidence\\\": 0.6\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"flat, detached, possibly resigned\\\",\\n          \\\"confidence\\\": 0.85\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"OAR (father's weathered oak oar with rope-wrapped grip) - initially carried in right hand, then set against piling\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"faded flannel shirt and worn jeans\\\",\\n          \\\"new_value\\\": \\\"leather jacket zipped, worn jeans\\\",\\n          \\\"reason\\\": \\\"Billy changed from flannel shirt to leather jacket, zipped against the wind\\\",\\n          \\\"evidence\\\": \\\"BILLY walks along the dock, leather jacket zipped against the wind.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"tense, jaw tight\\\",\\n          \\\"new_value\\\": \\\"flat, detached, possibly resigned\\\",\\n          \\\"reason\\\": \\\"Billy's demeanor has shifted from physical tension to emotional flatness, evidenced by his delivery\\\",\\n          \\\"evidence\\\": \\\"BILLY\\\\n(flat)\\\\nI'm always late.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.85\\n        }\\n      ],\\n      \\\"confidence\\\": 0.9\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"character:jane\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"rain jacket\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"sharp eyes, no visible injuries\\\",\\n          \\\"confidence\\\": 0.85\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"impatient, direct\\\",\\n          \\\"confidence\\\": 0.8\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"sealed ENVELOPE\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.9\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"daylight\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"day\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"windy\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"damage_or_changes\\\",\\n          \\\"value\\\": \\\"no visible damage mentioned\\\",\\n          \\\"confidence\\\": 0.5\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"tense, transactional meeting place\\\",\\n          \\\"confidence\\\": 0.75\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.85\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"weathered oak with rope-wrapped grip, intact\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"set against a piling (previously in Billy's right hand)\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy's (inherited from his father)\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"sealed, intact\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"held by Jane, Billy reaching for it\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Jane holds it, appears to be transferring to Billy\\\",\\n          \\\"confidence\\\": 0.85\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.9\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "52d0611c-cca2-4761-ad7b-6962082cccf0",
        "latencyMs": 14285,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 5,
        "provider": {
          "id": "anthropic:messages:claude-sonnet-4-5-20250929",
          "label": "Claude Sonnet 4.5"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped, worn jeans (carried over from previous scene)\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"no visible injuries or changes\",\n          \"confidence\": 0.6\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat, detached, possibly resigned\",\n          \"confidence\": 0.85\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"OAR (father's weathered oak oar with rope-wrapped grip) - initially carried in right hand, then set against piling\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped, worn jeans\",\n          \"reason\": \"Billy changed from flannel shirt to leather jacket, zipped against the wind\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat, detached, possibly resigned\",\n          \"reason\": \"Billy's demeanor has shifted from physical tension to emotional flatness, evidenced by his delivery\",\n          \"evidence\": \"BILLY\\n(flat)\\nI'm always late.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.85\n        }\n      ],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"sharp eyes, no visible injuries\",\n          \"confidence\": 0.85\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"impatient, direct\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed ENVELOPE\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"daylight\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"day\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"no visible damage mentioned\",\n          \"confidence\": 0.5\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"tense, transactional meeting place\",\n          \"confidence\": 0.75\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.85\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak with rope-wrapped grip, intact\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"set against a piling (previously in Billy's right hand)\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy's (inherited from his father)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed, intact\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane, Billy reaching for it\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane holds it, appears to be transferring to Billy\",\n          \"confidence\": 0.85\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.9\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "total": 2195,
            "prompt": 983,
            "completion": 1212
          },
          "finishReason": "stop",
          "cost": 0.021129000000000002
        },
        "score": 0.9515499999999999,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.008834,
        "gradingResult": {
          "pass": true,
          "score": 0.9313,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2013,
            "prompt": 1465,
            "completion": 548,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9426,
              "reason": "change_detection=1.00 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=0.80 | json_valid=0.90 | property_extraction=0.93 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.92,
              "reason": "The output performs very well across all 7 criteria:\n\n1. **All 5 entities identified**: Yes — character:billy, character:jane, location:harbor_dock, prop:oar, prop:envelope are all present.\n\n2. **Billy's costume as leather jacket**: Yes — correctly extracted with confidence 1.0.\n\n3. **Billy's costume CHANGE from flannel shirt to leather jacket**: Yes — a change_event is recorded with previous_value 'faded flannel shirt and worn jeans' and new_value 'leather jacket zipped', with a direct text quote as evidence: 'BILLY walks along the dock, leather jacket zipped against the wind.' This is excellent continuity tracking.\n\n4. **Jane's rain jacket and sealed envelope**: Yes — Jane's costume is listed as 'rain jacket' (confidence 1.0) and the envelope is noted as 'sealed' with its own entity entry.\n\n5. **Billy's flat/resigned emotional state**: Yes — captured as 'flat' with confidence 0.9, and there's a change_event tracking the shift from 'tense, jaw tight' to 'flat' with evidence quote 'BILLY (flat) I'm always late.'\n\n6. **Change events supported by scene text quotes**: Yes — both change events for Billy include evidence fields with actual scene text quotes. The costume change cites 'BILLY walks along the dock, leather jacket zipped against the wind' and the emotional state change cites 'BILLY (flat) I'm always late.'\n\n7. **Confidence scores reasonable**: Yes — explicit text descriptions get 1.0, emotional states get 0.9, inferred properties like atmosphere get 0.8. This is a sensible gradient.\n\nMinor observations: The oar's change_events are empty (no change detected for position from 'carried' to 'resting against a piling', which could arguably be a change event if Billy set it down). Billy's props_carried description 'none (just set down OAR, reaching for ENVELOPE)' is slightly informal but captures the state. Jane has no change_events, which is correct if she's a new character in this scene.\n\nOverall this is a strong continuity extraction that catches state changes with evidence, not just current state descriptions.",
              "tokensUsed": {
                "total": 2013,
                "prompt": 1465,
                "completion": 548,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_002\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket zipped\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"flat\\\",\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"none (just set down OAR, reaching for ENVELOPE)\\\",\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"faded flannel shirt and worn jeans\\\",\\n          \\\"new_value\\\": \\\"leather jacket zipped\\\",\\n          \\\"reason\\\": \\\"Character changed wardrobe.\\\",\\n          \\\"evidence\\\": \\\"BILLY walks along the dock, leather jacket zipped against the wind.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"tense, jaw tight\\\",\\n          \\\"new_value\\\": \\\"flat\\\",\\n          \\\"reason\\\": \\\"Character's emotional state has shifted.\\\",\\n          \\\"evidence\\\": \\\"BILLY (flat) I'm always late.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"character:jane\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"rain jacket\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"sharp eyes\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"direct, possibly impatient\\\",\\n          \\\"confidence\\\": 0.8\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"sealed ENVELOPE\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"natural daylight\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"Day\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"windy\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"exposed, windy\\\",\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"weathered oak with a rope-wrapped grip\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"resting against a piling\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy's father's (currently possessed by Billy)\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"sealed\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"held by Jane\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"held by Jane\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.95\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "1e7f2557-678a-4cbd-935c-750a1ced3a9e",
        "latencyMs": 13647,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 7,
        "provider": {
          "id": "google:gemini-2.5-flash",
          "label": "Gemini 2.5 Flash"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none (just set down OAR, reaching for ENVELOPE)\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped\",\n          \"reason\": \"Character changed wardrobe.\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat\",\n          \"reason\": \"Character's emotional state has shifted.\",\n          \"evidence\": \"BILLY (flat) I'm always late.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"sharp eyes\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"direct, possibly impatient\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed ENVELOPE\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"natural daylight\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"Day\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"exposed, windy\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak with a rope-wrapped grip\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"resting against a piling\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy's father's (currently possessed by Billy)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"held by Jane\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "prompt": 1005,
            "completion": 1044,
            "total": 4418,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 2369,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cost": 0.008834,
          "raw": {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none (just set down OAR, reaching for ENVELOPE)\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped\",\n          \"reason\": \"Character changed wardrobe.\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat\",\n          \"reason\": \"Character's emotional state has shifted.\",\n          \"evidence\": \"BILLY (flat) I'm always late.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"sharp eyes\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"direct, possibly impatient\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed ENVELOPE\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"natural daylight\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"Day\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"exposed, windy\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak with a rope-wrapped grip\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"resting against a piling\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy's father's (currently possessed by Billy)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"held by Jane\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    }\n  ]\n}\n```"
                    }
                  ],
                  "role": "model"
                },
                "finishReason": "STOP",
                "index": 0
              }
            ],
            "usageMetadata": {
              "promptTokenCount": 1005,
              "candidatesTokenCount": 1044,
              "totalTokenCount": 4418,
              "promptTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 1005
                }
              ],
              "thoughtsTokenCount": 2369
            },
            "modelVersion": "gemini-2.5-flash",
            "responseId": "kg-lafvwOve-qtsPnPHCuAs"
          },
          "cached": false,
          "metadata": {}
        },
        "score": 0.9313,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 0.9833000000000001,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 3710,
            "prompt": 3125,
            "completion": 585,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9666,
              "reason": "change_detection=1.00 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=0.96 | json_valid=0.90 | property_extraction=0.93 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 1,
              "reason": "The output meets all 7 critical evaluation criteria:\n\n1. **All 5 entities identified**: Billy (character:billy), Jane (character:jane), dock (location:harbor_dock), oar (prop:oar), envelope (prop:envelope) — all present.\n\n2. **Billy's costume correctly extracted**: Leather jacket (zipped) and worn jeans, with confidence 0.95.\n\n3. **Billy's costume CHANGE detected**: Explicitly captured as a change_event from 'faded flannel shirt and worn jeans' to 'leather jacket (zipped) and worn jeans', with clear reasoning that the flannel shirt is no longer mentioned and is inconsistent with the new description. Evidence quote provided: 'BILLY walks along the dock, leather jacket zipped against the wind.'\n\n4. **Jane's rain jacket and sealed envelope noted**: Jane's costume is 'rain jacket' (confidence 1.0), and the envelope is described as 'Sealed, intact' (confidence 1.0). Both are well-captured.\n\n5. **Billy's flat/resigned emotional state captured**: Described as 'flat, detached, understated — calm but guarded' with evidence from the dialogue direction 'BILLY (flat) I'm always late.' The change from 'tense, jaw tight' to 'flat, detached' is tracked.\n\n6. **Change events supported by scene text quotes**: Every change_event includes an 'evidence' field with actual scene text quotes (e.g., 'BILLY walks along the dock, leather jacket zipped against the wind', 'The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick', 'She holds a sealed ENVELOPE', etc.).\n\n7. **Confidence scores are reasonable**: Explicit text gets high confidence (0.95-1.0), while inferred properties get lower confidence (e.g., lighting at 0.65, weather at 0.85, atmosphere at 0.75-0.8). Emotional states that are partially inferred get moderate-high confidence (0.85-0.9).\n\nAdditionally, the output goes beyond minimum requirements by tracking the oar's position change (from Billy's hand to against a piling), the envelope's transfer status (in progress but not complete), and the nuanced ownership tracking. The structure is clean, well-organized, and the reasoning is thorough throughout.",
              "tokensUsed": {
                "total": 3710,
                "prompt": 3125,
                "completion": 585,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_002\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket (zipped), worn jeans (carried forward from previous scene)\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"flat, detached, understated — calm but guarded\\\",\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"OAR (in right hand on arrival); sets it against piling mid-scene. Reaching for ENVELOPE at scene end.\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"faded flannel shirt and worn jeans\\\",\\n          \\\"new_value\\\": \\\"leather jacket (zipped) and worn jeans\\\",\\n          \\\"reason\\\": \\\"Scene explicitly describes Billy wearing a leather jacket; flannel shirt from previous scene is no longer mentioned and is inconsistent with the new description.\\\",\\n          \\\"evidence\\\": \\\"BILLY walks along the dock, leather jacket zipped against the wind.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"tense, jaw tight\\\",\\n          \\\"new_value\\\": \\\"flat, detached — outwardly calm, guarded\\\",\\n          \\\"reason\\\": \\\"Dialogue direction specifies 'flat' delivery; no physical tension markers (jaw, posture) are described in this scene.\\\",\\n          \\\"evidence\\\": \\\"BILLY (flat) I'm always late.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.88\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Arrives carrying OAR in right hand; sets it against a piling. Reaches for ENVELOPE at scene end.\\\",\\n          \\\"reason\\\": \\\"First scene in which Billy's carried props are described. OAR is relinquished mid-scene.\\\",\\n          \\\"evidence\\\": \\\"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick. He sets the OAR against a piling and reaches for the envelope.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.92\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"character:jane\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"rain jacket\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"No injuries or notable physical changes described; appears healthy and alert.\\\",\\n          \\\"confidence\\\": 0.75\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"Impatient, assertive; waiting and immediately calls out Billy's lateness.\\\",\\n          \\\"confidence\\\": 0.88\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"Sealed ENVELOPE, held in hand.\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"rain jacket\\\",\\n          \\\"reason\\\": \\\"First appearance; costume established in scene.\\\",\\n          \\\"evidence\\\": \\\"JANE (30s, sharp eyes, rain jacket) waiting by the boat.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Impatient, assertive\\\",\\n          \\\"reason\\\": \\\"First appearance; emotional state inferred from immediate confrontational dialogue.\\\",\\n          \\\"evidence\\\": \\\"JANE: You're late.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.85\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Sealed ENVELOPE\\\",\\n          \\\"reason\\\": \\\"First appearance; prop established in scene.\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.9\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"Day\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"Windy; rain implied or anticipated (Jane wears a rain jacket; Billy's jacket is zipped against the wind).\\\",\\n          \\\"confidence\\\": 0.85\\n        },\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"Daylight; overcast likely given weather cues, though not explicitly stated.\\\",\\n          \\\"confidence\\\": 0.65\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"Exposed, blustery, functional working dock; tense and transactional mood.\\\",\\n          \\\"confidence\\\": 0.8\\n        },\\n        {\\n          \\\"key\\\": \\\"damage_or_changes\\\",\\n          \\\"value\\\": \\\"No damage described. Piling present as set dressing.\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"time_of_day\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Day\\\",\\n          \\\"reason\\\": \\\"First appearance of this location; established by scene heading.\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - DAY\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Windy; rain likely (rain jacket worn, jacket zipped against wind)\\\",\\n          \\\"reason\\\": \\\"First appearance; weather inferred from costume choices and explicit wind reference.\\\",\\n          \\\"evidence\\\": \\\"leather jacket zipped against the wind. / JANE (30s, sharp eyes, rain jacket)\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.8\\n        },\\n        {\\n          \\\"property_key\\\": \\\"atmosphere\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Exposed, blustery working dock; tense and transactional\\\",\\n          \\\"reason\\\": \\\"First appearance; atmosphere inferred from setting description and scene tone.\\\",\\n          \\\"evidence\\\": \\\"BILLY walks along the dock... She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.75\\n        }\\n      ],\\n      \\\"confidence\\\": 0.85\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"Weathered but intact; oak with rope-wrapped grip.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"Arrives in Billy's right hand; set against a dock piling mid-scene.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Belongs to Billy (inherited from his father); currently unattended against piling.\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Weathered oak, rope-wrapped grip — intact\\\",\\n          \\\"reason\\\": \\\"First appearance; condition established in scene.\\\",\\n          \\\"evidence\\\": \\\"The OAR — his father's, weathered oak with a rope-wrapped grip\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Set against a dock piling (was in Billy's right hand on arrival)\\\",\\n          \\\"reason\\\": \\\"Billy sets it down mid-scene to reach for the envelope.\\\",\\n          \\\"evidence\\\": \\\"He sets the OAR against a piling and reaches for the envelope.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"ownership\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Billy's (his father's oar); currently unattended\\\",\\n          \\\"reason\\\": \\\"First appearance; provenance and possession established in scene.\\\",\\n          \\\"evidence\\\": \\\"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.98\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"Sealed, intact.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"Held by Jane; Billy reaching for it at scene end (transfer in progress, not yet complete).\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Currently held by Jane; Billy is reaching for it — transfer imminent but not yet confirmed.\\\",\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Sealed, intact\\\",\\n          \\\"reason\\\": \\\"First appearance; condition explicitly stated.\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"In Jane's hand; Billy reaching for it\\\",\\n          \\\"reason\\\": \\\"First appearance; position established and partially changing at scene end.\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE. / He sets the OAR against a piling and reaches for the envelope.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"ownership\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Jane holds it; transfer to Billy initiated but not completed within scene\\\",\\n          \\\"reason\\\": \\\"First appearance; ownership state established. Scene ends before handoff is confirmed.\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE. / He sets the OAR against a piling and reaches for the envelope.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"confidence\\\": 0.97\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "a07f88cf-3994-4dd8-9785-728fc4c39133",
        "latencyMs": 34083,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 6,
        "provider": {
          "id": "anthropic:messages:claude-sonnet-4-6",
          "label": "Claude Sonnet 4.6"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket (zipped), worn jeans (carried forward from previous scene)\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat, detached, understated — calm but guarded\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"OAR (in right hand on arrival); sets it against piling mid-scene. Reaching for ENVELOPE at scene end.\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket (zipped) and worn jeans\",\n          \"reason\": \"Scene explicitly describes Billy wearing a leather jacket; flannel shirt from previous scene is no longer mentioned and is inconsistent with the new description.\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat, detached — outwardly calm, guarded\",\n          \"reason\": \"Dialogue direction specifies 'flat' delivery; no physical tension markers (jaw, posture) are described in this scene.\",\n          \"evidence\": \"BILLY (flat) I'm always late.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.88\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"Arrives carrying OAR in right hand; sets it against a piling. Reaches for ENVELOPE at scene end.\",\n          \"reason\": \"First scene in which Billy's carried props are described. OAR is relinquished mid-scene.\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand like a walking stick. He sets the OAR against a piling and reaches for the envelope.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.92\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"No injuries or notable physical changes described; appears healthy and alert.\",\n          \"confidence\": 0.75\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"Impatient, assertive; waiting and immediately calls out Billy's lateness.\",\n          \"confidence\": 0.88\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"Sealed ENVELOPE, held in hand.\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": null,\n          \"new_value\": \"rain jacket\",\n          \"reason\": \"First appearance; costume established in scene.\",\n          \"evidence\": \"JANE (30s, sharp eyes, rain jacket) waiting by the boat.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": null,\n          \"new_value\": \"Impatient, assertive\",\n          \"reason\": \"First appearance; emotional state inferred from immediate confrontational dialogue.\",\n          \"evidence\": \"JANE: You're late.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.85\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"Sealed ENVELOPE\",\n          \"reason\": \"First appearance; prop established in scene.\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"Day\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"Windy; rain implied or anticipated (Jane wears a rain jacket; Billy's jacket is zipped against the wind).\",\n          \"confidence\": 0.85\n        },\n        {\n          \"key\": \"lighting\",\n          \"value\": \"Daylight; overcast likely given weather cues, though not explicitly stated.\",\n          \"confidence\": 0.65\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"Exposed, blustery, functional working dock; tense and transactional mood.\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"No damage described. Piling present as set dressing.\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": null,\n          \"new_value\": \"Day\",\n          \"reason\": \"First appearance of this location; established by scene heading.\",\n          \"evidence\": \"EXT. HARBOR DOCK - DAY\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": null,\n          \"new_value\": \"Windy; rain likely (rain jacket worn, jacket zipped against wind)\",\n          \"reason\": \"First appearance; weather inferred from costume choices and explicit wind reference.\",\n          \"evidence\": \"leather jacket zipped against the wind. / JANE (30s, sharp eyes, rain jacket)\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        },\n        {\n          \"property_key\": \"atmosphere\",\n          \"previous_value\": null,\n          \"new_value\": \"Exposed, blustery working dock; tense and transactional\",\n          \"reason\": \"First appearance; atmosphere inferred from setting description and scene tone.\",\n          \"evidence\": \"BILLY walks along the dock... She holds a sealed ENVELOPE.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.75\n        }\n      ],\n      \"confidence\": 0.85\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Weathered but intact; oak with rope-wrapped grip.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"Arrives in Billy's right hand; set against a dock piling mid-scene.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Belongs to Billy (inherited from his father); currently unattended against piling.\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"Weathered oak, rope-wrapped grip — intact\",\n          \"reason\": \"First appearance; condition established in scene.\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"Set against a dock piling (was in Billy's right hand on arrival)\",\n          \"reason\": \"Billy sets it down mid-scene to reach for the envelope.\",\n          \"evidence\": \"He sets the OAR against a piling and reaches for the envelope.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": null,\n          \"new_value\": \"Billy's (his father's oar); currently unattended\",\n          \"reason\": \"First appearance; provenance and possession established in scene.\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.98\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Sealed, intact.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"Held by Jane; Billy reaching for it at scene end (transfer in progress, not yet complete).\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Currently held by Jane; Billy is reaching for it — transfer imminent but not yet confirmed.\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"Sealed, intact\",\n          \"reason\": \"First appearance; condition explicitly stated.\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"In Jane's hand; Billy reaching for it\",\n          \"reason\": \"First appearance; position established and partially changing at scene end.\",\n          \"evidence\": \"She holds a sealed ENVELOPE. / He sets the OAR against a piling and reaches for the envelope.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": null,\n          \"new_value\": \"Jane holds it; transfer to Billy initiated but not completed within scene\",\n          \"reason\": \"First appearance; ownership state established. Scene ends before handoff is confirmed.\",\n          \"evidence\": \"She holds a sealed ENVELOPE. / He sets the OAR against a piling and reaches for the envelope.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.97\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "total": 3686,
            "prompt": 983,
            "completion": 2703
          },
          "finishReason": "stop"
        },
        "score": 0.9833000000000001,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.010942499999999999,
        "gradingResult": {
          "pass": true,
          "score": 0.9037999999999999,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2785,
            "prompt": 2081,
            "completion": 704,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9576,
              "reason": "change_detection=1.00 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=0.90 | json_valid=0.90 | property_extraction=0.93 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.85,
              "reason": "Let me evaluate against each criterion:\n\n1. **All 5 entities identified**: Yes - character:billy, character:jane, location:harbor_dock, prop:oar, prop:envelope are all present. ✓\n\n2. **Billy's costume as leather jacket**: Yes - extracted as 'leather jacket zipped, faded flannel shirt and worn jeans'. ✓\n\n3. **Billy's costume CHANGE from flannel shirt to leather jacket**: Yes - there's a change_event with previous_value 'faded flannel shirt and worn jeans' changing to 'leather jacket zipped, faded flannel shirt and worn jeans' with the reason 'Billy has added a leather jacket due to the wind.' The evidence quotes actual scene text. However, the extraction frames it as an *addition* rather than a change, which is actually more nuanced and arguably more accurate (he's wearing the jacket over the flannel). ✓\n\n4. **Jane's rain jacket and sealed envelope**: Yes - Jane's costume is 'rain jacket' and the envelope is tracked as a separate entity with condition 'sealed'. ✓\n\n5. **Billy's flat/resigned emotional state**: Partially - it captures 'flat' with confidence 1.0 and shows the change from 'tense, jaw tight' to 'flat'. However, it doesn't capture the 'resigned' aspect. Minor miss. ~✓\n\n6. **Change events supported by actual scene text quotes**: Yes - all change events include evidence fields with what appear to be direct quotes from the scene text (e.g., 'BILLY walks along the dock, leather jacket zipped against the wind.', '(flat)', 'The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand', 'He sets the OAR against a piling'). ✓\n\n7. **Confidence scores reasonable**: Yes - explicit text gets 1.0 (costume change, emotional state, props), inferred details get lower scores (weather at 0.9, atmosphere at 0.8, Jane's emotional state at 0.7). ✓\n\nAdditional strengths:\n- The oar's position change (from Billy's hand to leaning against a piling) is tracked\n- The oar's ownership and provenance (father's) is captured\n- Weather conditions are inferred from contextual clues\n\nMinor weaknesses:\n- 'Resigned' aspect of Billy's emotional state is missing\n- Jane's emotional state 'impatient' at 0.7 confidence seems somewhat speculative without clear evidence quoted\n- The envelope's position doesn't track any potential transfer toward Billy (\"reaching for envelope\" is mentioned in Billy's props but not fully tracked as a change event for the envelope)\n\nOverall, this is a strong continuity extraction that captures state changes with evidence, tracks multiple entity types, and uses reasonable confidence scoring.",
              "tokensUsed": {
                "total": 2785,
                "prompt": 2081,
                "completion": 704,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_002\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket zipped, faded flannel shirt and worn jeans\\\",\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"flat\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"father's weathered oak oar (initially), reaching for envelope\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"faded flannel shirt and worn jeans\\\",\\n          \\\"new_value\\\": \\\"leather jacket zipped, faded flannel shirt and worn jeans\\\",\\n          \\\"reason\\\": \\\"Billy has added a leather jacket due to the wind.\\\",\\n          \\\"evidence\\\": \\\"BILLY walks along the dock, leather jacket zipped against the wind.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"tense, jaw tight\\\",\\n          \\\"new_value\\\": \\\"flat\\\",\\n          \\\"reason\\\": \\\"Billy's demeanor is described as flat during the interaction.\\\",\\n          \\\"evidence\\\": \\\"(flat)\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"father's weathered oak oar\\\",\\n          \\\"reason\\\": \\\"Billy is now seen carrying an oar.\\\",\\n          \\\"evidence\\\": \\\"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"character:jane\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"rain jacket\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"30s, sharp eyes\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"impatient\\\",\\n          \\\"confidence\\\": 0.7\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"sealed envelope\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"rain jacket\\\",\\n          \\\"reason\\\": \\\"First appearance\\\",\\n          \\\"evidence\\\": \\\"JANE (30s, sharp eyes, rain jacket)\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"sealed envelope\\\",\\n          \\\"reason\\\": \\\"First appearance\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"daylight\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"day\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"windy\\\",\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"cold, brisk\\\",\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"lighting\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"daylight\\\",\\n          \\\"reason\\\": \\\"First appearance\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - DAY\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"windy\\\",\\n          \\\"reason\\\": \\\"First appearance\\\",\\n          \\\"evidence\\\": \\\"leather jacket zipped against the wind.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"weathered oak with a rope-wrapped grip\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"leaning against a piling\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy (inherited from father)\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"leaning against a piling\\\",\\n          \\\"reason\\\": \\\"Billy sets it down to reach for the envelope.\\\",\\n          \\\"evidence\\\": \\\"He sets the OAR against a piling\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"sealed\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"held by Jane\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Jane\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"sealed\\\",\\n          \\\"reason\\\": \\\"First appearance\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "98687626-068b-4d2f-8ad8-a1a9afc6a7ef",
        "latencyMs": 18240,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 8,
        "provider": {
          "id": "google:gemini-3-flash-preview",
          "label": "Gemini 3 Flash"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped, faded flannel shirt and worn jeans\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"father's weathered oak oar (initially), reaching for envelope\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped, faded flannel shirt and worn jeans\",\n          \"reason\": \"Billy has added a leather jacket due to the wind.\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat\",\n          \"reason\": \"Billy's demeanor is described as flat during the interaction.\",\n          \"evidence\": \"(flat)\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"father's weathered oak oar\",\n          \"reason\": \"Billy is now seen carrying an oar.\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"30s, sharp eyes\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"impatient\",\n          \"confidence\": 0.7\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed envelope\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": null,\n          \"new_value\": \"rain jacket\",\n          \"reason\": \"First appearance\",\n          \"evidence\": \"JANE (30s, sharp eyes, rain jacket)\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed envelope\",\n          \"reason\": \"First appearance\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"daylight\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"day\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"cold, brisk\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": null,\n          \"new_value\": \"daylight\",\n          \"reason\": \"First appearance\",\n          \"evidence\": \"EXT. HARBOR DOCK - DAY\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": null,\n          \"new_value\": \"windy\",\n          \"reason\": \"First appearance\",\n          \"evidence\": \"leather jacket zipped against the wind.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak with a rope-wrapped grip\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"leaning against a piling\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy (inherited from father)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"leaning against a piling\",\n          \"reason\": \"Billy sets it down to reach for the envelope.\",\n          \"evidence\": \"He sets the OAR against a piling\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed\",\n          \"reason\": \"First appearance\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "prompt": 1005,
            "completion": 1646,
            "total": 4485,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 1834,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cost": 0.010942499999999999,
          "raw": {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped, faded flannel shirt and worn jeans\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"father's weathered oak oar (initially), reaching for envelope\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped, faded flannel shirt and worn jeans\",\n          \"reason\": \"Billy has added a leather jacket due to the wind.\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat\",\n          \"reason\": \"Billy's demeanor is described as flat during the interaction.\",\n          \"evidence\": \"(flat)\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"father's weathered oak oar\",\n          \"reason\": \"Billy is now seen carrying an oar.\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"30s, sharp eyes\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"impatient\",\n          \"confidence\": 0.7\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed envelope\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": null,\n          \"new_value\": \"rain jacket\",\n          \"reason\": \"First appearance\",\n          \"evidence\": \"JANE (30s, sharp eyes, rain jacket)\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed envelope\",\n          \"reason\": \"First appearance\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"daylight\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"day\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"cold, brisk\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": null,\n          \"new_value\": \"daylight\",\n          \"reason\": \"First appearance\",\n          \"evidence\": \"EXT. HARBOR DOCK - DAY\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": null,\n          \"new_value\": \"windy\",\n          \"reason\": \"First appearance\",\n          \"evidence\": \"leather jacket zipped against the wind.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak with a rope-wrapped grip\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"leaning against a piling\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy (inherited from father)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"leaning against a piling\",\n          \"reason\": \"Billy sets it down to reach for the envelope.\",\n          \"evidence\": \"He sets the OAR against a piling\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed\",\n          \"reason\": \"First appearance\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```",
                      "thoughtSignature": "EtE0Cs40Ab4+9vvfGNfwZErIMKGesmHyo7kZ94m3159VjoHCPFE7DjcdN//Le2Dy3eb6q88Ys6ZRJaTaZ151+tTLv+zKUrpvDKjMWE6CHMDiiwEZOzyuBoSzr9hQ8SvfgK3/tKf2wpAEBWM3BYzuk28yRi8/VKZQDPl2Z/jVzTnjfpDN+e0EhlTICJ+FMeCjwoRuydmNH2sCPr4I7mJ4mRnezu2N2FZpl0CLNq/6mJSxOK+gDLFQnhXyyv8PY4nSJMkkOljaRHroUkRqQczJ207fVZC5zT0XPLQ4NmQQdr6H2zMieGRlR3M0Slev0xOtW9aBXZlWzJHEKhGEKF+BPZmsWnQU8P7MOvZ7ydcuwNb8Qo0+ex7JqdMa8g10xR8Jo38bY1xB3kP7hHcuBRIdddfQtTsSVzfN0NGJk/deBmRVbhU0F0JXkRbltzUunNo4kMoGVLzWkTRm3KFVJeyPVWKlkWwp6I5Mfc6ld30Jcq5ecMUWT4LKJPMfuEnLtM4yadBgBH6EsQDjJgti7Ay5TWlAnH/F9/1cCGw0RQda+PIgzJnOJdWjXtn7mdQuLYyq2V783uTqI7nff9w2x/2UBvuNjoYieMiFN4uSaLm80OeA77tAleKcx+cy1AAp2tcd4jlUNifP1tZYMVtednSJWsB0tuKyOU+SoxhcduTfWXNDoSp05MhzmKUdymjd7NUEsLypJA0jyiYIOimD/yvRAU7Mqqz9e/p1i7wGI0/u08Dw+TfCTZdfUlOIhkMhwNp/BiLUuankd5FkreIExqBOd2+aAlQeD7zLnJi6lOkZvs0LNMx2dLdVQsrOU6xDpehmdozoG6f86psKeJlmPLAoTAiL+3avSm4QWH29FeAI7Hbu/wxdE+/7DKG8I9pM+YfL3olNHJvEaI+64+3zW+LJDBlS9IjoZflvfdcTnDvihY6nmdQLPInqnCi//hAEfQR6AzOqKKLW2OP3fDvyxfBJ5xQfag6VEBwKpKp9U/GkKBHf+/fuY75G9Y2Qe3eRPfn+NZCM7xHbY3bjLmEBQIO8eu/cYue+pBghyDkrEVam1e184EqmGbz6a1YTAXMSRkssq5PNyPJjw3CfRp83w7hrghwQtuQsNp8EbV5nLsNq6EzR/NYeb2h0nIEKLMjmtWs61eNG/hytu+rgFCpBLW58XcFqSe+BDGoZ91eB3sEI8B9kQAd9zeeuQDuEx6F30GQlp72yfU0dsRyS01FmSvuSJ/smKgbAItkusaFx9faS5LZZQ5+F0NfPFWy5VoEACTyJoQiFHZrrWXlGbgCVUtgIfAPzw8nvruEK6HSZegGfR/Fl32NJ/MLhsQ9805c1ERke4w1PIC7pfz2sRtKdVmPYXUUp4bPxR8qOgM6omU3ky+eKgHePZveZEhocUMT4iCzzmlbSXuBAgfxlvHBvtqvDZ7KB+JunE+qSFDHOuuhFzc99f3KSGC7TjUutxrd+Hb+DHo3wXOiWiScYCcZYBr7m30h8TXqnn+d4bU0YP+g49yTotCLG6xrfC3vi/U4VqHrFW6Ue620Rg9U7UHUmoVD0Tgyv4hAoQL8u6dnbwfpNqRlmirLiKDOAVwVJpG4ACdml8tE4Mxsc2Oz11Ch3AsAFlXVzQy2+WwpJ3fuY4w/v9is31GiZuCQsigUPKNUZ7w/KDViwKmlLPG+8KKTZjomYUJWj/n8QiKYzbSeBsUFnx+nf3HqTI20VIdGQIRXmJzNT0vNbXUEx3FmW/sj+g0SNdZnDt5MAlohYATc+RO24ljvrLTDr0VYYYLiJ4lPqTxcGbT/aVbem/pPWlIjPk3IEg+Hr1Q+aohGQer4Y25k+yDttSX6ac35u6Sz2YV6qek0ZMwy7VrFbyAaDozIUsPQlbz45t7UI8eQ4ueIq0Eq2MGPCjX/cGzmEb0WB8gVm7pCp2pBl2vlaFxBLne2Wxd2DdVX1I8esLWgnsZSyf6+Tze6Le/KCeEv2Mm5M1G3cDRd6V8g3tRhY3je5zpsK7cuPRwLY0i/t99uE0hX3SDH/awy7S3sfUZAFXOkrDH0QUvx8rX4Rk4MHfgb0VzMANIUq3dZGARx3H7u0w+P5OVZpN3DlXB3VojTU72/BjLTh294RVhm6vkhyOQizS+hx/p1ctH9nQQRi7YcKmB5u3wWxDPbW3u3NO6DHJii639uXW1P78cRbaIbyUth7Q+7aEO5Pdt/QC2wM6schftMCSMO1+vy7NZ+6xJ11Yh8pPBR16Pa3qx9t/oJSORcNMCprO4WFxwhDrQcdNUuVmdimq/xKbKFTh5sx1BkscXulIyLAexpJ6DmI3cNSM+XdSVtRdjk2qflyO8BE0W++hBh5ZgzZexviv9mSnbczjVh+uOGDXfREpvlzyYmp8VqaCiocgkuZpd4ABRaIOIK0G+4J9mscJ5sPQRaMmXxlkxtsPu9LSJm8LcSXbTMJzWVULrSOv7Bte00NXESk4+92xW05IZl/v1EOLvARzzQm3MjkodKaQ+dKZFGYlKkSIZVztAzPimVeqGQDS5euD4/CB7JVCrUnfja/WjXOP1xthHALWxE5nZebFijbzUYGQNT1TNfscDmKx7NB8sgRa1wfyjHXchEjO/KU+qGVf0RA0ySsObGHa63pHLEixUjq8RaEDifT+okS6pU/G5rLJdYB2OPKNxJFQ1kv0qMqITnKAiZPEU0xERMQzsq1sJb7AO8MbMxi0q7MH08a8IyVjlqWYDkfUbfyTeAdMV7wKTpyozf5zH8tmazKOHpgQx8Ucz2cVGnIXB9V1Vf7+YaRB1wgaX8eFlQYAmPaHlXZ3gz1VNgzxHwJ3NZqEXL8qwqX5scxIZz2g8HWGnJIP5NDUT27XLl1OI752wcp7XGWuqssnx+Hu1TkJDpRdNfYT9lFoyaTpoM0o+JcQwh/GOMj2OCj6oLRE72EIP0tfXf087dHmjLjfotoQCPbRHwzObYCSXMemtey3Y1QCVqjNzUmBkJvvCK1/Rq9Uw8nijEnzt0QlBpO4VRmZHmS4Xpva36bFDLe5Rd5gVbZu9d06zygKMJrduOvKLMxgD9DVXjq4VU5nC8pih8cdbSHyFwQu8RFX4rAG+ol9UF5ZI4duNvgwC0RrYZdXIIzXIlAmPtSPlsLkFz7OcUlhOZYZF7OtTVAFw1zsZlUcyiU/VfeDp0enZLBeSzB35pJfdIL7+KLaMmb9V5v3Qj9810eJwQzZjW95v6g9/JRZnlg6/dpQOtsQONCVYmySGiUz1ALeaM4OcyzdfsdaEIvRMid8lCgYhLE87zhFz60PaE+Sc5yk411N0aD8SRZrj4BJuFuotaHXxFLIRXjegwsRyBS1c1s/L3EKdsKbQ6jwD0qF3G76yjeAtU88fHngT4TTvf4Fnf5FCjoyWQotRF6/P4OwZcdkRw2lun9B2cxDahxaIsQHRfJUzk3n9dIRBfkDwI9e2JHmlM+BXtV+ez9J9vz1HUburYc0f0bMjyuO6hfHYv35oTOFRFWss6XsvDymEoreVcSZ/t4vTM/1dPycp6QlrcouCuqxQqtg2yNP5SmiEwjYTE+tjmWdmeg5xwky9fqlvlwtMe6N7yQH/St95JbdPkOGwJUtMk7MAOkyqXGAp2XJ55bSKWP92Bo+djNj/vPPw3wT7+jD82IwvG/iZE2Oz6rBjIkfFoUDeipxptpY1g0zI1fI8c6fKOZN4hD+cNL7Pu+VWuNrxz+UFcJDI4LJ2+c9bej7AeSW062QOexBcIa/RU9ZZSIGBtMk5gtOdPDKfnXfvf4Qx2/Pj67IV5jtA0GoetKgTij5bs/cVf/+/UdfsXCpweDq9DOsE2giGVft3c8nnB8FSDDsuLfiqcjO3SxEddgczpXiadCTyQBd6PxdArj2EgDwhJkVVBzhEkcPwTr/+YmfRcCFdot7K/Gm4sTvwl3o2QbZKuBv85xcNgYJNawC3KuKzdRR9nGCZQPgQUNk0SmZRPEIL1PtiQEo9UT1x/RTpcCf2w1Y3aC+MHFRP8ak7QcxqFPAT7MQweyc2t+TGkZCx5S4JHQU+KFswCH9G+nIuX8XuHZcxHrqK8jbvdSCnvapxOcTsUSPYdBoBlSdsx2rPy2aqfhC7ILRsgEXJHBUneUrMsvrthbELCUf7MtkvORC452uxJtYvettIrZ+pEz1pIF8isr5cyBmGOvgSUqkZOGnilxnJ6+Cd744omf5Z83n6/frTdWqxR4FiDPLtj2BGHrKzZKjcH0Yyp3KydyQvc1BC5KjddERrwXj1cwF5nXPvCW0QBdpNrsPfKPEPFHfHsmXdExMr+yJkL+M1lTDq0NASp30JrbzN7mKbypRIT8CHmt/K9mCtaWwfoNUbqehYsbBHRLaskqWRAVbgyREM1KQsiVNpdAsc5E7qCyLw4VZyb6Z/gBdenjHZqHh9NgpYVgXU3GfsJisFImd/BbwbFTHrZa9MCfI2sNYNh/PJcwPuVNWzc9+e4wJ0ou9A9nPLQhHjamRZNLcDrUeUbQzA/yp01yuEbRRUZH6f5rCllPd3f1dVST6HklPcJg1wnKoKzf53u6pDqJiQN/ZJfAhO0LfGXy0eILDLEaECfPKX1z6vphovRO9cXgc7apR3Z44KPIg2B/U3pftH0HBRunutHaCWh+xOuwYb9cxEjFKaUXGu4PbDAT+wsKLyMRBcbofSYF5f9MUxuQYdzPyfYRi1KdRAGJ3SchqzEAcOUfGIcmZih91TpVjA5hW5u5OzD6ahRD+PUbRAWvGr8fBuNiRMXoJGEWLx3y41EGympfzRWitMavWSP45KSrf0Wb4/dzobQcANadJfiaRbdJnHEZIKKNby6F3fvatUne/bMJJr09v+yfXs/IF0YnO5DgKesfHr/ZhFLDnNcj15uqY+VYiohFxZd6Z8p6n7+xp5UcFzM9RlNjENHYcc+2TNbUWeAAKgFa6zmQk1wECP85HN2HxPdjXXrkXHEbPFpvWnBgUcVAYwMpSVAHjX4NIbkYagfM3yr0urHARxqp6aQPawN0SMcZP8j8cEZw5+UrJVVCLgYiwVFCxBqn50ePk83sAq8Z+U5zS5QON1WmYLFrnkW6r2kNZSdhkDFVI2AQsaBFH48/KnqzttTtOOB+hDwNQ0Mym//LH/r6lxVsgAH2hklc9rSGBDSyc+zfNor+89AxwoAPK4oHG71xa42OLHcPs20fxO1WGCxjahPMogASG8gkz/i0cHgkmdGcUXL9ARLIaylPZwUvL8J6Pl1119E7Q1yXa6kAQdYL+Jq+9CvKwU2+tyjMLiSho4zNC7Wx5dpXgz4Pq/oEJBKUpthEzzEELmCowFSpKPW9+YJ9u8sP87T7dobArPPtvXGlMeeATzczTB8hjKtZt43Zq+Lm/PJgJhYB3X9g4pshYDNprj8iubgrGYDucr/CqfFj49sEH6ulhLgs+lG8MzDHfixdmWFjsp41AUyw7moBAZtCrWD5d9UPqkyZkG22YYJ3NfqC25HtoA/Jaoqn+0MQ60rozko/Nx0FMSVYHjemIwic0eNxXcMqNXQQncHg6GNAhbVod677e5512mNltovalW48HybJB32lE59Pjh8z72PUbO3IUoIO0DuqeIuSic2j0Yxr7QhXJLMgI2VSzBRPgc4xuL5BNE+0wyIPCkv0x484IZ7b/pRZFXJ5/hs/HZmkvPH9UWBYIuwuDcnZ3tDTsCamn7eKVfXZ4jxmEw6/g2aPskXZeghzkn3i2y01cVqPfDTzaj4Ch+OkegSdYJN4xXRG0vBTW8wrZ5ZqmkrdpNQhsdrg6ZMqmx+Q6s5QOqs+SG89Z7JGcnTmGqDTw4n9Q/BsKaidVlVULLV1tzGxIxA09nStMukgTAcYYJu1ac1z82wpcR8KpFwsUx5QcOmr0xWhIV/X6HlaoJQeeZaZYcsgMT2R630y1BlBkczMNzCHl51zdAiXoXiisdUHpsQ120e9W5vAtcdxp/YXSckRGQpJgN7Go3GuSxvAVdAwLFI4uPtZfBmPySCZTao3hK+e3bVRgQjlQROHGkVIJcYQ2r5BLH7rTHuFsB9kmFErOfIs0FJtB6AuAD9hbMpY4E8mO6SeMKraje7CfyaFfT8fIuEugd6UzKUT4nKOusYgDGXlbAoxJhu35wFrZt9rQ8n+RcyL4erP8Gmu7Kr1mrGUl9ZQheMa7wNnXfzyYMPuElkYi93ZsAyHNgTFp0zr4bQpifZyqRck1FAjxlzhzNCnuT/kIgVjg7uflB6YBwPaQ/zV+rtJi7Lzx2kgvzDmbek1jLS/A0R+Ga/B5lmo455+ok1FHURU8vMMwWF2PBwzR6GuWOC6Y9aDT25lOKdYYUtGfXitM+nfAdzmmNdrb1k2+2+g4KUeIOR8W7Lh6C1srkhcY8LKhiF1ww0R/MxJPQmViPJmlAQ8b8+lV1dGgVLywubgkPAT1YKv3HGPED9bdlyRfP6Qy/bCvIJM+B7BH+QhLYBKGPLQsDdKd4dCZhMhhjND/CJCjPjqes80rXGFk7b8F141qjTqrPgfnSP/qr+6oHP/wYwUHKPOUT6Bgc1nlRcgXWdArkYaJ0RvtL6P1rOmRR3nrUxMnqyarZXfqJvFpKpBHcDAZWg5Ii12RmvpgyG2AjBgAgMLu7nQbTrepLa1ZV/oGapWwSMrQCFiFLEF6Q/6pjw+PDzoDVyQokrBdel/xgoQ780a0n0ylRL/NMebCxDDe0wpbJKmw0BqLLUS+Jy/dMSQX4cRLCHa3z0oFi8RbSnTaKghlE58j6awNImLfhXGLs1eG8chJY4VvcdF33fKkb8QVgwQG9OuKHEl4Flhg80qHxbYdyij1yIy0Ay/23vBwOrkSTHsJnZAslWU5+dxAZ7UaYVj7G9f/tDOgWZ9PnsXZNmwQt8pSmukst4YTtsW0BmEOuhAjhGelfEOXft4tArRZO4CIQEhcKh7cUPqJ8xvdU6CHoDv8AVYVaqy2vaaizNaf7J5ZEDyx3hZfhBYg7FfbTmjCMMdYBGlcCVbGnmvHLHn+UozcF7SqmoW3mIm82JAs+4fz3LOagoc714xUOHFUSpxu0BXhRDDdfI40u3UlpJo7b1nzQOIIub3V//TyesMbrrnKyXYWqgdb357oWhh7zM8RKZXFSBeiL7JT3JSymUuWG5eRhd1zkAlrux6IqQ9ak9oOgH1bE7BaEmfj7qAT1SOJRDof1vkOjqBr61SAeQ0KNFzVhqGZR0dZKEyaVERzPAIa1j2EyXl2b1Q3Epb2ClJb6Cuz9ghMNZ3JKk/xCoUfCn9Q+FxEOd3xTU+DYnWkwR7tzrXtZRBYtnMbvOgZktLGlq2+hYDyA4YffnffGayIuq4YgTyVO0w7xuJGc2U4RG5sf7Rp4Zhqbg+JJRcx7SF9hxBCp6iFo3zW9urFq9qAkylrA5C7h3WvNQpIbMjAECEO5KAI76pJwXUyOVyCgpbXzc7d/Z0S1n620s/RfTQxc1uz4JidoUND7nR2fWGOOY/hFovBy/eReL5rlSigLZ4mWThWJKUgcBGo2QcWlNhAXLgOHwT13fPtzNXeWYi+gKO36HMXMIDHgTdpK6kXcs8O9350RQTNCpRSay2iWMX0WriLHPqdXuydHdRmN+Hr5lW5pa15OKhXWEIwEmHsUWK83UhGXqonEOTmNmOX/hfWjYB7sMSL9D5J3PKbyfbLdrzAYWj9FnLbVIeGeG45k7qstZ64Bgl0BES6Cn8rp7/b0nHxi3seMW9pkitB3ysBeDqnAgRlc4XZD7otz4chAUPrGQk2b5rjsQCCrTpAvaHoha2IFHjGuulZy44sQVTmd7pZGGPdy3WW07M0gKgDTYoOp7XZ6UklKhB935MfvDmJlxPS+cz34wXNjmPIPYf6bCnjsswORdHbuRFOqNM6+/QkM49aYM3OrHdjt79L+EqrpxuxvxNwMo1cBK/7uItTkqd/8W/qLLc8wyNaI/0XpN9r9VSaoNJ+e70oKvrRYptEDjB9m4Z/Z/HH1NsX2LeG6tq/aJ9u/JVOxvRgQQnRArtZUUa278XCpe1Gpp9iSIjdLa0NB9UIG2vF+iwDH/ss28ZHs0XN+LZ7pG1wIa/3C03vrxWad+aZtrc9Evw+Zyl1i1D4oRV9DiCi2Z49IRQpFJL+FBaEP4b0xGPxF6VMfMb4ZYHm8gFWMG4eDymUkPEemBN5JQq6mXrNKO3IWe5SQdUUhsPUFnbLyNz+pDCiRbgDF+u3cE0T0pQjABXZqJmQHki9uIuB38Q+P10Wt6KEFEfsrMkBaxrXZ7jTRL2ozGWJGaMuUZ/LW2Q2URUZ7uYooZi/B0p6Ut5mqdwuTFxagmL024AOhINywC2agEKCuxUhDTDaVZA+SkeISKz0Q7PyaY8068NHFJdKmPmVAG/jtQMjrvQFeL+mebRfgre11wxrZ5t2XeWiVi+a3d77pQZY3Ql9Ul+kFEwtcianL/4r1wB6wQ8kX5hNfZ3bDVv7PzKEt/vYG+dSfktTS2JxtSfslguDc+9w17wTWlCnXMs4+5ITJx+d93a62UpUFdgWej9su2E6thlIO4uftxUBYpxSPefuiQtN3ywzNp+WX6PfzZU/wAAASLUmDIGMnW5lN7cL5XzQazylEoLLytmQOy0FzjLHZlFMm2j/yOQD3la8pa2mcMFu2HsHmRyLk5ny+D9flkc8rDDU6m3mBbcOxAYH9l9SZFpwSZ+XgJqyB8AEYdoY2lggNzw/zg7jMd7P2oF1ta2gwcrdF6FkXZ2g/lTfYXwOWAz1tIAsKJmuAGRwNIPes24jHIinn+QI6TiWGLCXw4YWBN6qWuC4CVSVHW7HoOl9jC5EqzWp3Gc3xF7P/TiYszqb7fbRF3vkvKsATEwT8n92BIFK1qnPfhXmb/JpTaIlrw8WBsXx0QMBy2pPr7+1+Bg67e49YPmmRGQ9+ipPFbYxNCOuSi2YTj+6WkBIe+zQp/nDWb1xRH797+HQNp06zkivB+r/Uft5yTPGbh05M/bhYliPWVLzFUqKU3bR+XNEpiwQl3cGGvw6C0="
                    }
                  ],
                  "role": "model"
                },
                "finishReason": "STOP",
                "index": 0
              }
            ],
            "usageMetadata": {
              "promptTokenCount": 1005,
              "candidatesTokenCount": 1646,
              "totalTokenCount": 4485,
              "promptTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 1005
                }
              ],
              "thoughtsTokenCount": 1834
            },
            "modelVersion": "gemini-3-flash-preview",
            "responseId": "qw-lac2YHPGyqtsPzoDHiQo"
          },
          "cached": false,
          "metadata": {}
        },
        "score": 0.9037999999999999,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.02600675,
        "gradingResult": {
          "pass": true,
          "score": 0.9662999999999999,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2185,
            "prompt": 1682,
            "completion": 503,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9826,
              "reason": "change_detection=1.00 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=1.00 | property_extraction=0.93",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.95,
              "reason": "The output meets all 7 critical evaluation criteria:\n\n1. **All 5 entities identified**: Billy (character:billy), Jane (character:jane), dock (location:harbor_dock), oar (prop:oar), envelope (prop:envelope) — all present.\n\n2. **Billy's costume correctly extracted**: 'leather jacket zipped against the wind' — correct.\n\n3. **Billy's costume CHANGE detected**: Change event from 'faded flannel shirt and worn jeans' to 'leather jacket zipped against the wind' with explicit evidence quote from the scene text — correctly captured.\n\n4. **Jane's rain jacket and sealed envelope noted**: Jane's costume is 'rain jacket' (confidence 0.95) and she holds a 'sealed envelope' (confidence 0.95) — both correct.\n\n5. **Billy's flat/resigned emotional state captured**: Listed as 'flat/detached; possibly guarded' with confidence 0.85, with a change event from 'tense, jaw tight' to 'flat/detached' supported by the dialogue evidence '(flat) I'm always late.' — well captured.\n\n6. **Change events supported by scene text quotes**: All change events include evidence fields with actual quoted text from the scene (e.g., 'BILLY walks along the dock, leather jacket zipped against the wind.', 'She holds a sealed ENVELOPE.', 'He sets the OAR against a piling', etc.) — strong evidence support throughout.\n\n7. **Confidence scores reasonable**: Explicit text items get 0.9-0.95, inferred items like physical condition get 0.6, emotional state gets 0.85 (parenthetical direction makes it semi-explicit), weather inferred from wardrobe gets 0.8 — all reasonable and well-calibrated.\n\nAdditionally, the oar tracking is excellent — it captures the position change from Billy's right hand to being set against a piling, with explicit evidence. The output goes beyond simple state descriptions to capture meaningful state transitions with evidence, which is exactly what good continuity extraction requires.",
              "tokensUsed": {
                "total": 2185,
                "prompt": 1682,
                "completion": 503,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n{\\\"scene_id\\\":\\\"scene_002\\\",\\\"entity_states\\\":[{\\\"entity_key\\\":\\\"character:billy\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"leather jacket zipped against the wind (over other clothes not specified)\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"physical_condition\\\",\\\"value\\\":\\\"no visible injuries noted\\\",\\\"confidence\\\":0.6},{\\\"key\\\":\\\"emotional_state\\\",\\\"value\\\":\\\"flat/detached; possibly guarded\\\",\\\"confidence\\\":0.85},{\\\"key\\\":\\\"props_carried\\\",\\\"value\\\":\\\"holding an oar in his right hand (briefly), then not carrying it after setting it against a piling; reaching for an envelope\\\",\\\"confidence\\\":0.9}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"costume\\\",\\\"previous_value\\\":\\\"faded flannel shirt and worn jeans\\\",\\\"new_value\\\":\\\"leather jacket zipped against the wind (over other clothes not specified)\\\",\\\"reason\\\":\\\"wardrobe differs from prior scene description\\\",\\\"evidence\\\":\\\"BILLY walks along the dock, leather jacket zipped against the wind.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9},{\\\"property_key\\\":\\\"emotional_state\\\",\\\"previous_value\\\":\\\"tense, jaw tight\\\",\\\"new_value\\\":\\\"flat/detached\\\",\\\"reason\\\":\\\"dialogue indicates a flatter affect than previously described tension\\\",\\\"evidence\\\":\\\"BILLY\\\\n(flat)\\\\nI'm always late.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.85}],\\\"confidence\\\":0.86},{\\\"entity_key\\\":\\\"character:jane\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"rain jacket\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"physical_condition\\\",\\\"value\\\":\\\"no visible injuries noted\\\",\\\"confidence\\\":0.6},{\\\"key\\\":\\\"emotional_state\\\",\\\"value\\\":\\\"impatient/accusatory\\\",\\\"confidence\\\":0.8},{\\\"key\\\":\\\"props_carried\\\",\\\"value\\\":\\\"holding a sealed envelope\\\",\\\"confidence\\\":0.95}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"costume\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"rain jacket\\\",\\\"reason\\\":\\\"first appearance\\\",\\\"evidence\\\":\\\"He spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95},{\\\"property_key\\\":\\\"props_carried\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"sealed envelope\\\",\\\"reason\\\":\\\"first appearance\\\",\\\"evidence\\\":\\\"She holds a sealed ENVELOPE.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95}],\\\"confidence\\\":0.83},{\\\"entity_key\\\":\\\"location:harbor_dock\\\",\\\"properties\\\":[{\\\"key\\\":\\\"lighting\\\",\\\"value\\\":\\\"daylight\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"time_of_day\\\",\\\"value\\\":\\\"day\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"weather\\\",\\\"value\\\":\\\"windy\\\",\\\"confidence\\\":0.8},{\\\"key\\\":\\\"damage_or_changes\\\",\\\"value\\\":\\\"no damage noted\\\",\\\"confidence\\\":0.6},{\\\"key\\\":\\\"atmosphere\\\",\\\"value\\\":\\\"brisk/tense waiting at the dock by a boat\\\",\\\"confidence\\\":0.65}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"time_of_day\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"day\\\",\\\"reason\\\":\\\"first appearance; slugline sets time\\\",\\\"evidence\\\":\\\"EXT. HARBOR DOCK - DAY\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95},{\\\"property_key\\\":\\\"weather\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"windy\\\",\\\"reason\\\":\\\"implied by wardrobe choice against wind\\\",\\\"evidence\\\":\\\"leather jacket zipped against the wind.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.8}],\\\"confidence\\\":0.8},{\\\"entity_key\\\":\\\"prop:oar\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"weathered oak with a rope-wrapped grip; intact\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"initially in Billy's right hand; then set against a piling\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"Billy's father's (in Billy's possession at scene start)\\\",\\\"confidence\\\":0.95}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"weathered oak with a rope-wrapped grip; intact\\\",\\\"reason\\\":\\\"first appearance\\\",\\\"evidence\\\":\\\"The OAR — his father's, weathered oak with a rope-wrapped grip —\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95},{\\\"property_key\\\":\\\"position\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"in Billy's right hand (like a walking stick)\\\",\\\"reason\\\":\\\"first appearance placement\\\",\\\"evidence\\\":\\\"rests in his right hand like a walking stick.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95},{\\\"property_key\\\":\\\"position\\\",\\\"previous_value\\\":\\\"in Billy's right hand (like a walking stick)\\\",\\\"new_value\\\":\\\"set against a piling\\\",\\\"reason\\\":\\\"Billy sets it down/leans it against piling\\\",\\\"evidence\\\":\\\"He sets the OAR against a piling\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95}],\\\"confidence\\\":0.9},{\\\"entity_key\\\":\\\"prop:envelope\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"sealed; intact\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"in Jane's hand (as she waits by the boat); Billy reaches for it\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"currently held by Jane\\\",\\\"confidence\\\":0.9}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"sealed; intact\\\",\\\"reason\\\":\\\"first appearance\\\",\\\"evidence\\\":\\\"She holds a sealed ENVELOPE.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95},{\\\"property_key\\\":\\\"position\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"held by Jane\\\",\\\"reason\\\":\\\"first appearance placement\\\",\\\"evidence\\\":\\\"She holds a sealed ENVELOPE.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95}],\\\"confidence\\\":0.88}]}\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "0bb0474b-4a37-4b38-9fdd-dd8df41504c4",
        "latencyMs": 16421,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 9,
        "provider": {
          "id": "openai:gpt-5.2",
          "label": "GPT-5.2"
        },
        "response": {
          "output": "{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped against the wind (over other clothes not specified)\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"no visible injuries noted\",\n          \"confidence\": 0.6\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat/detached; possibly guarded\",\n          \"confidence\": 0.85\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"holding an oar in his right hand (briefly), then not carrying it after setting it against a piling; reaching for an envelope\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped against the wind (over other clothes not specified)\",\n          \"reason\": \"wardrobe differs from prior scene description\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat/detached\",\n          \"reason\": \"dialogue indicates a flatter affect than previously described tension\",\n          \"evidence\": \"BILLY\\n(flat)\\nI'm always late.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.85\n        }\n      ],\n      \"confidence\": 0.86\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"no visible injuries noted\",\n          \"confidence\": 0.6\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"impatient/accusatory\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"holding a sealed envelope\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": null,\n          \"new_value\": \"rain jacket\",\n          \"reason\": \"first appearance\",\n          \"evidence\": \"He spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed envelope\",\n          \"reason\": \"first appearance\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.83\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"daylight\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"day\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"no damage noted\",\n          \"confidence\": 0.6\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"brisk/tense waiting at the dock by a boat\",\n          \"confidence\": 0.65\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": null,\n          \"new_value\": \"day\",\n          \"reason\": \"first appearance; slugline sets time\",\n          \"evidence\": \"EXT. HARBOR DOCK - DAY\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": null,\n          \"new_value\": \"windy\",\n          \"reason\": \"implied by wardrobe choice against wind\",\n          \"evidence\": \"leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.8\n        }\n      ],\n      \"confidence\": 0.8\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak with a rope-wrapped grip; intact\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"initially in Billy's right hand; then set against a piling\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy's father's (in Billy's possession at scene start)\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"weathered oak with a rope-wrapped grip; intact\",\n          \"reason\": \"first appearance\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip —\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"in Billy's right hand (like a walking stick)\",\n          \"reason\": \"first appearance placement\",\n          \"evidence\": \"rests in his right hand like a walking stick.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"in Billy's right hand (like a walking stick)\",\n          \"new_value\": \"set against a piling\",\n          \"reason\": \"Billy sets it down/leans it against piling\",\n          \"evidence\": \"He sets the OAR against a piling\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed; intact\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"in Jane's hand (as she waits by the boat); Billy reaches for it\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"currently held by Jane\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed; intact\",\n          \"reason\": \"first appearance\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"held by Jane\",\n          \"reason\": \"first appearance placement\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.88\n    }\n  ]\n}",
          "tokenUsage": {
            "total": 2660,
            "prompt": 917,
            "completion": 1743,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cached": false,
          "latencyMs": 16421,
          "finishReason": "stop",
          "cost": 0.02600675,
          "guardrails": {
            "flagged": false
          },
          "metadata": {
            "http": {
              "status": 200,
              "statusText": "OK",
              "headers": {
                "access-control-expose-headers": "X-Request-ID",
                "alt-svc": "h3=\":443\"; ma=86400",
                "cf-cache-status": "DYNAMIC",
                "cf-ray": "9d5d998f3ffd1b5b-YVR",
                "connection": "keep-alive",
                "content-encoding": "br",
                "content-type": "application/json",
                "date": "Mon, 02 Mar 2026 04:19:07 GMT",
                "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
                "openai-processing-ms": "16169",
                "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
                "openai-version": "2020-10-01",
                "server": "cloudflare",
                "set-cookie": "__cf_bm=HGKYjjBG1vbiMb.HOdasYxTsqB01B4PY5gmF2EIQUt8-1772425131.394088-1.0.1.1-LTvKihfzeAjUpwRo_gQqLAJwAyJWP4o38wdaBkaX7tWItoNBk6N2ERdX0zD3jwREXTKhtu_GauqvOi37.A8c6s867vZn.EbvE4qvbX1FtNcSQ2ANeuy3NxLvmlSWBMRn; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:49:07 GMT",
                "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
                "transfer-encoding": "chunked",
                "x-content-type-options": "nosniff",
                "x-openai-proxy-wasm": "v0.1",
                "x-ratelimit-limit-requests": "10000",
                "x-ratelimit-limit-tokens": "4000000",
                "x-ratelimit-remaining-requests": "9999",
                "x-ratelimit-remaining-tokens": "3999096",
                "x-ratelimit-reset-requests": "6ms",
                "x-ratelimit-reset-tokens": "13ms",
                "x-request-id": "req_e07a178325664247ac2b092338ac76be"
              }
            }
          }
        },
        "score": 0.9662999999999999,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "http": {
            "status": 200,
            "statusText": "OK",
            "headers": {
              "access-control-expose-headers": "X-Request-ID",
              "alt-svc": "h3=\":443\"; ma=86400",
              "cf-cache-status": "DYNAMIC",
              "cf-ray": "9d5d998f3ffd1b5b-YVR",
              "connection": "keep-alive",
              "content-encoding": "br",
              "content-type": "application/json",
              "date": "Mon, 02 Mar 2026 04:19:07 GMT",
              "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
              "openai-processing-ms": "16169",
              "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
              "openai-version": "2020-10-01",
              "server": "cloudflare",
              "set-cookie": "__cf_bm=HGKYjjBG1vbiMb.HOdasYxTsqB01B4PY5gmF2EIQUt8-1772425131.394088-1.0.1.1-LTvKihfzeAjUpwRo_gQqLAJwAyJWP4o38wdaBkaX7tWItoNBk6N2ERdX0zD3jwREXTKhtu_GauqvOi37.A8c6s867vZn.EbvE4qvbX1FtNcSQ2ANeuy3NxLvmlSWBMRn; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:49:07 GMT",
              "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
              "transfer-encoding": "chunked",
              "x-content-type-options": "nosniff",
              "x-openai-proxy-wasm": "v0.1",
              "x-ratelimit-limit-requests": "10000",
              "x-ratelimit-limit-tokens": "4000000",
              "x-ratelimit-remaining-requests": "9999",
              "x-ratelimit-remaining-tokens": "3999096",
              "x-ratelimit-reset-requests": "6ms",
              "x-ratelimit-reset-tokens": "13ms",
              "x-request-id": "req_e07a178325664247ac2b092338ac76be"
            }
          },
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.062490000000000004,
        "gradingResult": {
          "pass": true,
          "score": 0.9613,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 3231,
            "prompt": 2725,
            "completion": 506,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9726,
              "reason": "change_detection=1.00 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=0.90 | property_extraction=0.93 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.95,
              "reason": "The output meets all 7 critical evaluation criteria:\n\n1. **All 5 entities identified**: Billy (character:billy), Jane (character:jane), dock (location:harbor_dock), oar (prop:oar), envelope (prop:envelope) — all present.\n\n2. **Billy's costume correctly extracted**: Listed as 'leather jacket, zipped up' with confidence 1.0.\n\n3. **Billy's costume CHANGE detected**: A change_event explicitly tracks the transition from 'faded flannel shirt and worn jeans' to 'leather jacket, zipped up' with clear reasoning and direct evidence quote ('BILLY walks along the dock, leather jacket zipped against the wind.').\n\n4. **Jane's rain jacket and sealed envelope noted**: Jane's costume is 'rain jacket' (confidence 1.0), and the envelope is described as 'sealed, intact' (confidence 1.0), both with supporting evidence quotes.\n\n5. **Billy's flat/resigned emotional state captured**: Listed as 'flat, detached' with a change from 'tense, jaw tight', supported by the evidence '(flat) I'm always late.' — this captures the resigned tone well.\n\n6. **Change events supported by actual scene text quotes**: Every change_event includes an 'evidence' field with what appear to be direct quotes from the screenplay text (e.g., 'leather jacket zipped against the wind', 'She holds a sealed ENVELOPE', 'He sets the OAR against a piling and reaches for the envelope').\n\n7. **Confidence scores are reasonable**: Explicit text descriptions get 1.0 (costume, props), while inferred states get lower scores (emotional_state at 0.85, weather at 0.8, atmosphere at 0.75). This is a sensible calibration.\n\nThe extraction goes beyond just current state descriptions — it actively tracks state changes with previous values, reasons, and evidence. The oar's position change (carried → set against piling) and the envelope's ownership transition (Jane → Billy) are also well-captured. The structure is thorough and well-organized.",
              "tokensUsed": {
                "total": 3231,
                "prompt": 2725,
                "completion": 506,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_002\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\\"key\\\": \\\"costume\\\", \\\"value\\\": \\\"leather jacket, zipped up\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"emotional_state\\\", \\\"value\\\": \\\"flat, detached\\\", \\\"confidence\\\": 0.85},\\n        {\\\"key\\\": \\\"props_carried\\\", \\\"value\\\": \\\"OAR in right hand (beginning); sets OAR down and reaches for ENVELOPE (end)\\\", \\\"confidence\\\": 1.0}\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"faded flannel shirt and worn jeans\\\",\\n          \\\"new_value\\\": \\\"leather jacket, zipped up\\\",\\n          \\\"reason\\\": \\\"Billy has changed clothing between scenes, now wearing a leather jacket against the wind\\\",\\n          \\\"evidence\\\": \\\"BILLY walks along the dock, leather jacket zipped against the wind.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"tense, jaw tight\\\",\\n          \\\"new_value\\\": \\\"flat, detached\\\",\\n          \\\"reason\\\": \\\"Billy's demeanor has shifted from tense to a flat, emotionally guarded affect\\\",\\n          \\\"evidence\\\": \\\"(flat)\\\\nI'm always late.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.85\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"OAR in right hand; then sets OAR down and reaches for ENVELOPE\\\",\\n          \\\"reason\\\": \\\"Billy carries the oar onto the dock, then sets it against a piling to take the envelope\\\",\\n          \\\"evidence\\\": \\\"rests in his right hand like a walking stick. ... He sets the OAR against a piling and reaches for the envelope.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.93\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"character:jane\\\",\\n      \\\"properties\\\": [\\n        {\\\"key\\\": \\\"costume\\\", \\\"value\\\": \\\"rain jacket\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"physical_condition\\\", \\\"value\\\": \\\"no visible injuries or changes noted\\\", \\\"confidence\\\": 0.6},\\n        {\\\"key\\\": \\\"emotional_state\\\", \\\"value\\\": \\\"impatient, direct\\\", \\\"confidence\\\": 0.75},\\n        {\\\"key\\\": \\\"props_carried\\\", \\\"value\\\": \\\"sealed ENVELOPE (held at start; Billy reaches for it at end)\\\", \\\"confidence\\\": 1.0}\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"rain jacket\\\",\\n          \\\"reason\\\": \\\"First appearance — costume established\\\",\\n          \\\"evidence\\\": \\\"JANE (30s, sharp eyes, rain jacket) waiting by the boat.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"impatient, direct\\\",\\n          \\\"reason\\\": \\\"First appearance — her opening line and description suggest impatience\\\",\\n          \\\"evidence\\\": \\\"You're late.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.75\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"sealed ENVELOPE\\\",\\n          \\\"reason\\\": \\\"First appearance — she is holding the envelope\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.90\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\\"key\\\": \\\"time_of_day\\\", \\\"value\\\": \\\"day\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"weather\\\", \\\"value\\\": \\\"windy, possibly overcast/rainy conditions implied\\\", \\\"confidence\\\": 0.8},\\n        {\\\"key\\\": \\\"lighting\\\", \\\"value\\\": \\\"natural daylight, exterior\\\", \\\"confidence\\\": 0.9},\\n        {\\\"key\\\": \\\"atmosphere\\\", \\\"value\\\": \\\"exposed, windswept, tense meeting spot\\\", \\\"confidence\\\": 0.8},\\n        {\\\"key\\\": \\\"damage_or_changes\\\", \\\"value\\\": \\\"no damage noted; dock has pilings and a boat moored nearby\\\", \\\"confidence\\\": 0.85}\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"time_of_day\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"day\\\",\\n          \\\"reason\\\": \\\"First appearance — slug line establishes DAY\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - DAY\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"windy, possibly rainy\\\",\\n          \\\"reason\\\": \\\"First appearance — wind mentioned explicitly; rain jacket suggests rain possible\\\",\\n          \\\"evidence\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.8\\n        },\\n        {\\n          \\\"property_key\\\": \\\"atmosphere\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"exposed, windswept, tense\\\",\\n          \\\"reason\\\": \\\"First appearance — inferred from wind, curt dialogue, and setting\\\",\\n          \\\"evidence\\\": \\\"leather jacket zipped against the wind. ... You're late.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.75\\n        }\\n      ],\\n      \\\"confidence\\\": 0.85\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\\"key\\\": \\\"condition\\\", \\\"value\\\": \\\"weathered oak with rope-wrapped grip; intact\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"position\\\", \\\"value\\\": \\\"leaning against a piling on the dock (end of scene)\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"ownership\\\", \\\"value\\\": \\\"Billy's (inherited from his father)\\\", \\\"confidence\\\": 1.0}\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"weathered oak with rope-wrapped grip; intact\\\",\\n          \\\"reason\\\": \\\"First appearance — described in detail\\\",\\n          \\\"evidence\\\": \\\"The OAR — his father's, weathered oak with a rope-wrapped grip —\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"set against a piling on the dock\\\",\\n          \\\"reason\\\": \\\"First appearance — Billy carries it then sets it down\\\",\\n          \\\"evidence\\\": \\\"He sets the OAR against a piling and reaches for the envelope.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"ownership\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Billy (his father's oar)\\\",\\n          \\\"reason\\\": \\\"First appearance — ownership established\\\",\\n          \\\"evidence\\\": \\\"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\\"key\\\": \\\"condition\\\", \\\"value\\\": \\\"sealed, intact\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"position\\\", \\\"value\\\": \\\"being reached for by Billy (transitioning from Jane to Billy)\\\", \\\"confidence\\\": 0.9},\\n        {\\\"key\\\": \\\"ownership\\\", \\\"value\\\": \\\"held by Jane; Billy reaching for it at end of scene\\\", \\\"confidence\\\": 1.0}\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"sealed, intact\\\",\\n          \\\"reason\\\": \\\"First appearance — described as sealed\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"in Jane's hands, Billy reaching for it\\\",\\n          \\\"reason\\\": \\\"First appearance — Jane holds it, then Billy reaches for it\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE. ... He sets the OAR against a piling and reaches for the envelope.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"ownership\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Jane (transferring to Billy)\\\",\\n          \\\"reason\\\": \\\"First appearance — Jane holds it; Billy is reaching to take it\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE. ... reaches for the envelope.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"confidence\\\": 0.92\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "c05f46a2-836c-4a84-9833-79e935e59087",
        "latencyMs": 26880,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 10,
        "provider": {
          "id": "anthropic:messages:claude-opus-4-6",
          "label": "Claude Opus 4.6"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"leather jacket, zipped up\", \"confidence\": 1.0},\n        {\"key\": \"emotional_state\", \"value\": \"flat, detached\", \"confidence\": 0.85},\n        {\"key\": \"props_carried\", \"value\": \"OAR in right hand (beginning); sets OAR down and reaches for ENVELOPE (end)\", \"confidence\": 1.0}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket, zipped up\",\n          \"reason\": \"Billy has changed clothing between scenes, now wearing a leather jacket against the wind\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat, detached\",\n          \"reason\": \"Billy's demeanor has shifted from tense to a flat, emotionally guarded affect\",\n          \"evidence\": \"(flat)\\nI'm always late.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.85\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"OAR in right hand; then sets OAR down and reaches for ENVELOPE\",\n          \"reason\": \"Billy carries the oar onto the dock, then sets it against a piling to take the envelope\",\n          \"evidence\": \"rests in his right hand like a walking stick. ... He sets the OAR against a piling and reaches for the envelope.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.93\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"rain jacket\", \"confidence\": 1.0},\n        {\"key\": \"physical_condition\", \"value\": \"no visible injuries or changes noted\", \"confidence\": 0.6},\n        {\"key\": \"emotional_state\", \"value\": \"impatient, direct\", \"confidence\": 0.75},\n        {\"key\": \"props_carried\", \"value\": \"sealed ENVELOPE (held at start; Billy reaches for it at end)\", \"confidence\": 1.0}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": null,\n          \"new_value\": \"rain jacket\",\n          \"reason\": \"First appearance — costume established\",\n          \"evidence\": \"JANE (30s, sharp eyes, rain jacket) waiting by the boat.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": null,\n          \"new_value\": \"impatient, direct\",\n          \"reason\": \"First appearance — her opening line and description suggest impatience\",\n          \"evidence\": \"You're late.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.75\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed ENVELOPE\",\n          \"reason\": \"First appearance — she is holding the envelope\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.90\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\"key\": \"time_of_day\", \"value\": \"day\", \"confidence\": 1.0},\n        {\"key\": \"weather\", \"value\": \"windy, possibly overcast/rainy conditions implied\", \"confidence\": 0.8},\n        {\"key\": \"lighting\", \"value\": \"natural daylight, exterior\", \"confidence\": 0.9},\n        {\"key\": \"atmosphere\", \"value\": \"exposed, windswept, tense meeting spot\", \"confidence\": 0.8},\n        {\"key\": \"damage_or_changes\", \"value\": \"no damage noted; dock has pilings and a boat moored nearby\", \"confidence\": 0.85}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": null,\n          \"new_value\": \"day\",\n          \"reason\": \"First appearance — slug line establishes DAY\",\n          \"evidence\": \"EXT. HARBOR DOCK - DAY\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": null,\n          \"new_value\": \"windy, possibly rainy\",\n          \"reason\": \"First appearance — wind mentioned explicitly; rain jacket suggests rain possible\",\n          \"evidence\": \"leather jacket zipped against the wind\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        },\n        {\n          \"property_key\": \"atmosphere\",\n          \"previous_value\": null,\n          \"new_value\": \"exposed, windswept, tense\",\n          \"reason\": \"First appearance — inferred from wind, curt dialogue, and setting\",\n          \"evidence\": \"leather jacket zipped against the wind. ... You're late.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.75\n        }\n      ],\n      \"confidence\": 0.85\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\"key\": \"condition\", \"value\": \"weathered oak with rope-wrapped grip; intact\", \"confidence\": 1.0},\n        {\"key\": \"position\", \"value\": \"leaning against a piling on the dock (end of scene)\", \"confidence\": 1.0},\n        {\"key\": \"ownership\", \"value\": \"Billy's (inherited from his father)\", \"confidence\": 1.0}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"weathered oak with rope-wrapped grip; intact\",\n          \"reason\": \"First appearance — described in detail\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip —\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"set against a piling on the dock\",\n          \"reason\": \"First appearance — Billy carries it then sets it down\",\n          \"evidence\": \"He sets the OAR against a piling and reaches for the envelope.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": null,\n          \"new_value\": \"Billy (his father's oar)\",\n          \"reason\": \"First appearance — ownership established\",\n          \"evidence\": \"The OAR — his father's, weathered oak with a rope-wrapped grip — rests in his right hand\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\"key\": \"condition\", \"value\": \"sealed, intact\", \"confidence\": 1.0},\n        {\"key\": \"position\", \"value\": \"being reached for by Billy (transitioning from Jane to Billy)\", \"confidence\": 0.9},\n        {\"key\": \"ownership\", \"value\": \"held by Jane; Billy reaching for it at end of scene\", \"confidence\": 1.0}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed, intact\",\n          \"reason\": \"First appearance — described as sealed\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"in Jane's hands, Billy reaching for it\",\n          \"reason\": \"First appearance — Jane holds it, then Billy reaches for it\",\n          \"evidence\": \"She holds a sealed ENVELOPE. ... He sets the OAR against a piling and reaches for the envelope.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": null,\n          \"new_value\": \"Jane (transferring to Billy)\",\n          \"reason\": \"First appearance — Jane holds it; Billy is reaching to take it\",\n          \"evidence\": \"She holds a sealed ENVELOPE. ... reaches for the envelope.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.92\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "total": 3286,
            "prompt": 983,
            "completion": 2303
          },
          "finishReason": "stop",
          "cost": 0.062490000000000004
        },
        "score": 0.9613,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.059236250000000004,
        "gradingResult": {
          "pass": true,
          "score": 0.9411,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2916,
            "prompt": 2389,
            "completion": 527,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9322,
              "reason": "change_detection=1.00 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=0.80 | json_valid=0.90 | property_extraction=0.89 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.95,
              "reason": "The output meets all 7 critical evaluation criteria:\n\n1. **All 5 entities identified**: Billy (character:billy), Jane (character:jane), dock (location:harbor_dock), oar (prop:oar), envelope (prop:envelope) — all present.\n\n2. **Billy's costume correctly extracted**: 'leather jacket zipped, worn jeans' — correct.\n\n3. **Billy's costume CHANGE detected**: The change_events for costume show previous_value 'faded flannel shirt and worn jeans' → new_value 'leather jacket zipped, worn jeans' with clear reasoning and evidence quote ('BILLY walks along the dock, leather jacket zipped against the wind.') — excellent continuity tracking.\n\n4. **Jane's rain jacket and sealed envelope noted**: Jane's costume is 'rain jacket' and she carries a 'sealed ENVELOPE' — both correctly captured with evidence.\n\n5. **Billy's flat/resigned emotional state captured**: emotional_state is 'flat, resigned' with evidence '(flat)' and the change from 'tense, jaw tight' is tracked.\n\n6. **Change events supported by scene text quotes**: All change_events include evidence fields with actual quoted text from the scene (e.g., 'BILLY walks along the dock, leather jacket zipped against the wind', 'JANE (30s, sharp eyes, rain jacket)', 'She holds a sealed ENVELOPE', 'rests in his right hand... He sets the OAR against a piling').\n\n7. **Confidence scores reasonable**: Explicit text gets 1.0 (costume, props), inferred states get lower scores (emotional_state at 0.8-0.9, weather at 0.9, atmosphere at 0.7) — well-calibrated.\n\nAdditionally, the output goes beyond minimum requirements by tracking the oar's position change within the scene (hand → piling), Billy's props_carried change, and the weather inference from character action. The structure is clean and well-organized. The only minor note is that Billy's props_carried end-state says 'None (at end of scene)' which is slightly informal but accurate since he set the oar down.",
              "tokensUsed": {
                "total": 2916,
                "prompt": 2389,
                "completion": 527,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_002\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket zipped, worn jeans\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"flat, resigned\\\",\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"None (at end of scene)\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"faded flannel shirt and worn jeans\\\",\\n          \\\"new_value\\\": \\\"leather jacket zipped, worn jeans\\\",\\n          \\\"reason\\\": \\\"Billy has changed his shirt/outerwear from a flannel to a leather jacket.\\\",\\n          \\\"evidence\\\": \\\"BILLY walks along the dock, leather jacket zipped against the wind.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"tense, jaw tight\\\",\\n          \\\"new_value\\\": \\\"flat, resigned\\\",\\n          \\\"reason\\\": \\\"His demeanor has shifted from tense to a more subdued, weary state.\\\",\\n          \\\"evidence\\\": \\\"(flat)\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"OAR\\\",\\n          \\\"reason\\\": \\\"Billy acquired his father's oar between scenes.\\\",\\n          \\\"evidence\\\": \\\"The OAR — his father's... rests in his right hand like a walking stick.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.97\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"character:jane\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"rain jacket\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"30s, sharp eyes\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"impatient, direct\\\",\\n          \\\"confidence\\\": 0.8\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"sealed ENVELOPE\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"rain jacket\\\",\\n          \\\"reason\\\": \\\"First appearance in the script.\\\",\\n          \\\"evidence\\\": \\\"JANE (30s, sharp eyes, rain jacket)\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"physical_condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"30s, sharp eyes\\\",\\n          \\\"reason\\\": \\\"First appearance in the script.\\\",\\n          \\\"evidence\\\": \\\"JANE (30s, sharp eyes, rain jacket)\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"impatient, direct\\\",\\n          \\\"reason\\\": \\\"First appearance in the script; inferred from dialogue.\\\",\\n          \\\"evidence\\\": \\\"JANE\\\\nYou're late.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.8\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"sealed ENVELOPE\\\",\\n          \\\"reason\\\": \\\"First appearance in the script.\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"Daylight\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"Day\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"Windy\\\",\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"Bleak, functional\\\",\\n          \\\"confidence\\\": 0.7\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"lighting\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Daylight\\\",\\n          \\\"reason\\\": \\\"First appearance in the script.\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - DAY\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Windy\\\",\\n          \\\"reason\\\": \\\"First appearance in the script; inferred from character action.\\\",\\n          \\\"evidence\\\": \\\"leather jacket zipped against the wind.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"confidence\\\": 0.9\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"Intact; weathered oak with a rope-wrapped grip\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"Resting against a piling\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Belongs to Billy's father; last held by Billy\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Initially in Billy's right hand, then set against a piling.\\\",\\n          \\\"reason\\\": \\\"First appearance. Its position is established and then changed within the scene.\\\",\\n          \\\"evidence\\\": \\\"rests in his right hand... He sets the OAR against a piling\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"Sealed\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"Held by Jane\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Jane\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Sealed\\\",\\n          \\\"reason\\\": \\\"First appearance in the script.\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"ownership\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Jane\\\",\\n          \\\"reason\\\": \\\"First appearance in the script.\\\",\\n          \\\"evidence\\\": \\\"She holds a sealed ENVELOPE.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "32fbe8b6-891f-4b7f-9218-5df7f84ff0cf",
        "latencyMs": 45048,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 11,
        "provider": {
          "id": "google:gemini-2.5-pro",
          "label": "Gemini 2.5 Pro"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped, worn jeans\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat, resigned\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"None (at end of scene)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped, worn jeans\",\n          \"reason\": \"Billy has changed his shirt/outerwear from a flannel to a leather jacket.\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat, resigned\",\n          \"reason\": \"His demeanor has shifted from tense to a more subdued, weary state.\",\n          \"evidence\": \"(flat)\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"OAR\",\n          \"reason\": \"Billy acquired his father's oar between scenes.\",\n          \"evidence\": \"The OAR — his father's... rests in his right hand like a walking stick.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.97\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"30s, sharp eyes\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"impatient, direct\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed ENVELOPE\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": null,\n          \"new_value\": \"rain jacket\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"JANE (30s, sharp eyes, rain jacket)\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"30s, sharp eyes\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"JANE (30s, sharp eyes, rain jacket)\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": null,\n          \"new_value\": \"impatient, direct\",\n          \"reason\": \"First appearance in the script; inferred from dialogue.\",\n          \"evidence\": \"JANE\\nYou're late.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed ENVELOPE\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"Daylight\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"Day\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"Windy\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"Bleak, functional\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": null,\n          \"new_value\": \"Daylight\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"EXT. HARBOR DOCK - DAY\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": null,\n          \"new_value\": \"Windy\",\n          \"reason\": \"First appearance in the script; inferred from character action.\",\n          \"evidence\": \"leather jacket zipped against the wind.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Intact; weathered oak with a rope-wrapped grip\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"Resting against a piling\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Belongs to Billy's father; last held by Billy\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"Initially in Billy's right hand, then set against a piling.\",\n          \"reason\": \"First appearance. Its position is established and then changed within the scene.\",\n          \"evidence\": \"rests in his right hand... He sets the OAR against a piling\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Sealed\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"Held by Jane\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"Sealed\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": null,\n          \"new_value\": \"Jane\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "prompt": 1005,
            "completion": 1953,
            "total": 6803,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 3845,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cost": 0.059236250000000004,
          "raw": {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped, worn jeans\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat, resigned\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"None (at end of scene)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped, worn jeans\",\n          \"reason\": \"Billy has changed his shirt/outerwear from a flannel to a leather jacket.\",\n          \"evidence\": \"BILLY walks along the dock, leather jacket zipped against the wind.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat, resigned\",\n          \"reason\": \"His demeanor has shifted from tense to a more subdued, weary state.\",\n          \"evidence\": \"(flat)\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"OAR\",\n          \"reason\": \"Billy acquired his father's oar between scenes.\",\n          \"evidence\": \"The OAR — his father's... rests in his right hand like a walking stick.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.97\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"30s, sharp eyes\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"impatient, direct\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed ENVELOPE\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": null,\n          \"new_value\": \"rain jacket\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"JANE (30s, sharp eyes, rain jacket)\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"30s, sharp eyes\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"JANE (30s, sharp eyes, rain jacket)\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": null,\n          \"new_value\": \"impatient, direct\",\n          \"reason\": \"First appearance in the script; inferred from dialogue.\",\n          \"evidence\": \"JANE\\nYou're late.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": null,\n          \"new_value\": \"sealed ENVELOPE\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"Daylight\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"Day\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"Windy\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"Bleak, functional\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": null,\n          \"new_value\": \"Daylight\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"EXT. HARBOR DOCK - DAY\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": null,\n          \"new_value\": \"Windy\",\n          \"reason\": \"First appearance in the script; inferred from character action.\",\n          \"evidence\": \"leather jacket zipped against the wind.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Intact; weathered oak with a rope-wrapped grip\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"Resting against a piling\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Belongs to Billy's father; last held by Billy\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"Initially in Billy's right hand, then set against a piling.\",\n          \"reason\": \"First appearance. Its position is established and then changed within the scene.\",\n          \"evidence\": \"rests in his right hand... He sets the OAR against a piling\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Sealed\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"Held by Jane\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": null,\n          \"new_value\": \"Sealed\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": null,\n          \"new_value\": \"Jane\",\n          \"reason\": \"First appearance in the script.\",\n          \"evidence\": \"She holds a sealed ENVELOPE.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```"
                    }
                  ],
                  "role": "model"
                },
                "finishReason": "STOP",
                "index": 0
              }
            ],
            "usageMetadata": {
              "promptTokenCount": 1005,
              "candidatesTokenCount": 1953,
              "totalTokenCount": 6803,
              "promptTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 1005
                }
              ],
              "thoughtsTokenCount": 3845
            },
            "modelVersion": "gemini-2.5-pro",
            "responseId": "5g-laaSACeiVmtkPwuHB-QM"
          },
          "cached": false,
          "metadata": {}
        },
        "score": 0.9411,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.037554,
        "gradingResult": {
          "pass": true,
          "score": 0.8737999999999999,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 1982,
            "prompt": 1381,
            "completion": 601,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9276,
              "reason": "change_detection=1.00 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=0.70 | json_valid=0.90 | property_extraction=0.93 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
              },
              "pass": true,
              "score": 0.82,
              "reason": "Let me evaluate against each criterion:\n\n1. **All 5 entities identified**: Yes — character:billy, character:jane, location:harbor_dock, prop:oar, prop:envelope are all present. ✓\n\n2. **Billy's costume as leather jacket**: Yes — correctly extracted as 'leather jacket zipped'. ✓\n\n3. **Billy's costume CHANGE from flannel shirt to leather jacket**: Yes — there is a change_event with previous_value 'faded flannel shirt and worn jeans' and new_value 'leather jacket zipped', with evidence quoting 'leather jacket zipped against the wind'. ✓\n\n4. **Jane's rain jacket and sealed envelope**: Yes — Jane's costume is 'rain jacket' and the envelope is noted as 'sealed' both as Jane's prop and as a separate entity. ✓\n\n5. **Billy's flat/resigned emotional state**: Yes — captured as 'flat' with a change event from 'tense, jaw tight' to 'flat'. However, 'resigned' is not explicitly mentioned, though 'flat' captures the core. Partially ✓\n\n6. **Change events supported by actual scene text quotes**: The costume change evidence is 'leather jacket zipped against the wind' which appears to be a direct quote. The emotional state change evidence is '(flat)' which is a parenthetical direction quote. These are reasonable evidence citations. ✓\n\n7. **Confidence scores reasonable**: Billy's properties are all at 1.0 which is appropriate for explicit text. Jane's emotional_state is at 0.7 which is reasonable for an inferred state. Jane's overall confidence is 0.95. The weather 'windy' is at 0.9 which is reasonable as it's inferred from 'zipped against the wind'. ✓\n\nStrengths: The output correctly identifies all entities, captures state changes with evidence, and uses reasonable confidence scores. The change_events for Billy are well-structured with previous values, new values, reasons, and evidence.\n\nMinor weaknesses: The oar's change in position (from Billy's hand to resting against a piling) should arguably be a change_event rather than just a static property listing both positions. The 'resigned' aspect of Billy's emotional state is not captured. The oar's change_events array is empty despite the position change being noted in the properties.\n\nOverall this is a strong continuity extraction that catches the key state changes with evidence.",
              "tokensUsed": {
                "total": 1982,
                "prompt": 1381,
                "completion": 601,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_002\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket zipped\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"flat\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"Oar (initially)\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"faded flannel shirt and worn jeans\\\",\\n          \\\"new_value\\\": \\\"leather jacket zipped\\\",\\n          \\\"reason\\\": \\\"Character is wearing different outerwear in this scene.\\\",\\n          \\\"evidence\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"tense, jaw tight\\\",\\n          \\\"new_value\\\": \\\"flat\\\",\\n          \\\"reason\\\": \\\"Character demeanor changed to flat/unemotional.\\\",\\n          \\\"evidence\\\": \\\"(flat)\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"character:jane\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"rain jacket\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_appearance\\\",\\n          \\\"value\\\": \\\"30s, sharp eyes\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"sealed envelope\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"impatient\\\",\\n          \\\"confidence\\\": 0.7\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"DAY\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"windy\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"weathered oak with a rope-wrapped grip\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"Billy's right hand, then resting against a piling\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"sealed\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"held by Jane\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Jane\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [],\\n      \\\"confidence\\\": 1.0\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock daytime scene.\\n\\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\\nshirt in previous scene). He carries his father's weathered oak OAR.\\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\\ntone is flat and resigned.\\n\\nCritical evaluation criteria:\\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\\n2. Does it correctly extract Billy's costume as leather jacket?\\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\\n4. Does it note Jane's rain jacket and the sealed envelope?\\n5. Does it capture Billy's flat/resigned emotional state?\\n6. Are change events supported by actual scene text quotes as evidence?\\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\\n\\nScore strictly: good continuity extraction catches state changes with\\nevidence, not just current state descriptions.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "7b8a9920-e97f-4ffc-8348-62e29132a205",
        "latencyMs": 38783,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 2: EXT. HARBOR DOCK - DAY\nScene ID: scene_002\n\n```\nEXT. HARBOR DOCK - DAY\n\nBILLY walks along the dock, leather jacket zipped against the wind.\nThe OAR — his father's, weathered oak with a rope-wrapped grip —\nrests in his right hand like a walking stick.\n\nHe spots JANE (30s, sharp eyes, rain jacket) waiting by the boat.\nShe holds a sealed ENVELOPE.\n\nJANE\nYou're late.\n\nBILLY\n(flat)\nI'm always late.\n\nHe sets the OAR against a piling and reaches for the envelope.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_002\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 12,
        "provider": {
          "id": "google:gemini-3-pro-preview",
          "label": "Gemini 3 Pro"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"Oar (initially)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped\",\n          \"reason\": \"Character is wearing different outerwear in this scene.\",\n          \"evidence\": \"leather jacket zipped against the wind\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat\",\n          \"reason\": \"Character demeanor changed to flat/unemotional.\",\n          \"evidence\": \"(flat)\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_appearance\",\n          \"value\": \"30s, sharp eyes\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed envelope\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"impatient\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"DAY\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak with a rope-wrapped grip\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"Billy's right hand, then resting against a piling\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "prompt": 1005,
            "completion": 950,
            "total": 3967,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 2012,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cost": 0.037554,
          "raw": {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "```json\n{\n  \"scene_id\": \"scene_002\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket zipped\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"Oar (initially)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"faded flannel shirt and worn jeans\",\n          \"new_value\": \"leather jacket zipped\",\n          \"reason\": \"Character is wearing different outerwear in this scene.\",\n          \"evidence\": \"leather jacket zipped against the wind\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"tense, jaw tight\",\n          \"new_value\": \"flat\",\n          \"reason\": \"Character demeanor changed to flat/unemotional.\",\n          \"evidence\": \"(flat)\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"character:jane\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"rain jacket\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_appearance\",\n          \"value\": \"30s, sharp eyes\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"sealed envelope\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"impatient\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"DAY\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"windy\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"weathered oak with a rope-wrapped grip\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"Billy's right hand, then resting against a piling\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"sealed\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"held by Jane\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Jane\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```",
                      "thoughtSignature": "EtM7CtA7Ab4+9vvm0l2L0RprT8UIj6YL+W5e8rNT/ZjgK1yCo3viMYfnxeb7SX/VlUi6kOcKBRBjIIHmZNiH3tQ4umbAhgnEH/JbRDLFUe5YnwypoSz07vTqP+TvJAM4dvEMgouJrBtsd6jZOm1i/fNJxQF9j9yB2XcbHffljkvsgtTUpa8/xG6/ZB1+QdXIqLGR5E1n8SYNzcxU0hTeGKS8Lr/BMZDekNm/twHthl13r1rJVAxlQdnCO7wiNlcO94WPc6vNaVeTKapQsypk0Xb/nP3oehJbgrUeR+xUXdPHh60CpDUItVcFvErbKVLhwQKq+oIlcCT+J/Wf372ZyvVAPQZ3aapQt2VZVA27bsxh1zfbd6/PVvaDKTZtfYFlP3CIH+4iQt0DZ8NSYOayIVmsN23MyG7s/n0CSpyqQ/ycSVP0VIQxkpjLCTEmWQ9A6GO4+oFLPsvPaDmGs4UgEJ3q62OmC9E8d3B5a4kc8L3I4wQUVwENo0BGZb8RJXPLkpL8eczhyp7UFeWLlTlmuOuNQhBAJ/kgd8/DakyDe94yvcHvQ26/LHdB7gfaU+SYoaA2xSJ2tXkFT4RINebHi1cVfdsHGBy4QqRETaQhI3sRiwJlrwfF66KZCAu1mmlkMlmHJh9IXCQ6ACbfmpbZlGJ37YMJnhZZhZnJ9zYTUDRYQPiChVpDulvBsotipKekvw8osINZ/3nnvwRP5kN8thKDVlvBCAhS/4ql1ViaQ1BDqEX9OsqSB65d650GshsgPud5ZkMpv848+H9Fcm/kh/Eq+/h/UbQgAd0nSY+InGpgXmioQADwyQw4rtBnT0YttWVZiw3/WaEUEwfghxBhvak4cM/74splRZMhVyaKqC6BfsglZINc+9byYttfrT53Ze3Gk/IDR25PGTr4OC+cokicxa6/PN+DpVQsSwPJER1DHy/ltIFUjYys523UGkPw0pyMoW9mbMAuGxdOrRQv4Lz7jv/CZJd3t+ItXIFI2g1Ejcwd3MmcRqGDfB48RYOoOh9uOLZeEEJGwCygazjs9g0T9kgNHtM70G4ei0Ipkq8wpBQGzH21VjkfT7qkRxutI/oS3SYuk4yqGEjPU8OEzbWuKSS00poK1O8MZA6yeehMP+yWlqutUXDP9dnySxCwVeNFdvGOC5mFMdPlAHFnBSYaRAEyzZNOIxlhoRFf5CgMnFGYm8HrkXsrCjlKPOU8eR1FBE42/vmtBPa+PWhh8Mznqw8n0H2GCRt02Es1/cjK97/ZI/SWBoiHA5PQXu+BIY+0NpDkMtlLBN3rYyP187xWCh8FdunVbCrczN5DCGf4i0T0ogDi5CxSZw70iRlVzyqGwmJ5LUiIuxK+xjGvmU3PlZXP8x1dmthD62F8OMoKmG0qb3AvMqRt4YbzRuNP4w0friPs1ysaH8tiPaxPsMKyNL6GW8a/LBfExTW6OhVfOBqfVjmmJSoa3/grA7vlF/a5g7/U0QtLBqggpEMFAfS0j1dnE6kvqs1QE7GFDlUWLe03DUQoqwgJdUE860hYYN3vwrcX2wgpnGV76KcfZrDbeb/3m+VuufrXvOibqv3TvZUQ3ki/+lTary0D5oHx7FZCQ1TCGkJTO2hKwvcpcR2CLx/VCqdigsEBpBX04h2GIngYEyUg8+z9HaO4bRCY/0Bzy6RAFlJOQXBPyjyoI6VWJ1/jBo8mWDZC4SrfYsL00ZdFV8dUR8XsLoSdfpCo92ps5GdrG6WDWwQA6+OD1i0c03HFAmigrD4cKPP9VZNisv5A2DXqmX7pEnzO3JsxJfXPaje8/uXyUPR6drm/jvkkg1/nfeuxlML8l+kDTtc3nvkpBASDoI/sNVLWcx5+g1ddZpYm3NraRkGYFJDx16S6FrmfZDdHe58OOxSvJI96947Wu7r8CvB+/9CSPUIpJ0Tcy1c6I95tQTm/bw/WA8+RJcMX/vM5MqJLbncjBvEN1QEDfKAqfWjjz+FMthU1X7MDdbIockIONoWby9Pa4O6bi8UkdgIjCA9ALAH2ErYP8/QMaKBh14BqEKg3MATQt+zk7ff3WZqYMIPpDNyFdcY9MC/Bm+O5yXsgH6IJnNqYaUlracfIlGKlgy7seMS2k9K9J+Dyzj9FXgY++vyMhCYW/3r90Q8PL+SCxYJy2TcnM1OMLUs1aTSWnJtht4acCWPuK5DYT3mqa0MIW1lmqd5AOAg7zsqIqTR1B0PyUdtTEqrarswh8mmVasLZqCf4hLnAkREk0wa56yai4fQuDq6ByGGXtJnlaRU7BWaringsaSMKuFU//RIwB8qpBr9v+jyIr21Y5+SWmFZHVPs66my1uehCRvDKMv4fEL4CIjbczRfDxW2EcMNXpVu26hu7ZG2juINAnnhY24pOt29uAdR688oVorxbAw/6Qujc1/AOMtjGeLq3W/3llkGkuisMBcPktUNexjAag3QvJ87fouPRT9pWsIkD2DrLIs/LCXJQUlKHvLNfRAG1SZaDycmkONH4OU3zqrsIWMxzPWpFuz+mz3grZVVmwKUILbNT/VROR1tc+8C/fQB7nuj3H9P0di4O9OYs44ZPv+qTicj+CHNmOKnYIP4/J9bimxsqaJLJz+4QBk1q2VvskxIBEd7rd0gClnBxOJ/TD6xGlqNxa1xuSm8NJAsiGxy7pWlLZPAQ4GOexQaiOCaXVzKXx8YrUwXifQeP1z2ioRTJbwjehXQVo0PjyPqWJSIaziJnb5CtgZQjIhdxOEnijut4Wbi4TJom+iZCYSm4BnwTP0ubmJ3tFrDU+yGYQe6i2sHA84pkK91HI9+WS8gW+8dT0CIOOcEVGuCtDom5sP/rLwdb+5J1gl5piWFszO/4TlWOR8+Og4KTihzXV9X+Ht7b2FD4+cEn3bjqyxjEeRFan1qi8ZJpyoG1+4AOAavKXGRhDyeThRm5Wmp5IlHkHli5XeMb3aJzkr7rxWTxrjkH64fz+aFSx7mGu0zfYBLw4NwDnWsRkfKHxAxqTaDX3AQmH7cy82JneC4ktBx3qePd35U6nAhBz2I6gg5ysInCsnYA4V+qgu4f/GONNVDdUoWUXmfgtSmpMK+EHBpunOv1KfAuYzyTbBnivPfOYMa84LQBGH4yxDCdS8aPKNKmtHV1XXl8H3nX/VuqGM27hm+Ow67fo8Ng30Mw9NgDNgtVe3LXbIMTqVVLjGNUf2aPFWY0S0hS2rOccX42esImqemG8U6zrdRhSipTpqejvMTnF2tZiPqmUcpk66iwoqZZ/Qck/RGd1U/s4U3CTuiYpsJk+ICTAgEVCqSByG8YJVvUczIhBFyb4AJskAYGsj5TzziLzGgZrLPLS5HL4l5yPkYxWGSqYbnIPp2XXsLuI5tEuFPfXgypD7a0Vho2QcHFi8PYRr5N7GpxUpuNHgCUPqcLXzFFuYagwFDINaiajlcortH4UxMfq8GvR4MuCdGARMqxKjhs5qbDEohViQT8ol0woUU7XN+6gVdU2yqJEeXMYkCMwxS/9ZN9+CC3SE0r4KSyPAIumq61CyxKMAUWgNa/32pkxYfAvSeY6PoFwwJ1J+8ffJrc4O/Ut1qUUhZqsgUxaQYie58nBJ/0WMl/CjcSLPERv/j3ntYOjjkGOxlV3HERhgNb5e+kgi5xCr4BGKGiLSr1ItUDklgNv4kfE9JFiv3C5ngH/iGvB66j27I84HoIiyUKx/1fApGr2Q4zTYYprZSXEm1myxu4U1XPCsNvuAoEELe/gRlSZeR7VNtW8nZmQ4iAifxSLwB2py8+GZd5ds1QSshmyAWjpZInRHZkIRzNo7k28tRoWWNyXY51kNG6LO3n4yljzpvv8Z0e60FURVbUcHlGJRvcCgEy2KRylXay18Cutddh9+lPvORKidrcPH1tVeVxWt6UoiKUGe2nSuEpzta3odhH5DlXXl05zOVYPIyXUe/YpjwJ1kaYRiDQr7V61EYUHzvV7HQdlv0vLPwWJRm3ztW1sC5qicX8wQdMI+zpy2dT2T/eHCa+91B/w0kalwHKaGGPPfJ3tQ8XyFAU2uzc6458UXDd1Z6SrhLxrNb1PiN4V8HdeHNj00Co1lXYnER+QU+S6faqeLh6vcCURLqSsk04HiK6/UNiz+I97uGHa+Y77gob0gQCHJCZZ4EmJAohXIcqcgum9Oqo+qb3jRVhlfW84eTMWw9+QvVMwEll+3zpu9dexRGtwyRTi4eqlhdtvUuMRudm2lFLncCxbKPAtYq4312zqPRdDWE8XlAcjvTKW9XhWw9IXHbGKzVAEIjTti/tVS7x4Rs1561kqvSV9iZ+lG9v01V2LbQ21TsQ2u3xZoJhYhrZ/H+4Olq+6pI7haovA9mLLQFpTxiFkELuX1OZ+fPP7pG1KtSLNtBPf6BLAgpAQBgZhyosMVED9JDjeS8xHbrZ5/P9g70iaVoM2svbklkt5b+LdfdzYl6DkYneTr6rpG+FAG3b6+XdQ6ek/jk2f+EcJsjyPf6SS+G/EcX36JyZh93Lpqjy14MoAlthY1U7SHi647d4WNWVqTBQ/d7QqQheFl1TbUY1AfxjTQCLgxDab2J7ynZRUd9Km9rcmZjQYuKCIKy6zEr5/cRqF7vzOr1t6tqaYij6IenLinUQnQg5upWJragqwb85fzMML/r2V9252cHAir29regzXOPjlIGdJjOrCXs72upgS6fWIZcrmSEpEcX7PTct+0OxY2/W3caYpQiciRLtEz6o1c814YJw9G69O9YXzg7aMy9vw0Dz8DWeDJ0eCw7pisMjjODXS+HscWIOchbSEmW5YhyqCZ5b64c8xQW7fUDLkaEsX5PpUnjY2XbAnlbZJC/5iKZaPiHSjNphYbxR2DQ5306ubjAJaXAS/oSlLVHut0c6Yjn5rUhv9SK3a1Y2qPRE9vclDA8gx8Es005DpKeAGd77+bw9PsDO6UOnbsEOXAQD3G+3T9QUunSzW52OHCE7QxlqQ98PBDAYsm9kuQZp1gtMkoxQ0gajMPjYNEOgh8ozaPLVn5Kt9586EygTlbUm6RCdh1yvnUy204OXgXoyGJSKRWArmPM0tBip6HHZEpeqa4ZtPh52e5g8koipqDXCvK5PNgh5+VfV0IKoPWx2Kfna8Pc9SyAzxxMh6SYJxgYdjNuhKofpAkwMTU37RWUngxa+mGkQ4DWna6MLcH2Aor1yeyNXjPORGlNLJpPBCOvJKBp3spF/ymjA1ZL367BId0x56nXQ2udfYQ8dX4I9Ms/l8ntIHNqHmfrJGHzp5r4S51XF8OrZ95zB3Om1QXTFL1HyEY3HhTi3oPkh3HWCRv/NCheR3K5NuvnJ3fqW1f3+K3RTiDVT5+m6Tk9CmqwGP6IWElCrNh9s4Jkt0pamk+UZcX3Xppoz1oFha9UJiOL0qw02SypRjTlOjihFLP9EQYQ5sPprXWEXUElncruH8QC2u7XZGLBdncrMaKIfAOMrHcj47I4nfRElcu2Yv1+sOgoZzsh1axLRX4JHMWe1MAB8Izsvb5+w7lJ83kZXonFZC95DY6bfx1+8Uu907Ru4ZeQREizGH3p0yr2jNYprOFYU1L209wLzb3Y9EugGoljbIFqyz4m8o+4GOmHgiNc8yeW6w2jLZTjbrgN+cNh0hhF6JNX0x8n+3+2q41H7piJ39p/tcRKfSi5FqEupSrXPWsi/wqQHay6ub3MZG3dsz6uAG162YowDZWKoQ1f30P/FtIShN9pRn/1ofkSl+NZvZo85Zjb0E0VaYeyCEBTcTcLlpyMJPoAVghuP5UISI08aZXmS9LoPDX7XF92VJucdb5lqmna+aumS8mz0vzCK0ubIpDLURoTlzIxew9LX0W234+3VaszE2nWwarOoE7nO1+GPRcNBkbXS8HdFIlfueUrE++AcMgujJeJzqhAXQS2S/Joq1/o1BTT+hIJGGVNplT58AkPO8qMedjtOqlubipljzYpzVOmqdR/rW1QbRkWC4hzdxZgw59APdJ9Evb84IsI4HifgEfq6yLfB5gzuB+3juzibwYx3uoGrCT1LHHX75vYBXosXJGJ/OaqDwEphBixejRVIa6LIrsCULqlRR7w0HvallGhEsZ6gIHguJ94dBm3TIR97kqi9qdOysSLyEQEGcHg51wzPwdQJeaCJRtlZp0Drszum9fjwe7kwSQFGDmZN6Ciwrif9+B9iAEsf9NwrPbA1pa7GzgDsVXg1ax1TPsxZrBvuz9FWjDVt/G2EzwsBVDBywgGSYiYKwLCKOMgoVNMlLMAoSCEucNr6GNeir+w+jA/mcDLCMsNEysUF0r/wmDmMfaThjrmJA/aa035tlDkzMhfbm7232zQb5cRrXgojPzvAL0nuTLW3yNxrL/pwvFnOO0xTRk0eYi6kuaLkOxCapRIzvpVZFn6MBOTHPUozLqSyv1JnsDLC1z8Ic7h1cWnYozpxtl/jYt7s+rA3ulUa7q/y3BXhB/L5+9krSWct0tFiM7W36VgNjmfRd+7WmZZbtwV1lJryRSD1CXPB71boHylCex/L7FaHWAfJBP9B/4DAai+Z8DydXjad1+eYi5pfsCdE6Ovf1dw/VDCs4FjML/NLHn1R1OulZGm8WbHJqiJuwH52BFRtfWnz3jWg6Rbs5rI8ik14al3+57UHiFlJxOcn/0sijHmn2UgszaosetizLxZLIzaFXwtSOyEGg+L9nvR7r6gno5xEN3UOBXcNNIOROhmoMEjkl6/M6uvd1nm+wsuXRzuLFxOonrICji4OsNiiFETBhi/8/ElhIILysaoweInRRVwM+F1kzEaR2KRx6NhhUXUPFZ2M1wqGCtMCisdOnvc5UuJcpr4L34FhKEYCaNoXpr1Mz5lZQrjA4vpgijmYyX38XcoKcFl2A06TvX8FBKhWCMmZa+n2Etew/8K6kwbXdSDPgVGRkyxzT49d3Hnx3XC/KjZMH9VNduku65ZAi1iPWghCesI1jO4zf52hXvm4ZSxvvwunzW0AnLJ7u1BjR8g/quv7NJL7vwUY6HoJO6pnK+gOv+PMjzBZQRVoO76s+sfp2NXBIOZRonAUM+Yetnt5MnTESe+4sKcmRoo8c0W9aODbbxp/Odhk9U8zrYUgF0ffvuGfwNgVexNQBWmpD6DnK9R5xp3GIMvytdOj0GJ4I1mkrOz7AaK1vpCXDQg7IZwFKOoDBYZta9jsCO82idS1UkTc31r2ERVQ/dpWVCN1f8DDZruSjDzvLAnnDqrcgEyukfE2HYERdXetC3TjHha2Hktaf4z3IcbTsvfb8UQdwku/h4XKIhmQOpqekX7mp0kUP3x0VwhpQJzE/bHBSTL+0sJf1ztsHjFBBKLoRl97Pke6zj5NSe8Q4/8XjXS/o6A8mGndKqcgNkoUPPnRKwvkpJ+OoVKZEffzUn1mBS68Ppaow4dLPfwsBehm+H+IwzT9dNRAxXzA+iXT0gupNj0PTzDamXfCUqGkG2jaG/I1IPi9TQ7X+FbyAbl7QTcsOdsFh+prONTdyUv23bcIzzt6qghLwtp7CL2oKfyN2tgxpB6VawDGY5OBIioX1Y1H/hAY+MxqILZFpBSE8cprqB/ErFgMXd20nOqlDjNg2HELW5FqJDvvZxnKPgezNBc6ODLULkgLsBmVNcF+Kn7jZP6Rxi/cZ+XKVkFTldZkgXSqjwn4pRyfNF9W7P80u/YvEkgnNWRnLfhDwBUd547qtWKbIpw9o5eq/9Ih11c1CFYYsApGiwMSDg5+bSxR76xtakt9/Emd8g41uiVZq8Vx2e1Au/lMjXMNxnymKOmTzT0LtaaYSY3lZHh/dI4NuyL45oo9k05CHN4JWS7Xm944c2Okc9nlUf6A/UVwaR6TSf0JvcDttQhLProJVyRJQG2Ke3hll7OLEQ76olxQxkEOlBHDVe82sqIeX1z+R3PO7//UzAba+HPMIBU86xLJgZynBya9S2H8SdtuVCgJBLEo3dr0pRK1grFyVGMohrTrNJhOpuWII1RTp+VZFGPVwQnUobE95pyNG3MMErIm8EIoX7QFqVTDSqVOyu/4945s+sdR8RR8CkvQNLXBgTZ7UtX3DHzU8x/mD80iQGN9RQpPtY3zWg9GM/0T1d1QWkQBBC5mdlJYwY4Nm9FjJfnG7qPcBFGDpgB1NpUEE/ZF/jWYBjiGgbekaJF83WbuDM5kiWhsCegjL4WHn3hp/pDQrTpAquUWKYKgB+ayOwtUWORawddvkAuHBNeehfhUgx8zdXfyikAB50Y1eDdm3ZdKbc0VyHDiRJBS0i0KE09NMdM1qjD2VP+VAqdx+ctOnE54q2s9lyX593ItKnYl1abl8yiDGA1W64nR9jr8SSujfJcimAfoc4h0m65qtAINixLa+RjU9RYZPfrLKldG0aDlUPGoKqAJFTYcIOQqHfDTIj0WPetAAqtEUOuTlV7jjfwkn9UBw9ogtFB0nqdd1bSyvjZytNJQO4K00E2qrKCpGRLx0C4YiREPOMWcpfIva4mE7lH/MoPHnk5EUod1efC1uOd20gpo19Gipg0we+0dhVg3gD034yDh1J0d40fogPaxRaWcTPQNsX0y4XVhPv8iSTYy6ehsS+BhAY5TU5d8qpqlYIT7lnBUVLAxVJzwPDls+yPVrdbjLunTIMNxpnJjmhUJDNaL7vUXrDmBRBxR/OrvgNjOxW3zIuTNXhNSxrhj0YaRlqOc3AMl1QSBdeREOcz871Ycdm8sbCrFdH9QmEiC5nMdMQa1xm87a6ujW680ZAlKPixZlFm2/5DMZE9zl87FTVOaxwgy9t8+af1vuLlDkShZWPvsN5MlbGEWAScaBVk2PHwlm2VmEvElUaa0muD5GsJ02gvLVqTLLFHxFBF9q+CNqDRYtyq5S0vXE5sI3R1GQICjIcb9x/gn4yqZhXy3DK8g1pHtPGhJKoOOeS9/vhYBbPvbJTPRU8cJp48VeRP7EfQNtIXgmgEa7EeOiF3H4Kkx9Xfez75eSzGKRuz8R7IIen4mLrVINeCDYmp/ruDwabVTVhicPIqw1nXz8PtmebHiE20janbta0S4mqAHMjYmLLIyOO8KzV8yBDCj0qabtCtYX7aEZ2pGRCPrXxH9zXKYIjOyYM/OCgN23Dy9/TLE5UKfCbLSefcvmYZwF5RtM9xlAxyak1+YI7W/Y/v6AJ0mSqnVzaRfbRTZlUu0ZRULc+7stbp3lAgLBZphqKNBz0qOs5yuWxAO8rv+NFyf/Es+FPaafys3mTUdMRWYZgdnAR9d4zZ/EVbXMU+4KOihxY2zM3HEbr37LFYz8XVpXfXC5uFiUROVS9c56uj0qLhzmBvMCOUk99bxPWzDWPAo+lwTwW7/gjZgpfLGIbqQDaCJ3lPB4rE4oFe7Iq7aHIaEbvguGrbhJiFb1gVdqfaweK5/mlPJqiLSDsWH3xc+f7gIbPYOVpCfpsTw7/jKbvrKCS6N4z60mLE3GGTE8lnvdDsuD7fGT1ITi/0H2vzFJai0C5N7+VOUjkGQNQvZXg19kT/uJLUkx0g4L2hAsLb8pN80kq0Unek6cFxjuu7RzVkCV8DLVBthRrhEW3xY5SPAPN6LoYTDfm1+qf/5WOXUSqsDHwNO3SRjMAnSBlhJR/Ey9UoZmMJzAh1FaXwN9ywAyDLiIduQSye+W1OZ24fZObNnZAfaUZQStKAHEEURfLRxHHz+zm+VbOaco2rfXvdTQccKlfvWPtPbgoxPTsNJkSRnwMQZ6jp6DRyuKclBH14ApS5BypdEgRecHIqHuxWmW1aN5TBW+DRSkep3tXnI/c1IE+OjaopbRNFHjHOg0RfZ8kdVP+1DOSjoACAPr9PkF1mlQqvXfkh0jNyYcMToessAU2UUbZQOXc9t88dY63vNRjS+dnHvlhVimLdfIHota2m8F/v0YPxJYvd6Ggn+4CCHfQGqHDgrAD7/BOJfqWw/X8QAdSm6FUm4r7b+O6wneSwzvJtKhiKWioojkzUWJ4VpApZMTCyPLIUm5MC5W48gxlC7J2krcmAP0IS2mLn3W5lPUNr8jpNTk5l86eQ1MY74HbWudmEdeeTHRQ7reN4TNL31M2o3xcxPf8YmLhx3CRevoMDIEeL3ZZgYNMvnFgiupWB4E0fE3WM3/N2cfoTE/fBPCRp3xOd5VwbHUhThWXE/WMFzP/6i4m6sx+GoNx/YiJkm1+XTtK5sQ3Z+/bkFP05yOazQHz/wnqkosTsttrxQ"
                    }
                  ],
                  "role": "model"
                },
                "finishReason": "STOP",
                "index": 0
              }
            ],
            "usageMetadata": {
              "promptTokenCount": 1005,
              "candidatesTokenCount": 950,
              "totalTokenCount": 3967,
              "promptTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 1005
                }
              ],
              "thoughtsTokenCount": 2012
            },
            "modelVersion": "gemini-3-pro-preview",
            "responseId": "7A-labejDYiVmtkP-aOH2QM"
          },
          "cached": false,
          "metadata": {}
        },
        "score": 0.8737999999999999,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-day.txt",
            "scene_heading": "EXT. HARBOR DOCK - DAY",
            "scene_number": "2",
            "scene_id": "scene_002",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_day",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 0,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0005905000000000001,
        "gradingResult": {
          "pass": true,
          "score": 0.7993,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2086,
            "prompt": 1425,
            "completion": 661,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.8186,
              "reason": "change_detection=0.48 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=0.93 | json_valid=1.00 | property_extraction=0.83 | Missed change: character:billy.emotional_state | Missed change: location:harbor_dock.time_of_day | Missed change: location:harbor_dock.weather | Missed change: prop:oar.position",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.78,
              "reason": "The output captures the majority of the key continuity changes with strong evidence:\n\n1. **Jacket damage** ✅ — Detected as a change event with evidence quote: 'His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.' Previous value correctly references 'leather jacket zipped against the wind.'\n\n2. **Blood on knuckles (physical injury)** ✅ — Captured under both costume and physical_condition properties with evidence.\n\n3. **Oar broken** ✅ — Detected as a change event with evidence: 'The OAR lies broken in two pieces at his feet.' Previous value correctly references 'intact, weathered oak with rope-wrapped grip.'\n\n4. **Envelope opened/scattered** ✅ — Detected with evidence: 'The ENVELOPE is open, contents scattered in puddles.' Previous value correctly noted as 'sealed.'\n\n5. **Time/weather changes** ✅ — Location entity captures night time, rain weather. However, these are listed as properties rather than explicit change events (no change_event from day→night or windy→rain), which is a minor gap.\n\n6. **Evidence quotes** ✅ — All change events are backed by actual quotes from the scene.\n\n7. **Previous values** ✅ — Generally correct (jacket zipped→torn, oar intact→broken, envelope sealed→open).\n\n8. **Emotional state** ✅ — Captured as 'flat, resigned' though the rubric suggests 'hollow/defeated' — close but slightly different interpretation.\n\n9. **Jane's absence** ❌ — Not explicitly tracked. There's no entity for Jane or a change event noting her disappearance. The ownership change on the envelope hints at it ('originally Jane, now Billy') but doesn't explicitly call out Jane being gone as a continuity change.\n\n10. **Billy soaked through** ✅ — Captured under physical_condition.\n\n11. **Weather change from windy to rain** — Partially captured. Rain is noted as a property but no change_event from windy→rain.\n\n12. **Time change from day to night** — Partially captured. Night is noted but no explicit change_event from day→night.\n\nOut of the 9 key changes: jacket damage (✅), blood on knuckles (✅), emotional shift (partial ✅), soaked through (✅), oar broken (✅), envelope opened (✅), Jane gone (❌), weather change (partial), time change (partial). That's roughly 6-7 out of 9 clearly captured with evidence. The main gaps are Jane's absence not being tracked and time/weather not having explicit change events.",
              "tokensUsed": {
                "total": 2086,
                "prompt": 1425,
                "completion": 661,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n{\\\"scene_id\\\":\\\"scene_003\\\",\\\"entity_states\\\":[{\\\"entity_key\\\":\\\"character:billy\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"torn leather jacket with dried blood on knuckles\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"physical_condition\\\",\\\"value\\\":\\\"soaked through, torn jacket, blood on knuckles\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"emotional_state\\\",\\\"value\\\":\\\"flat, resigned\\\",\\\"confidence\\\":0.8},{\\\"key\\\":\\\"props_carried\\\",\\\"value\\\":\\\"none (oar is broken and at his feet)\\\",\\\"confidence\\\":0.8}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"costume\\\",\\\"previous_value\\\":\\\"leather jacket zipped against the wind\\\",\\\"new_value\\\":\\\"torn leather jacket with dried blood on knuckles\\\",\\\"reason\\\":\\\"Jacket is described as torn at the left sleeve and blood visible on knuckles, indicating damage and injury.\\\",\\\"evidence\\\":\\\"His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9},{\\\"property_key\\\":\\\"physical_condition\\\",\\\"previous_value\\\":\\\"not specified\\\",\\\"new_value\\\":\\\"soaked through, torn jacket, blood on knuckles\\\",\\\"reason\\\":\\\"Scene describes rain hammering, soaked clothing, torn jacket, and blood on knuckles.\\\",\\\"evidence\\\":\\\"Rain hammers the dock. BILLY sits on a coiled rope, soaked through. His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9}],\\\"confidence\\\":0.85},{\\\"entity_key\\\":\\\"location:harbor_dock\\\",\\\"properties\\\":[{\\\"key\\\":\\\"lighting\\\",\\\"value\\\":\\\"night\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"time_of_day\\\",\\\"value\\\":\\\"night\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"weather\\\",\\\"value\\\":\\\"rain\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"damage_or_changes\\\",\\\"value\\\":\\\"oar broken in two pieces, envelope open with scattered contents\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"atmosphere\\\",\\\"value\\\":\\\"rainy, somber, tense\\\",\\\"confidence\\\":0.8}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"damage_or_changes\\\",\\\"previous_value\\\":\\\"not specified\\\",\\\"new_value\\\":\\\"oar broken in two pieces, envelope open with scattered contents\\\",\\\"reason\\\":\\\"Scene explicitly states the oar is broken and the envelope is open with contents scattered.\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet. The ENVELOPE is open, contents scattered in puddles.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9}],\\\"confidence\\\":0.85},{\\\"entity_key\\\":\\\"prop:oar\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"damaged, broken in two pieces\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"at Billy's feet\\\",\\\"confidence\\\":0.8},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"Billy\\\",\\\"confidence\\\":0.9}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":\\\"intact, weathered oak with rope-wrapped grip\\\",\\\"new_value\\\":\\\"damaged, broken in two pieces\\\",\\\"reason\\\":\\\"Scene states the oar lies broken in two pieces, indicating damage.\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9}],\\\"confidence\\\":0.85},{\\\"entity_key\\\":\\\"prop:envelope\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"open, contents scattered\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"originally Jane, now Billy\\\",\\\"confidence\\\":0.8}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":\\\"sealed\\\",\\\"new_value\\\":\\\"open, contents scattered\\\",\\\"reason\\\":\\\"Scene states the envelope is open with contents scattered in puddles.\\\",\\\"evidence\\\":\\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9},{\\\"property_key\\\":\\\"ownership\\\",\\\"previous_value\\\":\\\"Jane → Billy\\\",\\\"new_value\\\":\\\"Billy (holding or near the open envelope)\\\",\\\"reason\\\":\\\"Scene implies Billy is now with the open envelope after Jane's absence.\\\",\\\"evidence\\\":\\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.8}],\\\"confidence\\\":0.85}]}\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "55d300f7-74c9-402e-8ea2-74aab34bea0e",
        "latencyMs": 10135,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 0,
        "provider": {
          "id": "openai:gpt-4.1-nano",
          "label": "GPT-4.1 Nano"
        },
        "response": {
          "output": "{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"torn leather jacket with dried blood on knuckles\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"soaked through, torn jacket, blood on knuckles\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"flat, resigned\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none (oar is broken and at his feet)\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"torn leather jacket with dried blood on knuckles\",\n          \"reason\": \"Jacket is described as torn at the left sleeve and blood visible on knuckles, indicating damage and injury.\",\n          \"evidence\": \"His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": \"not specified\",\n          \"new_value\": \"soaked through, torn jacket, blood on knuckles\",\n          \"reason\": \"Scene describes rain hammering, soaked clothing, torn jacket, and blood on knuckles.\",\n          \"evidence\": \"Rain hammers the dock. BILLY sits on a coiled rope, soaked through. His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"night\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"rain\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"oar broken in two pieces, envelope open with scattered contents\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"rainy, somber, tense\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"damage_or_changes\",\n          \"previous_value\": \"not specified\",\n          \"new_value\": \"oar broken in two pieces, envelope open with scattered contents\",\n          \"reason\": \"Scene explicitly states the oar is broken and the envelope is open with contents scattered.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet. The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"damaged, broken in two pieces\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"at Billy's feet\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"damaged, broken in two pieces\",\n          \"reason\": \"Scene states the oar lies broken in two pieces, indicating damage.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open, contents scattered\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"originally Jane, now Billy\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered\",\n          \"reason\": \"Scene states the envelope is open with contents scattered in puddles.\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": \"Jane → Billy\",\n          \"new_value\": \"Billy (holding or near the open envelope)\",\n          \"reason\": \"Scene implies Billy is now with the open envelope after Jane's absence.\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.8\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "tokenUsage": {
            "total": 2149,
            "prompt": 897,
            "completion": 1252,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cached": false,
          "latencyMs": 10135,
          "finishReason": "stop",
          "cost": 0.0005905000000000001,
          "guardrails": {
            "flagged": false
          },
          "metadata": {
            "http": {
              "status": 200,
              "statusText": "OK",
              "headers": {
                "access-control-expose-headers": "X-Request-ID",
                "alt-svc": "h3=\":443\"; ma=86400",
                "cf-cache-status": "DYNAMIC",
                "cf-ray": "9d5d9abe980388d9-YVR",
                "connection": "keep-alive",
                "content-encoding": "br",
                "content-type": "application/json",
                "date": "Mon, 02 Mar 2026 04:19:49 GMT",
                "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
                "openai-processing-ms": "9872",
                "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
                "openai-version": "2020-10-01",
                "server": "cloudflare",
                "set-cookie": "__cf_bm=kyk7XAROv7v08x3p56bNFizN7Uwfw7ve_6xNzbVzWzg-1772425179.9404457-1.0.1.1-1uXeS8zFZhacpUeCToTVNYTt.0vAs0F3vKcDb13cFJDMbCA48OMubSgFmjuExaxoWIwxqRSW3k2WFQ9WI7MSaRQgeGpe.6lKkw2VJnvBeYLzANqaNTCWTwO_KNxL5SWw; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:49:49 GMT",
                "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
                "transfer-encoding": "chunked",
                "x-content-type-options": "nosniff",
                "x-openai-proxy-wasm": "v0.1",
                "x-ratelimit-limit-requests": "10000",
                "x-ratelimit-limit-tokens": "10000000",
                "x-ratelimit-remaining-requests": "9999",
                "x-ratelimit-remaining-tokens": "9999134",
                "x-ratelimit-reset-requests": "6ms",
                "x-ratelimit-reset-tokens": "5ms",
                "x-request-id": "req_c10662a9ad8e4bd9916fbc144f5d0e3a"
              }
            }
          }
        },
        "score": 0.7993,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "http": {
            "status": 200,
            "statusText": "OK",
            "headers": {
              "access-control-expose-headers": "X-Request-ID",
              "alt-svc": "h3=\":443\"; ma=86400",
              "cf-cache-status": "DYNAMIC",
              "cf-ray": "9d5d9abe980388d9-YVR",
              "connection": "keep-alive",
              "content-encoding": "br",
              "content-type": "application/json",
              "date": "Mon, 02 Mar 2026 04:19:49 GMT",
              "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
              "openai-processing-ms": "9872",
              "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
              "openai-version": "2020-10-01",
              "server": "cloudflare",
              "set-cookie": "__cf_bm=kyk7XAROv7v08x3p56bNFizN7Uwfw7ve_6xNzbVzWzg-1772425179.9404457-1.0.1.1-1uXeS8zFZhacpUeCToTVNYTt.0vAs0F3vKcDb13cFJDMbCA48OMubSgFmjuExaxoWIwxqRSW3k2WFQ9WI7MSaRQgeGpe.6lKkw2VJnvBeYLzANqaNTCWTwO_KNxL5SWw; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:49:49 GMT",
              "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
              "transfer-encoding": "chunked",
              "x-content-type-options": "nosniff",
              "x-openai-proxy-wasm": "v0.1",
              "x-ratelimit-limit-requests": "10000",
              "x-ratelimit-limit-tokens": "10000000",
              "x-ratelimit-remaining-requests": "9999",
              "x-ratelimit-remaining-tokens": "9999134",
              "x-ratelimit-reset-requests": "6ms",
              "x-ratelimit-reset-tokens": "5ms",
              "x-request-id": "req_c10662a9ad8e4bd9916fbc144f5d0e3a"
            }
          },
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0008153,
        "gradingResult": {
          "pass": true,
          "score": 0.9128000000000001,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2774,
            "prompt": 2307,
            "completion": 467,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9456,
              "reason": "change_detection=0.94 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=0.90 | property_extraction=0.88 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.88,
              "reason": "The output demonstrates strong continuity extraction across nearly all the key changes:\n\n1. **Jacket damage** (✅): Detected with change from 'leather jacket zipped against the wind' to 'leather jacket, soaked through, torn at the left sleeve' with direct evidence quote.\n2. **Physical injury - blood on knuckles** (✅): Detected as a new physical_condition with evidence 'dried blood visible on his knuckles.'\n3. **Oar broken** (✅): Detected with change from 'intact, weathered oak with rope-wrapped grip' to 'broken in two pieces' with evidence quote.\n4. **Envelope opened/scattered** (✅): Detected with change from 'sealed' to 'open, contents scattered' with evidence quote.\n5. **Time/weather changes** (✅): Both time (day→night) and weather (windy→raining heavily) detected with evidence from scene heading and action lines.\n6. **Emotional state shift** (✅): Detected from 'flat, resigned' to 'hollow expression' with evidence.\n7. **Billy soaked through** (✅): Captured in the costume property change.\n8. **Evidence quotes** (✅): All change events include actual quotes that appear to be from the scene text.\n9. **Previous values** (✅): Previous values are referenced correctly (jacket zipped, oar intact with rope-wrapped grip, envelope sealed, weather windy, time day).\n\n**Missing item**: Jane's absence is NOT noted. There is no entity for 'character:jane' showing she is no longer present, which is one of the 9 key changes. This is a notable omission for continuity tracking.\n\nThe output catches 8 of the 9 changes with accurate evidence quotes and correct previous values. The only miss is Jane's disappearance. The structure is well-organized and confidence scores are reasonable. This is a very strong extraction.",
              "tokensUsed": {
                "total": 2774,
                "prompt": 2307,
                "completion": 467,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_003\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket, soaked through, torn at the left sleeve\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"knuckles have dried blood\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"hollow expression\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"none\\\",\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"new_value\\\": \\\"leather jacket, soaked through, torn at the left sleeve\\\",\\n          \\\"reason\\\": \\\"rain and possible struggle\\\",\\n          \\\"evidence\\\": \\\"BILLY sits on a coiled rope, soaked through. His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"physical_condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"knuckles have dried blood\\\",\\n          \\\"reason\\\": \\\"implied struggle or injury\\\",\\n          \\\"evidence\\\": \\\"dried blood visible on his knuckles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"flat, resigned\\\",\\n          \\\"new_value\\\": \\\"hollow expression\\\",\\n          \\\"reason\\\": \\\"observing the aftermath\\\",\\n          \\\"evidence\\\": \\\"BILLY stares at the dark water, expression hollow.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": \\\"oar\\\",\\n          \\\"new_value\\\": \\\"none\\\",\\n          \\\"reason\\\": \\\"oar is broken and at his feet\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"night\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"night\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"raining heavily\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"damage_or_changes\\\",\\n          \\\"value\\\": \\\"dock is wet from rain\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"bleak, desolate\\\",\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"lighting\\\",\\n          \\\"previous_value\\\": \\\"daylight\\\",\\n          \\\"new_value\\\": \\\"night\\\",\\n          \\\"reason\\\": \\\"scene setting\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"time_of_day\\\",\\n          \\\"previous_value\\\": \\\"day\\\",\\n          \\\"new_value\\\": \\\"night\\\",\\n          \\\"reason\\\": \\\"scene setting\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": \\\"windy\\\",\\n          \\\"new_value\\\": \\\"raining heavily\\\",\\n          \\\"reason\\\": \\\"change in weather\\\",\\n          \\\"evidence\\\": \\\"Rain hammers the dock.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"damage_or_changes\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"dock is wet from rain\\\",\\n          \\\"reason\\\": \\\"effect of the rain\\\",\\n          \\\"evidence\\\": \\\"Rain hammers the dock.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"broken in two pieces\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"at Billy's feet\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"intact, weathered oak with rope-wrapped grip\\\",\\n          \\\"new_value\\\": \\\"broken in two pieces\\\",\\n          \\\"reason\\\": \\\"implied struggle or impact\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"set against a piling\\\",\\n          \\\"new_value\\\": \\\"at Billy's feet\\\",\\n          \\\"reason\\\": \\\"moved during an event\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"open, contents scattered\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"in puddles\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"unknown (previously Jane → Billy)\\\",\\n          \\\"confidence\\\": 0.7\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"sealed\\\",\\n          \\\"new_value\\\": \\\"open, contents scattered\\\",\\n          \\\"reason\\\": \\\"contents removed and dispersed\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"in puddles\\\",\\n          \\\"reason\\\": \\\"scattered by wind or action\\\",\\n          \\\"evidence\\\": \\\"contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "0ac3fcc9-1d4e-4162-b545-bfe847f7ee0e",
        "latencyMs": 4620,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 2,
        "provider": {
          "id": "google:gemini-2.5-flash-lite",
          "label": "Gemini 2.5 Flash Lite"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket, soaked through, torn at the left sleeve\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"knuckles have dried blood\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow expression\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket, soaked through, torn at the left sleeve\",\n          \"reason\": \"rain and possible struggle\",\n          \"evidence\": \"BILLY sits on a coiled rope, soaked through. His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"knuckles have dried blood\",\n          \"reason\": \"implied struggle or injury\",\n          \"evidence\": \"dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow expression\",\n          \"reason\": \"observing the aftermath\",\n          \"evidence\": \"BILLY stares at the dark water, expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none\",\n          \"reason\": \"oar is broken and at his feet\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"raining heavily\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"dock is wet from rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"bleak, desolate\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"night\",\n          \"reason\": \"scene setting\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"scene setting\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"raining heavily\",\n          \"reason\": \"change in weather\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"damage_or_changes\",\n          \"previous_value\": null,\n          \"new_value\": \"dock is wet from rain\",\n          \"reason\": \"effect of the rain\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"at Billy's feet\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"implied struggle or impact\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"at Billy's feet\",\n          \"reason\": \"moved during an event\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open, contents scattered\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"unknown (previously Jane → Billy)\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered\",\n          \"reason\": \"contents removed and dispersed\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"in puddles\",\n          \"reason\": \"scattered by wind or action\",\n          \"evidence\": \"contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "prompt": 961,
            "completion": 1798,
            "total": 2759,
            "numRequests": 1
          },
          "cost": 0.0008153,
          "raw": {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket, soaked through, torn at the left sleeve\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"knuckles have dried blood\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow expression\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket, soaked through, torn at the left sleeve\",\n          \"reason\": \"rain and possible struggle\",\n          \"evidence\": \"BILLY sits on a coiled rope, soaked through. His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"knuckles have dried blood\",\n          \"reason\": \"implied struggle or injury\",\n          \"evidence\": \"dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow expression\",\n          \"reason\": \"observing the aftermath\",\n          \"evidence\": \"BILLY stares at the dark water, expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none\",\n          \"reason\": \"oar is broken and at his feet\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"raining heavily\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"dock is wet from rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"bleak, desolate\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"night\",\n          \"reason\": \"scene setting\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"scene setting\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"raining heavily\",\n          \"reason\": \"change in weather\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"damage_or_changes\",\n          \"previous_value\": null,\n          \"new_value\": \"dock is wet from rain\",\n          \"reason\": \"effect of the rain\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"at Billy's feet\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"implied struggle or impact\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"at Billy's feet\",\n          \"reason\": \"moved during an event\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open, contents scattered\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"unknown (previously Jane → Billy)\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered\",\n          \"reason\": \"contents removed and dispersed\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"in puddles\",\n          \"reason\": \"scattered by wind or action\",\n          \"evidence\": \"contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```"
                    }
                  ],
                  "role": "model"
                },
                "finishReason": "STOP",
                "index": 0
              }
            ],
            "usageMetadata": {
              "promptTokenCount": 961,
              "candidatesTokenCount": 1798,
              "totalTokenCount": 2759,
              "promptTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 961
                }
              ]
            },
            "modelVersion": "gemini-2.5-flash-lite",
            "responseId": "9w-laYHZL4aO6dkPp_PEmAw"
          },
          "cached": false,
          "metadata": {}
        },
        "score": 0.9128000000000001,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0027748,
        "gradingResult": {
          "pass": true,
          "score": 0.8778,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 1920,
            "prompt": 1522,
            "completion": 398,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9556,
              "reason": "change_detection=0.94 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=1.00 | property_extraction=0.88",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.8,
              "reason": "The output captures most of the key continuity changes with strong evidence:\n\n1. **Jacket damage** ✅ — Detected torn left sleeve with quote evidence and correct previous value.\n2. **Blood on knuckles** ✅ — Detected as new injury with evidence quote.\n3. **Emotional state shift** ✅ — Flat/resigned → hollow, with evidence quote.\n4. **Billy soaked through** ❌ — This change is NOT detected. There's no mention of Billy being soaked despite rain hammering the dock.\n5. **Oar broken** ✅ — Detected with correct previous value (intact, weathered oak) and evidence quote.\n6. **Envelope opened/scattered** ✅ — Detected with previous value (sealed) and evidence quote.\n7. **Jane gone** ❌ — Not tracked as a separate entity or change event. Only mentioned tangentially in the envelope ownership note.\n8. **Weather change** ✅ — Windy → rain with evidence quote.\n9. **Time change** ✅ — Day → night with evidence quote.\n\nThat's 7 out of 9 changes detected. All detected change events are backed by actual evidence quotes from the scene. Previous values are correctly referenced (jacket zipped → torn, oar intact → broken, envelope sealed → open, weather windy → rain, time day → night). The structure is clean and well-organized.\n\nMissing: Billy being soaked through (a notable physical state change given the rain) and Jane's absence as a tracked entity/change event. These are meaningful continuity gaps but the overall extraction is strong.",
              "tokensUsed": {
                "total": 1920,
                "prompt": 1522,
                "completion": 398,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n{\\\"scene_id\\\":\\\"scene_003\\\",\\\"entity_states\\\":[{\\\"entity_key\\\":\\\"character:billy\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"leather jacket torn at left sleeve\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"physical_condition\\\",\\\"value\\\":\\\"knuckles with dried blood\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"emotional_state\\\",\\\"value\\\":\\\"hollow expression\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"props_carried\\\",\\\"value\\\":\\\"none (oar broken at feet)\\\",\\\"confidence\\\":1}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"costume\\\",\\\"previous_value\\\":\\\"leather jacket zipped against the wind\\\",\\\"new_value\\\":\\\"leather jacket torn at left sleeve\\\",\\\"reason\\\":\\\"jacket is now torn at left sleeve\\\",\\\"evidence\\\":\\\"His leather jacket is torn at the left sleeve\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"physical_condition\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"knuckles with dried blood\\\",\\\"reason\\\":\\\"visible dried blood on knuckles\\\",\\\"evidence\\\":\\\"dried blood visible on his knuckles\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"emotional_state\\\",\\\"previous_value\\\":\\\"flat, resigned\\\",\\\"new_value\\\":\\\"hollow expression\\\",\\\"reason\\\":\\\"Billy's expression is described as hollow\\\",\\\"evidence\\\":\\\"BILLY stares at the dark water, expression hollow.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"props_carried\\\",\\\"previous_value\\\":\\\"oar\\\",\\\"new_value\\\":\\\"none (oar broken at feet)\\\",\\\"reason\\\":\\\"oar is broken in two pieces at his feet, no longer carried\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1}],\\\"confidence\\\":1},{\\\"entity_key\\\":\\\"location:harbor_dock\\\",\\\"properties\\\":[{\\\"key\\\":\\\"time_of_day\\\",\\\"value\\\":\\\"night\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"weather\\\",\\\"value\\\":\\\"rain\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"lighting\\\",\\\"value\\\":\\\"night\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"atmosphere\\\",\\\"value\\\":\\\"stormy, intense\\\",\\\"confidence\\\":0.8}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"time_of_day\\\",\\\"previous_value\\\":\\\"day\\\",\\\"new_value\\\":\\\"night\\\",\\\"reason\\\":\\\"scene is set at night\\\",\\\"evidence\\\":\\\"EXT. HARBOR DOCK - NIGHT\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"weather\\\",\\\"previous_value\\\":\\\"windy\\\",\\\"new_value\\\":\\\"rain\\\",\\\"reason\\\":\\\"rain is hammering the dock\\\",\\\"evidence\\\":\\\"Rain hammers the dock.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"lighting\\\",\\\"previous_value\\\":\\\"daylight\\\",\\\"new_value\\\":\\\"night\\\",\\\"reason\\\":\\\"scene time is night\\\",\\\"evidence\\\":\\\"EXT. HARBOR DOCK - NIGHT\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1}],\\\"confidence\\\":0.95},{\\\"entity_key\\\":\\\"prop:oar\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"broken in two pieces\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"at Billy's feet\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"Billy\\\",\\\"confidence\\\":1}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":\\\"intact, weathered oak with rope-wrapped grip\\\",\\\"new_value\\\":\\\"broken in two pieces\\\",\\\"reason\\\":\\\"oar is broken\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"position\\\",\\\"previous_value\\\":\\\"set against a piling\\\",\\\"new_value\\\":\\\"at Billy's feet\\\",\\\"reason\\\":\\\"oar is now lying at Billy's feet\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1}],\\\"confidence\\\":1},{\\\"entity_key\\\":\\\"prop:envelope\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"open, contents scattered in puddles\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"on dock, contents scattered in puddles\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"unknown (Jane gone)\\\",\\\"confidence\\\":0.8}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":\\\"sealed\\\",\\\"new_value\\\":\\\"open, contents scattered in puddles\\\",\\\"reason\\\":\\\"envelope is now open and contents scattered\\\",\\\"evidence\\\":\\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"ownership\\\",\\\"previous_value\\\":\\\"Jane → Billy (handed over)\\\",\\\"new_value\\\":\\\"unknown (Jane gone)\\\",\\\"reason\\\":\\\"Jane is gone, no indication who currently owns envelope\\\",\\\"evidence\\\":\\\"JANE is gone. The ENVELOPE is open, contents scattered in puddles.\\\",\\\"is_explicit\\\":false,\\\"confidence\\\":0.8}],\\\"confidence\\\":0.9}]}\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "902cab7c-00e3-4779-bf0b-84f54fc0e079",
        "latencyMs": 22791,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 1,
        "provider": {
          "id": "openai:gpt-4.1-mini",
          "label": "GPT-4.1 Mini"
        },
        "response": {
          "output": "{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket torn at left sleeve\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"knuckles with dried blood\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow expression\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none (oar broken at feet)\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket torn at left sleeve\",\n          \"reason\": \"jacket is now torn at left sleeve\",\n          \"evidence\": \"His leather jacket is torn at the left sleeve\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"knuckles with dried blood\",\n          \"reason\": \"visible dried blood on knuckles\",\n          \"evidence\": \"dried blood visible on his knuckles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow expression\",\n          \"reason\": \"Billy's expression is described as hollow\",\n          \"evidence\": \"BILLY stares at the dark water, expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none (oar broken at feet)\",\n          \"reason\": \"oar is broken in two pieces at his feet, no longer carried\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"lighting\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"stormy, intense\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"scene is set at night\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"rain\",\n          \"reason\": \"rain is hammering the dock\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"night\",\n          \"reason\": \"scene time is night\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"at Billy's feet\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"oar is broken\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"at Billy's feet\",\n          \"reason\": \"oar is now lying at Billy's feet\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open, contents scattered in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"on dock, contents scattered in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"unknown (Jane gone)\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered in puddles\",\n          \"reason\": \"envelope is now open and contents scattered\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": \"Jane → Billy (handed over)\",\n          \"new_value\": \"unknown (Jane gone)\",\n          \"reason\": \"Jane is gone, no indication who currently owns envelope\",\n          \"evidence\": \"JANE is gone. The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        }\n      ],\n      \"confidence\": 0.9\n    }\n  ]\n}",
          "tokenUsage": {
            "total": 2407,
            "prompt": 897,
            "completion": 1510,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cached": false,
          "latencyMs": 22791,
          "finishReason": "stop",
          "cost": 0.0027748,
          "guardrails": {
            "flagged": false
          },
          "metadata": {
            "http": {
              "status": 200,
              "statusText": "OK",
              "headers": {
                "access-control-expose-headers": "X-Request-ID",
                "alt-svc": "h3=\":443\"; ma=86400",
                "cf-cache-status": "DYNAMIC",
                "cf-ray": "9d5d9b425d2488d9-YVR",
                "connection": "keep-alive",
                "content-encoding": "br",
                "content-type": "application/json",
                "date": "Mon, 02 Mar 2026 04:20:23 GMT",
                "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
                "openai-processing-ms": "22639",
                "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
                "openai-version": "2020-10-01",
                "server": "cloudflare",
                "set-cookie": "__cf_bm=SgkDrhxlItXVDo3D4ooMTLcl09kdJ_V66u6S1o8DLko-1772425201.0131295-1.0.1.1-jw5qFYo2n4Gp0qZ3f7PG3wW5JTTPH0lVPlsYesPooRnq41PTXy44k7kAiGrooHJ22khtRRVCuAIyCIlNJkBqiOumXu84Yff626vnkvm92Tzp58o.BO24FAuUzo4PjQj5; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:50:23 GMT",
                "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
                "transfer-encoding": "chunked",
                "x-content-type-options": "nosniff",
                "x-openai-proxy-wasm": "v0.1",
                "x-ratelimit-limit-requests": "10000",
                "x-ratelimit-limit-tokens": "10000000",
                "x-ratelimit-remaining-requests": "9999",
                "x-ratelimit-remaining-tokens": "9999134",
                "x-ratelimit-reset-requests": "6ms",
                "x-ratelimit-reset-tokens": "5ms",
                "x-request-id": "req_67f15cfc8c8a42349cb3826f3be05766"
              }
            }
          }
        },
        "score": 0.8778,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "http": {
            "status": 200,
            "statusText": "OK",
            "headers": {
              "access-control-expose-headers": "X-Request-ID",
              "alt-svc": "h3=\":443\"; ma=86400",
              "cf-cache-status": "DYNAMIC",
              "cf-ray": "9d5d9b425d2488d9-YVR",
              "connection": "keep-alive",
              "content-encoding": "br",
              "content-type": "application/json",
              "date": "Mon, 02 Mar 2026 04:20:23 GMT",
              "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
              "openai-processing-ms": "22639",
              "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
              "openai-version": "2020-10-01",
              "server": "cloudflare",
              "set-cookie": "__cf_bm=SgkDrhxlItXVDo3D4ooMTLcl09kdJ_V66u6S1o8DLko-1772425201.0131295-1.0.1.1-jw5qFYo2n4Gp0qZ3f7PG3wW5JTTPH0lVPlsYesPooRnq41PTXy44k7kAiGrooHJ22khtRRVCuAIyCIlNJkBqiOumXu84Yff626vnkvm92Tzp58o.BO24FAuUzo4PjQj5; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:50:23 GMT",
              "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
              "transfer-encoding": "chunked",
              "x-content-type-options": "nosniff",
              "x-openai-proxy-wasm": "v0.1",
              "x-ratelimit-limit-requests": "10000",
              "x-ratelimit-limit-tokens": "10000000",
              "x-ratelimit-remaining-requests": "9999",
              "x-ratelimit-remaining-tokens": "9999134",
              "x-ratelimit-reset-requests": "6ms",
              "x-ratelimit-reset-tokens": "5ms",
              "x-request-id": "req_67f15cfc8c8a42349cb3826f3be05766"
            }
          },
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.015986,
        "gradingResult": {
          "pass": true,
          "score": 0.9466,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2123,
            "prompt": 1770,
            "completion": 353,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9732,
              "reason": "change_detection=0.96 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=1.00 | property_extraction=0.93",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.92,
              "reason": "The output is excellent and catches virtually all of the 9 key continuity changes:\n\n1. **Jacket damage** (✅): Detected with evidence quote about torn left sleeve.\n2. **Blood on knuckles** (✅): Detected with evidence quote.\n3. **Emotional state shift** (✅): Flat/resigned → hollow, with evidence quote.\n4. **Soaked through** (✅): Detected as part of physical condition.\n5. **Oar broken** (✅): Detected with evidence quote and previous value (intact, weathered oak).\n6. **Envelope opened/scattered** (✅): Detected with evidence quote, previous value (sealed).\n7. **Jane gone** (❌): Not explicitly tracked as a missing entity or change event. This is the one notable omission.\n8. **Weather change** (✅): Windy → heavy rain, with evidence quote.\n9. **Time change** (✅): Day → night, with evidence quote.\n\nThat's 8 out of 9 changes detected. All change events are backed by actual evidence quotes from the scene. Previous values are correctly referenced (jacket zipped → torn, oar intact → broken, envelope sealed → open, weather windy → rain, day → night, emotional state flat/resigned → hollow). The confidence scores are reasonable. The only miss is not explicitly noting Jane's absence as a change event. Overall this is a very strong extraction.",
              "tokensUsed": {
                "total": 2123,
                "prompt": 1770,
                "completion": 353,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n{\\\"scene_id\\\":\\\"scene_003\\\",\\\"entity_states\\\":[{\\\"entity_key\\\":\\\"character:billy\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"leather jacket, torn at the left sleeve, soaked through\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"physical_condition\\\",\\\"value\\\":\\\"dried blood visible on knuckles, soaked through\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"emotional_state\\\",\\\"value\\\":\\\"hollow expression\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"props_carried\\\",\\\"value\\\":\\\"none visible; oar is at his feet, not carried\\\",\\\"confidence\\\":0.9}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"costume\\\",\\\"previous_value\\\":\\\"leather jacket zipped against the wind\\\",\\\"new_value\\\":\\\"leather jacket, torn at the left sleeve, soaked through\\\",\\\"reason\\\":\\\"Jacket is now torn and soaked, indicating damage and exposure to rain.\\\",\\\"evidence\\\":\\\"His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"physical_condition\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"dried blood visible on knuckles, soaked through\\\",\\\"reason\\\":\\\"Billy is now visibly injured and wet.\\\",\\\"evidence\\\":\\\"dried blood visible on his knuckles. Rain hammers the dock. BILLY sits... soaked through.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"emotional_state\\\",\\\"previous_value\\\":\\\"flat, resigned\\\",\\\"new_value\\\":\\\"hollow expression\\\",\\\"reason\\\":\\\"Billy's emotional state has shifted to hollow, indicating deeper shock or emptiness.\\\",\\\"evidence\\\":\\\"BILLY stares at the dark water, expression hollow.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"props_carried\\\",\\\"previous_value\\\":\\\"oar\\\",\\\"new_value\\\":\\\"none visible; oar is at his feet, not carried\\\",\\\"reason\\\":\\\"Oar is no longer being carried by Billy; it lies broken at his feet.\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9}],\\\"confidence\\\":1},{\\\"entity_key\\\":\\\"location:harbor_dock\\\",\\\"properties\\\":[{\\\"key\\\":\\\"lighting\\\",\\\"value\\\":\\\"nighttime darkness\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"time_of_day\\\",\\\"value\\\":\\\"night\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"weather\\\",\\\"value\\\":\\\"heavy rain\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"atmosphere\\\",\\\"value\\\":\\\"bleak, tense, desolate\\\",\\\"confidence\\\":0.9}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"lighting\\\",\\\"previous_value\\\":\\\"daylight\\\",\\\"new_value\\\":\\\"nighttime darkness\\\",\\\"reason\\\":\\\"Scene is now set at night.\\\",\\\"evidence\\\":\\\"EXT. HARBOR DOCK - NIGHT\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"time_of_day\\\",\\\"previous_value\\\":\\\"day\\\",\\\"new_value\\\":\\\"night\\\",\\\"reason\\\":\\\"Scene heading specifies night.\\\",\\\"evidence\\\":\\\"EXT. HARBOR DOCK - NIGHT\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"weather\\\",\\\"previous_value\\\":\\\"windy\\\",\\\"new_value\\\":\\\"heavy rain\\\",\\\"reason\\\":\\\"Rain is now the dominant weather condition.\\\",\\\"evidence\\\":\\\"Rain hammers the dock.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1}],\\\"confidence\\\":1},{\\\"entity_key\\\":\\\"prop:oar\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"broken in two pieces\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"at Billy's feet on the dock\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"no longer carried by Billy; on the ground\\\",\\\"confidence\\\":0.9}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":\\\"intact, weathered oak with rope-wrapped grip\\\",\\\"new_value\\\":\\\"broken in two pieces\\\",\\\"reason\\\":\\\"Oar is now broken.\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"position\\\",\\\"previous_value\\\":\\\"set against a piling\\\",\\\"new_value\\\":\\\"at Billy's feet on the dock\\\",\\\"reason\\\":\\\"Oar has been moved from its previous position.\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"ownership\\\",\\\"previous_value\\\":\\\"Billy\\\",\\\"new_value\\\":\\\"no longer carried by Billy; on the ground\\\",\\\"reason\\\":\\\"Oar is not being held or carried by Billy.\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet.\\\",\\\"is_explicit\\\":false,\\\"confidence\\\":0.9}],\\\"confidence\\\":1},{\\\"entity_key\\\":\\\"prop:envelope\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"open, contents scattered and wet\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"on the dock, contents in puddles\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"no longer held by anyone\\\",\\\"confidence\\\":1}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":\\\"sealed\\\",\\\"new_value\\\":\\\"open, contents scattered and wet\\\",\\\"reason\\\":\\\"Envelope has been opened and its contents are now scattered.\\\",\\\"evidence\\\":\\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"position\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"on the dock, contents in puddles\\\",\\\"reason\\\":\\\"Envelope and its contents are now on the dock, not held.\\\",\\\"evidence\\\":\\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"ownership\\\",\\\"previous_value\\\":\\\"Jane → Billy (handed over)\\\",\\\"new_value\\\":\\\"no longer held by anyone\\\",\\\"reason\\\":\\\"Envelope is not in anyone's possession.\\\",\\\"evidence\\\":\\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\\"is_explicit\\\":false,\\\"confidence\\\":1}],\\\"confidence\\\":1}]}\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "1ee2b541-9ba7-4ef7-9610-ad9ac7147c7b",
        "latencyMs": 20815,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 3,
        "provider": {
          "id": "openai:gpt-4.1",
          "label": "GPT-4.1"
        },
        "response": {
          "output": "{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket, torn at the left sleeve, soaked through\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"dried blood visible on knuckles, soaked through\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow expression\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none visible; oar is at his feet, not carried\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket, torn at the left sleeve, soaked through\",\n          \"reason\": \"Jacket is now torn and soaked, indicating damage and exposure to rain.\",\n          \"evidence\": \"His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"dried blood visible on knuckles, soaked through\",\n          \"reason\": \"Billy is now visibly injured and wet.\",\n          \"evidence\": \"dried blood visible on his knuckles. Rain hammers the dock. BILLY sits... soaked through.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow expression\",\n          \"reason\": \"Billy's emotional state has shifted to hollow, indicating deeper shock or emptiness.\",\n          \"evidence\": \"BILLY stares at the dark water, expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none visible; oar is at his feet, not carried\",\n          \"reason\": \"Oar is no longer being carried by Billy; it lies broken at his feet.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"nighttime darkness\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"heavy rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"bleak, tense, desolate\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"nighttime darkness\",\n          \"reason\": \"Scene is now set at night.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"Scene heading specifies night.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"heavy rain\",\n          \"reason\": \"Rain is now the dominant weather condition.\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"at Billy's feet on the dock\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"no longer carried by Billy; on the ground\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"Oar is now broken.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"at Billy's feet on the dock\",\n          \"reason\": \"Oar has been moved from its previous position.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": \"Billy\",\n          \"new_value\": \"no longer carried by Billy; on the ground\",\n          \"reason\": \"Oar is not being held or carried by Billy.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open, contents scattered and wet\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"on the dock, contents in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"no longer held by anyone\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered and wet\",\n          \"reason\": \"Envelope has been opened and its contents are now scattered.\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"on the dock, contents in puddles\",\n          \"reason\": \"Envelope and its contents are now on the dock, not held.\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": \"Jane → Billy (handed over)\",\n          \"new_value\": \"no longer held by anyone\",\n          \"reason\": \"Envelope is not in anyone's possession.\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": false,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}",
          "tokenUsage": {
            "total": 2671,
            "prompt": 897,
            "completion": 1774,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cached": false,
          "latencyMs": 20815,
          "finishReason": "stop",
          "cost": 0.015986,
          "guardrails": {
            "flagged": false
          },
          "metadata": {
            "http": {
              "status": 200,
              "statusText": "OK",
              "headers": {
                "access-control-expose-headers": "X-Request-ID",
                "alt-svc": "h3=\":443\"; ma=86400",
                "cf-cache-status": "DYNAMIC",
                "cf-ray": "9d5d9b7249ec6951-YVR",
                "connection": "keep-alive",
                "content-encoding": "br",
                "content-type": "application/json",
                "date": "Mon, 02 Mar 2026 04:20:29 GMT",
                "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
                "openai-processing-ms": "20613",
                "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
                "openai-version": "2020-10-01",
                "server": "cloudflare",
                "set-cookie": "__cf_bm=4r7TCU_52Akn1mvAFErJeUZ.Fpdr8bi4v.zE6bAGPd4-1772425208.6851923-1.0.1.1-PhqNtxGWXM0TnlQl5gxnykZCASu0NIEvs6guuNpKR995SvYxKdw.p8BAjPf3.yqYt7uD5bZ3_fy4ufaNwtsKqiEyMfKB0N7xfX0D7qgZopGCP_qWEFMQTf0iybz2Ygys; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:50:29 GMT",
                "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
                "transfer-encoding": "chunked",
                "x-content-type-options": "nosniff",
                "x-openai-proxy-wasm": "v0.1",
                "x-ratelimit-limit-requests": "10000",
                "x-ratelimit-limit-tokens": "2000000",
                "x-ratelimit-remaining-requests": "9999",
                "x-ratelimit-remaining-tokens": "1999134",
                "x-ratelimit-reset-requests": "6ms",
                "x-ratelimit-reset-tokens": "25ms",
                "x-request-id": "req_e3123b3337fa43388266aca35dca89bc"
              }
            }
          }
        },
        "score": 0.9466,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "http": {
            "status": 200,
            "statusText": "OK",
            "headers": {
              "access-control-expose-headers": "X-Request-ID",
              "alt-svc": "h3=\":443\"; ma=86400",
              "cf-cache-status": "DYNAMIC",
              "cf-ray": "9d5d9b7249ec6951-YVR",
              "connection": "keep-alive",
              "content-encoding": "br",
              "content-type": "application/json",
              "date": "Mon, 02 Mar 2026 04:20:29 GMT",
              "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
              "openai-processing-ms": "20613",
              "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
              "openai-version": "2020-10-01",
              "server": "cloudflare",
              "set-cookie": "__cf_bm=4r7TCU_52Akn1mvAFErJeUZ.Fpdr8bi4v.zE6bAGPd4-1772425208.6851923-1.0.1.1-PhqNtxGWXM0TnlQl5gxnykZCASu0NIEvs6guuNpKR995SvYxKdw.p8BAjPf3.yqYt7uD5bZ3_fy4ufaNwtsKqiEyMfKB0N7xfX0D7qgZopGCP_qWEFMQTf0iybz2Ygys; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:50:29 GMT",
              "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
              "transfer-encoding": "chunked",
              "x-content-type-options": "nosniff",
              "x-openai-proxy-wasm": "v0.1",
              "x-ratelimit-limit-requests": "10000",
              "x-ratelimit-limit-tokens": "2000000",
              "x-ratelimit-remaining-requests": "9999",
              "x-ratelimit-remaining-tokens": "1999134",
              "x-ratelimit-reset-requests": "6ms",
              "x-ratelimit-reset-tokens": "25ms",
              "x-request-id": "req_e3123b3337fa43388266aca35dca89bc"
            }
          },
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.01047,
        "gradingResult": {
          "pass": true,
          "score": 0.9228000000000001,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2909,
            "prompt": 2399,
            "completion": 510,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9456,
              "reason": "change_detection=0.94 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=0.90 | property_extraction=0.88 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.9,
              "reason": "The output demonstrates excellent continuity extraction across nearly all the key changes:\n\n1. **Jacket damage** (✅): Detected with change event from 'leather jacket zipped against the wind' to 'leather jacket torn at left sleeve, soaked through', with accurate evidence quote.\n\n2. **Physical injury - blood on knuckles** (✅): Detected with change event from 'no visible injuries' to 'dried blood on knuckles', with accurate evidence quote.\n\n3. **Oar broken** (✅): Detected with change event from 'intact, weathered oak with rope-wrapped grip' to 'broken in two pieces', with accurate evidence quote.\n\n4. **Envelope opened/scattered** (✅): Detected with change event from 'sealed' to 'open, contents scattered', with accurate evidence quote.\n\n5. **Time/weather changes** (✅): Both detected — day→night and windy→heavy rain, with evidence quotes from scene headers and action lines.\n\n6. **Billy soaked through** (✅): Captured in the costume property change, noting 'soaked through'.\n\n7. **Emotional state shift** (✅): Detected from 'flat, resigned' to 'hollow, withdrawn' with evidence.\n\n8. **Jane being gone** (❌/partial): Not explicitly tracked as a separate entity or change event. The reason field for emotional state mentions 'Jane is gone' but there's no dedicated entity state or change event for Jane's absence.\n\n9. **Evidence quotes** (✅): All change events are backed by actual quotes that appear to be from the scene text.\n\n10. **Previous values** (✅): Previous values are plausibly referenced (jacket zipped, oar intact with weathered oak, envelope sealed, etc.), suggesting good continuity tracking.\n\nThe output catches 8 of the 9 key changes (missing only an explicit tracking of Jane's departure as a separate entity/change). The JSON structure is well-organized with entities for character, location, and props. Confidence scores are reasonable. Evidence quotes are specific and accurate.",
              "tokensUsed": {
                "total": 2909,
                "prompt": 2399,
                "completion": 510,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_003\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket torn at left sleeve, soaked through\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"dried blood visible on knuckles, soaked\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"hollow, staring at dark water\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"none currently carried\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"new_value\\\": \\\"leather jacket torn at left sleeve, soaked through\\\",\\n          \\\"reason\\\": \\\"physical altercation and exposure to rain\\\",\\n          \\\"evidence\\\": \\\"His leather jacket is torn at the left sleeve — dried blood visible on his knuckles. Rain hammers the dock. BILLY sits on a coiled rope, soaked through.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"physical_condition\\\",\\n          \\\"previous_value\\\": \\\"no visible injuries\\\",\\n          \\\"new_value\\\": \\\"dried blood on knuckles\\\",\\n          \\\"reason\\\": \\\"physical confrontation occurred\\\",\\n          \\\"evidence\\\": \\\"His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"flat, resigned\\\",\\n          \\\"new_value\\\": \\\"hollow, withdrawn\\\",\\n          \\\"reason\\\": \\\"Jane is gone; emotional deterioration\\\",\\n          \\\"evidence\\\": \\\"BILLY stares at the dark water, expression hollow.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": \\\"oar\\\",\\n          \\\"new_value\\\": \\\"none currently carried\\\",\\n          \\\"reason\\\": \\\"oar is now broken and lying at his feet\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"night\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"heavy rain\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"dark, minimal visibility\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"bleak, desolate, melancholic\\\",\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"key\\\": \\\"damage_or_changes\\\",\\n          \\\"value\\\": \\\"puddles present, scattered contents from envelope\\\",\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"time_of_day\\\",\\n          \\\"previous_value\\\": \\\"day\\\",\\n          \\\"new_value\\\": \\\"night\\\",\\n          \\\"reason\\\": \\\"time progression\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": \\\"windy\\\",\\n          \\\"new_value\\\": \\\"heavy rain\\\",\\n          \\\"reason\\\": \\\"weather change\\\",\\n          \\\"evidence\\\": \\\"Rain hammers the dock.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"lighting\\\",\\n          \\\"previous_value\\\": \\\"daylight\\\",\\n          \\\"new_value\\\": \\\"dark, minimal visibility\\\",\\n          \\\"reason\\\": \\\"transition from day to night\\\",\\n          \\\"evidence\\\": \\\"BILLY stares at the dark water\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"property_key\\\": \\\"damage_or_changes\\\",\\n          \\\"previous_value\\\": \\\"none noted\\\",\\n          \\\"new_value\\\": \\\"puddles present, scattered envelope contents\\\",\\n          \\\"reason\\\": \\\"rain accumulation and envelope contents dispersed\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"confidence\\\": 0.98\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"broken in two pieces\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"lying at Billy's feet\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy\\\",\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"intact, weathered oak with rope-wrapped grip\\\",\\n          \\\"new_value\\\": \\\"broken in two pieces\\\",\\n          \\\"reason\\\": \\\"physical damage, likely from altercation\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"set against a piling\\\",\\n          \\\"new_value\\\": \\\"lying at Billy's feet\\\",\\n          \\\"reason\\\": \\\"displaced during conflict or aftermath\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.98\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"open, contents scattered\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"contents scattered in puddles\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy (previously Jane)\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"sealed\\\",\\n          \\\"new_value\\\": \\\"open, contents scattered\\\",\\n          \\\"reason\\\": \\\"envelope opened and dispersed\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"in Billy's possession (handed over)\\\",\\n          \\\"new_value\\\": \\\"contents scattered in puddles at dock\\\",\\n          \\\"reason\\\": \\\"envelope opened and contents dispersed by rain or action\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "6b23d34d-cf79-4cfb-920f-1b7e9f935e34",
        "latencyMs": 9404,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 4,
        "provider": {
          "id": "anthropic:messages:claude-haiku-4-5-20251001",
          "label": "Claude Haiku 4.5"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket torn at left sleeve, soaked through\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"dried blood visible on knuckles, soaked\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow, staring at dark water\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none currently carried\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket torn at left sleeve, soaked through\",\n          \"reason\": \"physical altercation and exposure to rain\",\n          \"evidence\": \"His leather jacket is torn at the left sleeve — dried blood visible on his knuckles. Rain hammers the dock. BILLY sits on a coiled rope, soaked through.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": \"no visible injuries\",\n          \"new_value\": \"dried blood on knuckles\",\n          \"reason\": \"physical confrontation occurred\",\n          \"evidence\": \"His leather jacket is torn at the left sleeve — dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow, withdrawn\",\n          \"reason\": \"Jane is gone; emotional deterioration\",\n          \"evidence\": \"BILLY stares at the dark water, expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none currently carried\",\n          \"reason\": \"oar is now broken and lying at his feet\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"heavy rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"lighting\",\n          \"value\": \"dark, minimal visibility\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"bleak, desolate, melancholic\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"puddles present, scattered contents from envelope\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"time progression\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"heavy rain\",\n          \"reason\": \"weather change\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"dark, minimal visibility\",\n          \"reason\": \"transition from day to night\",\n          \"evidence\": \"BILLY stares at the dark water\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"damage_or_changes\",\n          \"previous_value\": \"none noted\",\n          \"new_value\": \"puddles present, scattered envelope contents\",\n          \"reason\": \"rain accumulation and envelope contents dispersed\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.98\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"lying at Billy's feet\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"physical damage, likely from altercation\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"lying at Billy's feet\",\n          \"reason\": \"displaced during conflict or aftermath\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.98\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open, contents scattered\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"contents scattered in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy (previously Jane)\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered\",\n          \"reason\": \"envelope opened and dispersed\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"in Billy's possession (handed over)\",\n          \"new_value\": \"contents scattered in puddles at dock\",\n          \"reason\": \"envelope opened and contents dispersed by rain or action\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.95\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "total": 2846,
            "prompt": 940,
            "completion": 1906
          },
          "finishReason": "stop",
          "cost": 0.01047
        },
        "score": 0.9228000000000001,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.007745800000000001,
        "gradingResult": {
          "pass": true,
          "score": 0.9128000000000001,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2911,
            "prompt": 2444,
            "completion": 467,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9456,
              "reason": "change_detection=0.94 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=0.90 | property_extraction=0.88 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.88,
              "reason": "The output demonstrates strong continuity extraction across nearly all the key changes:\n\n1. **Jacket damage** (✅): Detected with evidence quote about torn left sleeve and soaked through. Previous value correctly referenced as 'leather jacket zipped against the wind'.\n\n2. **Physical injury - blood on knuckles** (✅): Detected as a new physical condition with evidence 'dried blood visible on his knuckles'. Previous value is null, which is reasonable if no prior physical condition was tracked.\n\n3. **Emotional state shift** (✅): Detected from 'flat, resigned' to 'hollow' with evidence quote.\n\n4. **Billy soaked through** (✅): Captured under physical_condition.\n\n5. **Oar broken** (✅): Detected with condition change from 'intact, weathered oak with rope-wrapped grip' to 'broken in two pieces', and position change. Evidence quotes are accurate.\n\n6. **Envelope opened/scattered** (✅): Detected with condition change from 'sealed' to 'open, contents scattered' with evidence.\n\n7. **Weather change** (✅): From 'windy' to 'rain' with evidence 'Rain hammers the dock.'\n\n8. **Time change** (✅): Day to night detected with evidence from the slug line.\n\n9. **Jane missing** (❌): This is the one notable omission. The output does not track that Jane was present in the previous scene and is now absent. This is a significant continuity detail.\n\nAll change events are backed by actual quotes/evidence from the scene. Previous values are correctly referenced (jacket zipped, oar intact/weathered oak, envelope sealed, windy weather, daylight/day). The confidence scores are reasonable.\n\nThe output catches 8 of 9 changes with accurate evidence quotes, missing only Jane's absence. This is a very strong extraction.",
              "tokensUsed": {
                "total": 2911,
                "prompt": 2444,
                "completion": 467,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_003\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket torn at the left sleeve, soaked through\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"hollow\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"soaked through, dried blood visible on knuckles\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"none\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"new_value\\\": \\\"leather jacket torn at the left sleeve, soaked through\\\",\\n          \\\"reason\\\": \\\"Jacket is now torn and Billy is wet from the rain.\\\",\\n          \\\"evidence\\\": \\\"His leather jacket is torn at the left sleeve — Billy sits on a coiled rope, soaked through.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"flat, resigned\\\",\\n          \\\"new_value\\\": \\\"hollow\\\",\\n          \\\"reason\\\": \\\"Billy's expression has changed.\\\",\\n          \\\"evidence\\\": \\\"BILLY stares at the dark water, expression hollow.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"physical_condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"soaked through, dried blood visible on knuckles\\\",\\n          \\\"reason\\\": \\\"New observable physical conditions.\\\",\\n          \\\"evidence\\\": \\\"BILLY sits on a coiled rope, soaked through. — dried blood visible on his knuckles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": \\\"oar\\\",\\n          \\\"new_value\\\": \\\"none\\\",\\n          \\\"reason\\\": \\\"The oar is no longer being carried by Billy; it's at his feet.\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"night\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"night\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"rain\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"damage_or_changes\\\",\\n          \\\"value\\\": \\\"puddles on the dock\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"dark, somber\\\",\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"lighting\\\",\\n          \\\"previous_value\\\": \\\"daylight\\\",\\n          \\\"new_value\\\": \\\"night\\\",\\n          \\\"reason\\\": \\\"The scene has transitioned to night.\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"time_of_day\\\",\\n          \\\"previous_value\\\": \\\"day\\\",\\n          \\\"new_value\\\": \\\"night\\\",\\n          \\\"reason\\\": \\\"The scene has transitioned to night.\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": \\\"windy\\\",\\n          \\\"new_value\\\": \\\"rain\\\",\\n          \\\"reason\\\": \\\"The weather has changed from windy to rainy.\\\",\\n          \\\"evidence\\\": \\\"Rain hammers the dock.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"damage_or_changes\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"puddles on the dock\\\",\\n          \\\"reason\\\": \\\"Rain has created puddles on the dock.\\\",\\n          \\\"evidence\\\": \\\"contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"atmosphere\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"dark, somber\\\",\\n          \\\"reason\\\": \\\"The description of the water and overall setting implies a somber mood.\\\",\\n          \\\"evidence\\\": \\\"dark water\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"broken in two pieces\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"at Billy's feet\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy\\\",\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"intact, weathered oak with rope-wrapped grip\\\",\\n          \\\"new_value\\\": \\\"broken in two pieces\\\",\\n          \\\"reason\\\": \\\"The oar has been broken.\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"set against a piling\\\",\\n          \\\"new_value\\\": \\\"at Billy's feet\\\",\\n          \\\"reason\\\": \\\"The oar's location has changed.\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"open, contents scattered\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"in puddles\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy\\\",\\n          \\\"confidence\\\": 0.7\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"sealed\\\",\\n          \\\"new_value\\\": \\\"open, contents scattered\\\",\\n          \\\"reason\\\": \\\"The envelope has been opened and its contents dispersed.\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"in puddles\\\",\\n          \\\"reason\\\": \\\"The envelope and its contents are now in puddles.\\\",\\n          \\\"evidence\\\": \\\"contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "5b3a0517-c66b-4cbe-8d3f-c51a539eba6f",
        "latencyMs": 12017,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 7,
        "provider": {
          "id": "google:gemini-2.5-flash",
          "label": "Gemini 2.5 Flash"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"soaked through, dried blood visible on knuckles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"reason\": \"Jacket is now torn and Billy is wet from the rain.\",\n          \"evidence\": \"His leather jacket is torn at the left sleeve — Billy sits on a coiled rope, soaked through.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow\",\n          \"reason\": \"Billy's expression has changed.\",\n          \"evidence\": \"BILLY stares at the dark water, expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"soaked through, dried blood visible on knuckles\",\n          \"reason\": \"New observable physical conditions.\",\n          \"evidence\": \"BILLY sits on a coiled rope, soaked through. — dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none\",\n          \"reason\": \"The oar is no longer being carried by Billy; it's at his feet.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"puddles on the dock\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"dark, somber\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"night\",\n          \"reason\": \"The scene has transitioned to night.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"The scene has transitioned to night.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"rain\",\n          \"reason\": \"The weather has changed from windy to rainy.\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"damage_or_changes\",\n          \"previous_value\": null,\n          \"new_value\": \"puddles on the dock\",\n          \"reason\": \"Rain has created puddles on the dock.\",\n          \"evidence\": \"contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"atmosphere\",\n          \"previous_value\": null,\n          \"new_value\": \"dark, somber\",\n          \"reason\": \"The description of the water and overall setting implies a somber mood.\",\n          \"evidence\": \"dark water\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"at Billy's feet\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"The oar has been broken.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"at Billy's feet\",\n          \"reason\": \"The oar's location has changed.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open, contents scattered\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered\",\n          \"reason\": \"The envelope has been opened and its contents dispersed.\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"in puddles\",\n          \"reason\": \"The envelope and its contents are now in puddles.\",\n          \"evidence\": \"contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "prompt": 961,
            "completion": 1934,
            "total": 3944,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 1049,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cost": 0.007745800000000001,
          "raw": {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"soaked through, dried blood visible on knuckles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"reason\": \"Jacket is now torn and Billy is wet from the rain.\",\n          \"evidence\": \"His leather jacket is torn at the left sleeve — Billy sits on a coiled rope, soaked through.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow\",\n          \"reason\": \"Billy's expression has changed.\",\n          \"evidence\": \"BILLY stares at the dark water, expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"soaked through, dried blood visible on knuckles\",\n          \"reason\": \"New observable physical conditions.\",\n          \"evidence\": \"BILLY sits on a coiled rope, soaked through. — dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none\",\n          \"reason\": \"The oar is no longer being carried by Billy; it's at his feet.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"puddles on the dock\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"dark, somber\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"night\",\n          \"reason\": \"The scene has transitioned to night.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"The scene has transitioned to night.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"rain\",\n          \"reason\": \"The weather has changed from windy to rainy.\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"damage_or_changes\",\n          \"previous_value\": null,\n          \"new_value\": \"puddles on the dock\",\n          \"reason\": \"Rain has created puddles on the dock.\",\n          \"evidence\": \"contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"atmosphere\",\n          \"previous_value\": null,\n          \"new_value\": \"dark, somber\",\n          \"reason\": \"The description of the water and overall setting implies a somber mood.\",\n          \"evidence\": \"dark water\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"at Billy's feet\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"The oar has been broken.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"at Billy's feet\",\n          \"reason\": \"The oar's location has changed.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open, contents scattered\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered\",\n          \"reason\": \"The envelope has been opened and its contents dispersed.\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"in puddles\",\n          \"reason\": \"The envelope and its contents are now in puddles.\",\n          \"evidence\": \"contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```"
                    }
                  ],
                  "role": "model"
                },
                "finishReason": "STOP",
                "index": 0
              }
            ],
            "usageMetadata": {
              "promptTokenCount": 961,
              "candidatesTokenCount": 1934,
              "totalTokenCount": 3944,
              "promptTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 961
                }
              ],
              "thoughtsTokenCount": 1049
            },
            "modelVersion": "gemini-2.5-flash",
            "responseId": "FhClabTxIeW6qtsPvazTqAg"
          },
          "cached": false,
          "metadata": {}
        },
        "score": 0.9128000000000001,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.02964,
        "gradingResult": {
          "pass": true,
          "score": 0.9128000000000001,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2740,
            "prompt": 2281,
            "completion": 459,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9456,
              "reason": "change_detection=0.94 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=0.90 | property_extraction=0.88 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.88,
              "reason": "The output demonstrates strong continuity extraction across nearly all the key changes:\n\n1. **Jacket damage** (✅): Detected with evidence quote 'His leather jacket is torn at the left sleeve' and correct previous value.\n2. **Physical injury - blood on knuckles** (✅): Detected with evidence 'dried blood visible on his knuckles' and notes it's likely from physical altercation.\n3. **Oar broken** (✅): Detected with evidence 'The OAR lies broken in two pieces at his feet' and correct previous value 'intact, weathered oak with rope-wrapped grip'.\n4. **Envelope opened/scattered** (✅): Detected with evidence 'The ENVELOPE is open, contents scattered in puddles' and correct previous value 'sealed'.\n5. **Time/weather changes** (✅): Both day→night and windy→heavy rain detected with proper evidence quotes ('EXT. HARBOR DOCK - NIGHT', 'Rain hammers the dock').\n6. **Emotional state shift** (✅): flat/resigned → hollow, with evidence 'BILLY stares at the dark water, expression hollow'.\n7. **Billy soaked through** (✅): Captured in both costume and physical_condition properties.\n8. **Props carried change** (✅): oar → none, correctly noting the oar is broken at his feet.\n9. **Jane's absence** (❌): Not mentioned at all. This is a notable omission — Jane was present in the previous scene and is now gone, which is a significant continuity point.\n\nAll change events are backed by evidence quotes that appear to be actual scene text. Previous values are referenced correctly and consistently. The output catches 8 of the 9 key changes with accurate evidence. The only miss is Jane's disappearance. The JSON structure is well-organized with appropriate confidence scores. Overall this is a very strong extraction.",
              "tokensUsed": {
                "total": 2740,
                "prompt": 2281,
                "completion": 459,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_003\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket torn at the left sleeve, soaked through\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"dried blood visible on knuckles, soaked through from rain\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"hollow, staring at dark water\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"none\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"new_value\\\": \\\"leather jacket torn at the left sleeve, soaked through\\\",\\n          \\\"reason\\\": \\\"jacket damaged at left sleeve and soaked from rain\\\",\\n          \\\"evidence\\\": \\\"His leather jacket is torn at the left sleeve\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"physical_condition\\\",\\n          \\\"previous_value\\\": \\\"no visible injuries mentioned\\\",\\n          \\\"new_value\\\": \\\"dried blood visible on knuckles, soaked through from rain\\\",\\n          \\\"reason\\\": \\\"sustained injuries to hands, likely from physical altercation\\\",\\n          \\\"evidence\\\": \\\"dried blood visible on his knuckles\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"flat, resigned\\\",\\n          \\\"new_value\\\": \\\"hollow, staring at dark water\\\",\\n          \\\"reason\\\": \\\"emotional state has deepened from resignation to emptiness\\\",\\n          \\\"evidence\\\": \\\"BILLY stares at the dark water, expression hollow\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": \\\"oar\\\",\\n          \\\"new_value\\\": \\\"none\\\",\\n          \\\"reason\\\": \\\"oar is now broken and lying at his feet, no longer carried\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"night\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"heavy rain\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"dark, nighttime\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"bleak, desolate, rain-soaked\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"time_of_day\\\",\\n          \\\"previous_value\\\": \\\"day\\\",\\n          \\\"new_value\\\": \\\"night\\\",\\n          \\\"reason\\\": \\\"time has passed from previous scene\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": \\\"windy\\\",\\n          \\\"new_value\\\": \\\"heavy rain\\\",\\n          \\\"reason\\\": \\\"weather conditions have changed to rain\\\",\\n          \\\"evidence\\\": \\\"Rain hammers the dock\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"lighting\\\",\\n          \\\"previous_value\\\": \\\"daylight\\\",\\n          \\\"new_value\\\": \\\"dark, nighttime\\\",\\n          \\\"reason\\\": \\\"transition from day to night\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"broken in two pieces\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"lying at Billy's feet\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy\\\",\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"intact, weathered oak with rope-wrapped grip\\\",\\n          \\\"new_value\\\": \\\"broken in two pieces\\\",\\n          \\\"reason\\\": \\\"oar was broken, likely during physical altercation\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"set against a piling\\\",\\n          \\\"new_value\\\": \\\"lying at Billy's feet\\\",\\n          \\\"reason\\\": \\\"oar moved and broken, now on ground\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"open, contents scattered in puddles\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"contents scattered in puddles on dock\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy (abandoned/discarded)\\\",\\n          \\\"confidence\\\": 0.85\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"sealed\\\",\\n          \\\"new_value\\\": \\\"open, contents scattered in puddles\\\",\\n          \\\"reason\\\": \\\"envelope was opened and contents spilled or thrown\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"with Billy (handed over from Jane)\\\",\\n          \\\"new_value\\\": \\\"contents scattered in puddles on dock\\\",\\n          \\\"reason\\\": \\\"envelope opened and contents dispersed on wet dock\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.9\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "63ab6b8c-809c-4593-bed4-110e7ee8564e",
        "latencyMs": 18806,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 5,
        "provider": {
          "id": "anthropic:messages:claude-sonnet-4-5-20250929",
          "label": "Claude Sonnet 4.5"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"dried blood visible on knuckles, soaked through from rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow, staring at dark water\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"reason\": \"jacket damaged at left sleeve and soaked from rain\",\n          \"evidence\": \"His leather jacket is torn at the left sleeve\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": \"no visible injuries mentioned\",\n          \"new_value\": \"dried blood visible on knuckles, soaked through from rain\",\n          \"reason\": \"sustained injuries to hands, likely from physical altercation\",\n          \"evidence\": \"dried blood visible on his knuckles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow, staring at dark water\",\n          \"reason\": \"emotional state has deepened from resignation to emptiness\",\n          \"evidence\": \"BILLY stares at the dark water, expression hollow\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none\",\n          \"reason\": \"oar is now broken and lying at his feet, no longer carried\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"heavy rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"lighting\",\n          \"value\": \"dark, nighttime\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"bleak, desolate, rain-soaked\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"time has passed from previous scene\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"heavy rain\",\n          \"reason\": \"weather conditions have changed to rain\",\n          \"evidence\": \"Rain hammers the dock\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"dark, nighttime\",\n          \"reason\": \"transition from day to night\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"lying at Billy's feet\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"oar was broken, likely during physical altercation\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"lying at Billy's feet\",\n          \"reason\": \"oar moved and broken, now on ground\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open, contents scattered in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"contents scattered in puddles on dock\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy (abandoned/discarded)\",\n          \"confidence\": 0.85\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered in puddles\",\n          \"reason\": \"envelope was opened and contents spilled or thrown\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"with Billy (handed over from Jane)\",\n          \"new_value\": \"contents scattered in puddles on dock\",\n          \"reason\": \"envelope opened and contents dispersed on wet dock\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.9\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "total": 2728,
            "prompt": 940,
            "completion": 1788
          },
          "finishReason": "stop",
          "cost": 0.02964
        },
        "score": 0.9128000000000001,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0,
        "gradingResult": {
          "pass": true,
          "score": 0.9816,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 3478,
            "prompt": 2989,
            "completion": 489,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9632,
              "reason": "change_detection=0.96 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=0.90 | property_extraction=0.93 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 1,
              "reason": "The output is exceptionally thorough and catches all 9 of the 9 key continuity changes listed in the rubric:\n\n1. **Jacket damage** — Detected as a change event on `character:billy` costume property, with previous value 'leather jacket zipped against the wind' → 'leather jacket torn at the left sleeve, soaked through', with direct evidence quote.\n2. **Physical injury (blood on knuckles)** — Detected under `physical_condition` with evidence quote 'dried blood visible on his knuckles'.\n3. **Oar broken** — Detected as a dedicated entity `prop:oar` with condition change from 'intact, weathered oak with rope-wrapped grip' → 'broken in two pieces', with evidence quote.\n4. **Envelope opened/scattered** — Detected as `prop:envelope` with condition change from 'sealed' → 'open; contents scattered and wet in puddles', with evidence quote.\n5. **Time change (day → night)** — Detected under `location:harbor_dock` with explicit evidence 'EXT. HARBOR DOCK - NIGHT'.\n6. **Weather change (windy → heavy rain)** — Detected with evidence 'Rain hammers the dock.'\n7. **Billy soaked through** — Captured in both costume and physical_condition properties.\n8. **Emotional state shift (flat → hollow)** — Detected with evidence quote.\n9. **Jane's absence** — Noted in the location's damage_or_changes property ('Jane absent') and in the envelope ownership change event ('JANE is gone').\n\nAll change events are backed by actual quotes from the scene. Previous values are correctly referenced (jacket zipped, oar intact/weathered oak, envelope sealed, day, windy, flat/resigned emotional state). The structure is well-organized with confidence scores and explicit/implicit flags. The only minor note is that Jane's departure isn't tracked as a separate character entity change event, but it is captured in the location and envelope entities. This is a very strong extraction.",
              "tokensUsed": {
                "total": 3478,
                "prompt": 2989,
                "completion": 489,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_003\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket, torn at the left sleeve, soaked through\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"dried blood on knuckles; soaked through from rain\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"hollow, dissociated — staring blankly at dark water\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"none — oar is no longer in his possession\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"new_value\\\": \\\"leather jacket torn at the left sleeve, soaked through\\\",\\n          \\\"reason\\\": \\\"Jacket sustained damage (torn sleeve) and is rain-soaked since scene transition from day/wind to night/rain\\\",\\n          \\\"evidence\\\": \\\"His leather jacket is torn at the left sleeve\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"physical_condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"dried blood on knuckles; soaked through from rain\\\",\\n          \\\"reason\\\": \\\"First explicit mention of physical injury and rain saturation; dried blood implies injury occurred prior to this scene\\\",\\n          \\\"evidence\\\": \\\"dried blood visible on his knuckles. Rain hammers the dock. BILLY sits on a coiled rope, soaked through.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"flat, resigned\\\",\\n          \\\"new_value\\\": \\\"hollow, dissociated — staring blankly at dark water\\\",\\n          \\\"reason\\\": \\\"Emotional state has deepened from resigned flatness to a more vacant, hollow affect following apparent confrontation and Jane's departure\\\",\\n          \\\"evidence\\\": \\\"BILLY stares at the dark water, expression hollow.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": \\\"oar\\\",\\n          \\\"new_value\\\": \\\"none\\\",\\n          \\\"reason\\\": \\\"The oar is now broken and lying at his feet rather than being carried or held by Billy\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"confidence\\\": 0.97\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"night\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"heavy rain\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"dark; no daylight — implied low/ambient artificial light or none described\\\",\\n          \\\"confidence\\\": 0.85\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"bleak, isolating, oppressive — rain-hammered dock with scattered debris in puddles\\\",\\n          \\\"confidence\\\": 0.95\\n        },\\n        {\\n          \\\"key\\\": \\\"damage_or_changes\\\",\\n          \\\"value\\\": \\\"envelope contents scattered in puddles; broken oar on dock; Jane absent\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"time_of_day\\\",\\n          \\\"previous_value\\\": \\\"day\\\",\\n          \\\"new_value\\\": \\\"night\\\",\\n          \\\"reason\\\": \\\"Scene header explicitly sets the scene at night\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": \\\"windy\\\",\\n          \\\"new_value\\\": \\\"heavy rain\\\",\\n          \\\"reason\\\": \\\"Scene description opens with rain hammering the dock; wind not mentioned (may still be present but rain is now dominant)\\\",\\n          \\\"evidence\\\": \\\"Rain hammers the dock.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"lighting\\\",\\n          \\\"previous_value\\\": \\\"daylight\\\",\\n          \\\"new_value\\\": \\\"dark; night lighting — no artificial sources described, ambient darkness implied\\\",\\n          \\\"reason\\\": \\\"Time of day has shifted to night, eliminating daylight\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"property_key\\\": \\\"atmosphere\\\",\\n          \\\"previous_value\\\": \\\"windy\\\",\\n          \\\"new_value\\\": \\\"bleak, isolating, oppressive — rain-hammered dock with scattered debris in puddles\\\",\\n          \\\"reason\\\": \\\"Combination of night, heavy rain, broken prop, scattered envelope contents, and Billy's hollow affect creates a markedly darker atmosphere\\\",\\n          \\\"evidence\\\": \\\"Rain hammers the dock. [...] BILLY stares at the dark water, expression hollow.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.85\\n        },\\n        {\\n          \\\"property_key\\\": \\\"damage_or_changes\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"envelope contents scattered in puddles; broken oar on dock surface\\\",\\n          \\\"reason\\\": \\\"New physical debris present on the dock not previously described\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet. [...] the ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"broken in two pieces\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"lying at Billy's feet on the dock\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"unowned / abandoned — no longer held or carried by Billy\\\",\\n          \\\"confidence\\\": 0.85\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"intact, weathered oak with rope-wrapped grip\\\",\\n          \\\"new_value\\\": \\\"broken in two pieces\\\",\\n          \\\"reason\\\": \\\"Oar has been broken, likely during an off-screen confrontation between scenes\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"set against a piling\\\",\\n          \\\"new_value\\\": \\\"lying at Billy's feet on the dock\\\",\\n          \\\"reason\\\": \\\"Oar has moved from its resting position against the piling to the dock floor near Billy\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"ownership\\\",\\n          \\\"previous_value\\\": \\\"Billy\\\",\\n          \\\"new_value\\\": \\\"unowned / abandoned\\\",\\n          \\\"reason\\\": \\\"Oar is broken and discarded on the ground; Billy is no longer carrying or holding it\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"open; contents scattered and wet in puddles\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"contents dispersed across the dock in puddles\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"unowned / abandoned — no longer held by any character\\\",\\n          \\\"confidence\\\": 0.85\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"sealed\\\",\\n          \\\"new_value\\\": \\\"open; contents scattered and wet in puddles\\\",\\n          \\\"reason\\\": \\\"Envelope has been opened and its contents have been dispersed, likely during the off-screen confrontation\\\",\\n          \\\"evidence\\\": \\\"the ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"contents dispersed across the dock surface in puddles\\\",\\n          \\\"reason\\\": \\\"Contents are no longer contained within the envelope; scattered across the wet dock\\\",\\n          \\\"evidence\\\": \\\"the ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"ownership\\\",\\n          \\\"previous_value\\\": \\\"Jane → Billy (handed over)\\\",\\n          \\\"new_value\\\": \\\"unowned / abandoned\\\",\\n          \\\"reason\\\": \\\"Envelope and contents are scattered on the ground with no character in possession; Jane is gone\\\",\\n          \\\"evidence\\\": \\\"JANE is gone. The ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "79f586a7-ec1e-4751-bc6d-f1f62496365a",
        "latencyMs": 29588,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 6,
        "provider": {
          "id": "anthropic:messages:claude-sonnet-4-6",
          "label": "Claude Sonnet 4.6"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket, torn at the left sleeve, soaked through\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"dried blood on knuckles; soaked through from rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow, dissociated — staring blankly at dark water\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none — oar is no longer in his possession\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"reason\": \"Jacket sustained damage (torn sleeve) and is rain-soaked since scene transition from day/wind to night/rain\",\n          \"evidence\": \"His leather jacket is torn at the left sleeve\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"dried blood on knuckles; soaked through from rain\",\n          \"reason\": \"First explicit mention of physical injury and rain saturation; dried blood implies injury occurred prior to this scene\",\n          \"evidence\": \"dried blood visible on his knuckles. Rain hammers the dock. BILLY sits on a coiled rope, soaked through.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow, dissociated — staring blankly at dark water\",\n          \"reason\": \"Emotional state has deepened from resigned flatness to a more vacant, hollow affect following apparent confrontation and Jane's departure\",\n          \"evidence\": \"BILLY stares at the dark water, expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none\",\n          \"reason\": \"The oar is now broken and lying at his feet rather than being carried or held by Billy\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.97\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"heavy rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"lighting\",\n          \"value\": \"dark; no daylight — implied low/ambient artificial light or none described\",\n          \"confidence\": 0.85\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"bleak, isolating, oppressive — rain-hammered dock with scattered debris in puddles\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"envelope contents scattered in puddles; broken oar on dock; Jane absent\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"Scene header explicitly sets the scene at night\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"heavy rain\",\n          \"reason\": \"Scene description opens with rain hammering the dock; wind not mentioned (may still be present but rain is now dominant)\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"dark; night lighting — no artificial sources described, ambient darkness implied\",\n          \"reason\": \"Time of day has shifted to night, eliminating daylight\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"atmosphere\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"bleak, isolating, oppressive — rain-hammered dock with scattered debris in puddles\",\n          \"reason\": \"Combination of night, heavy rain, broken prop, scattered envelope contents, and Billy's hollow affect creates a markedly darker atmosphere\",\n          \"evidence\": \"Rain hammers the dock. [...] BILLY stares at the dark water, expression hollow.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.85\n        },\n        {\n          \"property_key\": \"damage_or_changes\",\n          \"previous_value\": null,\n          \"new_value\": \"envelope contents scattered in puddles; broken oar on dock surface\",\n          \"reason\": \"New physical debris present on the dock not previously described\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet. [...] the ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"lying at Billy's feet on the dock\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"unowned / abandoned — no longer held or carried by Billy\",\n          \"confidence\": 0.85\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"Oar has been broken, likely during an off-screen confrontation between scenes\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"lying at Billy's feet on the dock\",\n          \"reason\": \"Oar has moved from its resting position against the piling to the dock floor near Billy\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": \"Billy\",\n          \"new_value\": \"unowned / abandoned\",\n          \"reason\": \"Oar is broken and discarded on the ground; Billy is no longer carrying or holding it\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open; contents scattered and wet in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"contents dispersed across the dock in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"unowned / abandoned — no longer held by any character\",\n          \"confidence\": 0.85\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open; contents scattered and wet in puddles\",\n          \"reason\": \"Envelope has been opened and its contents have been dispersed, likely during the off-screen confrontation\",\n          \"evidence\": \"the ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"contents dispersed across the dock surface in puddles\",\n          \"reason\": \"Contents are no longer contained within the envelope; scattered across the wet dock\",\n          \"evidence\": \"the ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": \"Jane → Billy (handed over)\",\n          \"new_value\": \"unowned / abandoned\",\n          \"reason\": \"Envelope and contents are scattered on the ground with no character in possession; Jane is gone\",\n          \"evidence\": \"JANE is gone. The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.8\n        }\n      ],\n      \"confidence\": 0.95\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "total": 3436,
            "prompt": 940,
            "completion": 2496
          },
          "finishReason": "stop"
        },
        "score": 0.9816,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.0091205,
        "gradingResult": {
          "pass": true,
          "score": 0.9128000000000001,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2588,
            "prompt": 2162,
            "completion": 426,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9456,
              "reason": "change_detection=0.94 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=0.90 | property_extraction=0.88 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.88,
              "reason": "The output demonstrates strong continuity extraction across nearly all the key changes:\n\n1. **Jacket damage** (✅): Detected with change from 'leather jacket zipped against the wind' to 'leather jacket torn at the left sleeve, soaked through', with evidence quote.\n2. **Blood on knuckles** (✅): Detected as a new physical_condition property with evidence 'dried blood visible on his knuckles'.\n3. **Oar broken** (✅): Detected with change from 'intact, weathered oak with rope-wrapped grip' to 'broken in two pieces', with evidence quote.\n4. **Envelope opened/scattered** (✅): Detected with change from 'sealed' to 'open, contents scattered', with evidence quote.\n5. **Time change** (✅): Day to night detected with evidence from scene heading.\n6. **Weather change** (✅): Windy to heavy rain detected with evidence 'Rain hammers the dock.'\n7. **Emotional state shift** (✅): Flat/resigned to hollow, with evidence 'expression hollow'.\n8. **Billy soaked through** (✅): Captured within the costume property change.\n9. **Jane's absence** (❌): Not tracked. This is a notable omission — Jane being gone is a significant continuity change that should have been captured as a character entity with a presence/location change.\n\nAll change events are backed by actual evidence quotes that appear to be from the scene text. Previous values are referenced and appear reasonable/accurate. The confidence scores are well-calibrated. The structure is clean and comprehensive.\n\nThe output catches 8 of 9 changes with accurate evidence quotes, missing only Jane's departure. This is a strong performance on a difficult test case.",
              "tokensUsed": {
                "total": 2588,
                "prompt": 2162,
                "completion": 426,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_003\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"leather jacket torn at the left sleeve, soaked through\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"dried blood visible on knuckles\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"hollow\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"none\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"new_value\\\": \\\"leather jacket torn at the left sleeve, soaked through\\\",\\n          \\\"reason\\\": \\\"Exposure to rain and likely physical struggle\\\",\\n          \\\"evidence\\\": \\\"soaked through. His leather jacket is torn at the left sleeve\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"physical_condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"dried blood visible on knuckles\\\",\\n          \\\"reason\\\": \\\"Likely physical altercation or accident\\\",\\n          \\\"evidence\\\": \\\"dried blood visible on his knuckles\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"flat, resigned\\\",\\n          \\\"new_value\\\": \\\"hollow\\\",\\n          \\\"reason\\\": \\\"Reaction to Jane's departure and current situation\\\",\\n          \\\"evidence\\\": \\\"expression hollow\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": \\\"oar\\\",\\n          \\\"new_value\\\": \\\"none\\\",\\n          \\\"reason\\\": \\\"The oar is broken and lying on the ground\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"night\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"night\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"heavy rain\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"dark, bleak, and wet\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"time_of_day\\\",\\n          \\\"previous_value\\\": \\\"day\\\",\\n          \\\"new_value\\\": \\\"night\\\",\\n          \\\"reason\\\": \\\"Time has passed\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": \\\"windy\\\",\\n          \\\"new_value\\\": \\\"heavy rain\\\",\\n          \\\"reason\\\": \\\"Weather progression\\\",\\n          \\\"evidence\\\": \\\"Rain hammers the dock.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"lighting\\\",\\n          \\\"previous_value\\\": \\\"daylight\\\",\\n          \\\"new_value\\\": \\\"night\\\",\\n          \\\"reason\\\": \\\"Change in time of day\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"broken in two pieces\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"at Billy's feet\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy\\\",\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"intact, weathered oak with rope-wrapped grip\\\",\\n          \\\"new_value\\\": \\\"broken in two pieces\\\",\\n          \\\"reason\\\": \\\"Physical damage\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"set against a piling\\\",\\n          \\\"new_value\\\": \\\"at his feet\\\",\\n          \\\"reason\\\": \\\"Dropped or discarded after breaking\\\",\\n          \\\"evidence\\\": \\\"at his feet\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"open, contents scattered\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"scattered in puddles\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy\\\",\\n          \\\"confidence\\\": 0.7\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"sealed\\\",\\n          \\\"new_value\\\": \\\"open, contents scattered\\\",\\n          \\\"reason\\\": \\\"The envelope was opened and its contents dropped\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"handed over\\\",\\n          \\\"new_value\\\": \\\"scattered in puddles\\\",\\n          \\\"reason\\\": \\\"Dropped or discarded\\\",\\n          \\\"evidence\\\": \\\"contents scattered in puddles\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.9\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "8c00c951-d8fd-49e0-881c-5bc55d8f93d5",
        "latencyMs": 15814,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 8,
        "provider": {
          "id": "google:gemini-3-flash-preview",
          "label": "Gemini 3 Flash"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"dried blood visible on knuckles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"reason\": \"Exposure to rain and likely physical struggle\",\n          \"evidence\": \"soaked through. His leather jacket is torn at the left sleeve\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"dried blood visible on knuckles\",\n          \"reason\": \"Likely physical altercation or accident\",\n          \"evidence\": \"dried blood visible on his knuckles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow\",\n          \"reason\": \"Reaction to Jane's departure and current situation\",\n          \"evidence\": \"expression hollow\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none\",\n          \"reason\": \"The oar is broken and lying on the ground\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"heavy rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"dark, bleak, and wet\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"Time has passed\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"heavy rain\",\n          \"reason\": \"Weather progression\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"night\",\n          \"reason\": \"Change in time of day\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"at Billy's feet\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"Physical damage\",\n          \"evidence\": \"The OAR lies broken in two pieces\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"at his feet\",\n          \"reason\": \"Dropped or discarded after breaking\",\n          \"evidence\": \"at his feet\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open, contents scattered\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"scattered in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered\",\n          \"reason\": \"The envelope was opened and its contents dropped\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"handed over\",\n          \"new_value\": \"scattered in puddles\",\n          \"reason\": \"Dropped or discarded\",\n          \"evidence\": \"contents scattered in puddles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.9\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "prompt": 961,
            "completion": 1652,
            "total": 3841,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 1228,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cost": 0.0091205,
          "raw": {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"dried blood visible on knuckles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"reason\": \"Exposure to rain and likely physical struggle\",\n          \"evidence\": \"soaked through. His leather jacket is torn at the left sleeve\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"dried blood visible on knuckles\",\n          \"reason\": \"Likely physical altercation or accident\",\n          \"evidence\": \"dried blood visible on his knuckles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow\",\n          \"reason\": \"Reaction to Jane's departure and current situation\",\n          \"evidence\": \"expression hollow\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none\",\n          \"reason\": \"The oar is broken and lying on the ground\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"heavy rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"dark, bleak, and wet\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"Time has passed\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"heavy rain\",\n          \"reason\": \"Weather progression\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"night\",\n          \"reason\": \"Change in time of day\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"at Billy's feet\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"Physical damage\",\n          \"evidence\": \"The OAR lies broken in two pieces\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"at his feet\",\n          \"reason\": \"Dropped or discarded after breaking\",\n          \"evidence\": \"at his feet\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open, contents scattered\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"scattered in puddles\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.7\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered\",\n          \"reason\": \"The envelope was opened and its contents dropped\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"handed over\",\n          \"new_value\": \"scattered in puddles\",\n          \"reason\": \"Dropped or discarded\",\n          \"evidence\": \"contents scattered in puddles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.9\n    }\n  ]\n}\n```",
                      "thoughtSignature": "Ev0iCvoiAb4+9vuGSYwk1ocE6tFskVFAtjuEqwT+YDpMpdrIMYjOdp6JfyhsYefcduZpGtQ+OYNucwOiI61+A95Bp6sU3aVGsKCtiqkTqvSgXjXvMKWli1ODcQ0JomX/+q96lPXNB4lPmKQHpkWr5x4F35Eb+8u3hFSyo0ocLtT7nO20+t9c2K5vaOwKy5zZp28Y3cJx6H3hR9syffFzjBHPG+W/rPrNcD/AhUrxFS9zM3uQIHrP++KEwcEKMIFMqeq2KnIO5+TIZTS4bdb/bcSf7+pUOIHmld/PJcepOvk/MplCfjRIqz5eIjGNJpnEK/X4zfJrOdlT/NyivfqJjqljKJjuixaTFl01lXe/fAg0UleSRrHBRT6D2q85ecViIuXURF6gKQvNz7VHsUow25jM5xEIFIjCUrJZQftnyQXJXbnq62JGNeaQLzqZPROmm7fT82MxVFVlt0JCt4TgZhNc3Gn6aoGhdJEPSXbiPRO+U4tV02yQYdLSz4dZ/WuUXQu4Lk76zgQ1IB+3mW0B4vlUSVEYU8F606kEDJ0AE9gL7PCHgvHIyJ/LkICTtU7UmVMhUfJIcdTd7H+Hi7+MBC/tQ7uCnTgjWXbQRMS/jWH1X5my5SWA1aR8YkG74sRCZ9/XTxLllGgE95PG/qFXJ+MUGw/BWmqNG1a7+TEkEwLrOzDcGE05VvF7sMwpIISmNpGKt7d6Ib2FWmv1zykuKB6CkXKKfmURF5drfBu1a+ehtmjuUpxx3tJfi+ckiFp7obQ/UnwBiMKEoJcECllDbRED7+a9DrFI124irTN3KaL6JQLibj4KYSHS/6A2WrTMFsejEJQKHnsoE6dUWIMj3/OyYBDZ1qv91l583XIkYL/2/lid9fI31kRPhagJLaIOr5CVyd1Xd0a4HnSHl5DMGe9ASjTM1wtJ6UdKAZuShGRwOIFqhkzU7r2rgZDer2WuEJ/no8NkRaHkPKO9UzmntocvSO+Upio2BJlxSwYHbpsqlQdNRr/dTkZxaDzyVMzHo5iDjOYOhw6Izn0zkTFo3WRO1byAGpvL7yKTuDmbb0KNBqboc2oJ3KC79Kh0bpp1V6GilRTk1sWJ7Fx9cqtru4+A5s6tytKkDyBjFepBWtSwR5cKUShcWMnJmh96WZRmlMsyU+L71yts0nKPTvWi7raVit3zYpGY0na2M8RePnj6/o+L2d5FpW1YoxeRVZqnFwJeK8DtXklEQiZnkGRfqr7aqp3Al8tE3jgsBfGGxRBiwjeDwh0QbAsehqlnMHdbdnC4vkE95n5ZGKd4Bk3q3oKzNTAeTCo2yI8NMCSRoH4UMn1MPElS9ufqYke2eAM6bp58MRMkW96aU0crO3GTxl55VydcQG6unjx0NIPd977eSVI+zJQuHYCrp+iohQlNgf+/vGti1xWMGN4/M6bJeVDUlMJM6E08fFQJfHZc7JwUN92zNtCgPGh+8OfM1rxeUAI22oNrQVY72MLqRJaL+IAZ+KkMQWAtty68wHTgRA6ic1uRUmjR87AHU7wJnRsJj2WJfTfAAQaPvCd/g/kkWGkuCCDjyTbHSkgBzbKjG59a83Ei2x/RewBw7RCKXlrP2JR5z3SNxgiftjluYORMN8WzjUR3oEvEMNHRxzQgpqU6ho8kJXYFT31WrVzhTALUrQiXsdWpGtY3Xl3mdrxOy8IBmwO0qE8JTLD5dQ10Ry0me1A9touDhNKfPZniYCbv0tzITVrZfKdo2B8axyQX4Wn6uZNCoB/OIjQ6AsTCRoaXBi7/H1nwLKYemBtPn3Mbzv9eUuwHS2+jz2PDqlLNIOF4byWSI6F/CsRQ9s936msn+DIKgq7JSr91k7giASlPOJLWy/PUXc1XEtJvCdIQ/p8asUu5BPE51t+zCoINbZQZMnaZNcpum3PdxJ2gRx1fhoW0Dc4zsSDzLyAE9jgadEbTSy5ipl/u15wOkM/HxenRxBZeRurinqURhw34Jd2bD9mmzDteQKtmn/OVsOqQIK0ho1vu2qx5gTTEdDmEK9llKcNMcxzm2BwYS13mEayMx61mRQgbg3pEP8pSYHj5dQc/k6nv7XX4s5WWlVI76Fo0ogB5xoV3v2xJpvSFNpfE+HyocEiEJYxDCuHX+tnvqRUCHbiSGnPcnpSVYUQ9DEhlM7R0Ggx3toZlYXzYoY26wbnsDVniV/x00f6aU2JXmxvXF/19CcYb6RJH/9wgrYJVUS1UwoQQhVLx1n75mCcyTHGOG5jXLsIgaZshWSajdhXS6sGmFEIFpbu66pGNHQu80x5ykIQyxT7jR4+Q3fpTQQuXrJEKaon19ky/iwkG8gsuCjAjOQu1dwPd6d9ZerSTVmHnKugqhZAUOqUIeOz1+gx0+xz11cJbb3H7nUCKvLpxWJN4NOCeBFSSW8AWP5Y8KIghZJD6FhOk0tL3HUu5cgotgyf3AoVf65YHdVM7wlt/PJO/zsR9EHuacMx1EcidqzNc9saQmfhTtLgE+PXchTkK6B5H79CivjMm6hrQeAxoNt8hqjRDtum+H2q+n1Bogw2Wkl8kILmkztIZwUJew+zuPR3D8NsDWIXl82iYtDXAN/EaWQMzTOhsRF6s1EMDMD5Mm8ObMXr3/RhhKYDsF0BbFno+BI+DU7sdDZNO4Ul/K9tgdGPlVBd9pNUK7M+cXquEyMD/94SUecwTdYcYaBp5eNIyVaxFFvtP3YJpFDkQwh9BSQkQofS8I5xLWlNYjwAx5/pknxpvHzB91RfjGIVmfCnghg4/vt8zofSrwu38PbHNUdicSLQ8gS9we8uWavq6ko/xWNtq1kNsG6reN9n33oxQakXQ9xLUKtRro+4QaoS+Uhdg59zBbK0goSVnGz8o56z1vdv4NICnnXQeYsXbw6KpwRWHgPH2r8GHvR9bxThRheA/RWAbCCniQjiJhXhefayZWejWUMhMeOq/RDu8dPZhdevFXc0j6XOIKHbZ64LcmiPcr7RfYSrlIVLJbBDXCfGqSLYKzx4hHluBHPevXDL2d5T93Y1QrbyeE9cpNmfNlwqcTMAqgIGUEkE0nPRyXSKXNCeXCjGBaKs0OMmmlUAs95mMitieWmcJFZb1P3xPofiNJ3WWEM2R3W5E9J3+uWIS+E5U0hmzbGsHqHtxAszqsmm39qtIAcN2Lq1xtHAbOFHDp2oN1Ep+d1pKRJ7j7Gb2ve0jxCy7Hu7VlOj1vS1U0idCkJf+yIm2XyKcEktWLjt5WPV2VuAfrgrtnllSRmnZOuWr8Av7E4SCqLj0mFB+IQ0eaUKsN6QsCFTdqr9Fw66QzzcO5N/up4oXEe6tbzTIAHv6SIDhqooIcdRa8OnjoZ3XJXySt0l4mGloBNQy30A3edIR2V74MqUeYJA+phghk/rr1XOc1MpTKJoLXfF60SCMEI+cnl6ZHqRDRVQYjZfK+dBREb2ey2JmhT8y1kC7L5ahA2TCyhwSGycCwlCgW6Qgocx/1n8bnaqeb1MLV8ZDDB+sj9nlsNHMJ2L3x4SYR1NeP7m6g3nFg8hZF1KJmtGwYKdwnRcTXwQH0LPNqlhl5kvab7RwJlf03okzYqpZUpTuTrXfvr8ae1HsTmikzpIH0bRT3JhzCxP+nb10uP5mw6uWIk7GI5H7BCTpXPZXpvlPfIEPr92E/wplLSY3/hBO+8iawxa801+FoMrrJQfLzHRgI/sVcaztw6XtFvOEgLQJOmqNm+UKURoWpppoatgzZHnt5odXFXAlqyL6bD2VENcy9MCQD2efPD0aHufH4POL9xkcoFOZyx8ZGBwV0S2IskVvrLgi/PzJs/cIiOSBudddhHaSjWnyIPC650rJ4rJ+UmjNieJsa0qSdNo1cVVAMP3EqRPtynxn5oehCG2/Iqdkqas8Np86c5XKe67AwGAw82H2+6zagtkGBdJzPXfjYzmRVV9s0M2OkInNOaNZj22WS5RmWQFZWg6ZGL4TWtnF+TGVYjKxc8vTfjrpiSIQbzJzJpyPklm7VyGHw1sa9Ov9xt8VMWHBDwGjnU0spHHJmjBTlvViccnaqg+FjH+Vs8bzlEAIlpfX0ZenzIp9XcL/BJll9bikkaTqVvm041nqGxoHfnDkXpS3xSxMXLlLPolqAWLJ3YREQkZ+1X2K0sA74hGoLCNEk0g3guzXJ7hxWFIs1+Emhrtmw/JcZAnw+YY5YGn7TQT7iSCMZ1KBUdL/UrrGkKYAQ51a3+PX+qdRJGniCl6IAlZEV4VbM4/q4ZqoRYx3QcNNmo25Yom8vL2cQkus7Eba6UY+387sffdsImrioHmQDmMAAfhoDfBpZ7p9o+RV7A/0AwFJICa2+wMd1HLi72gsca0rRMUb30XxDoFRRE9SXr4FN3TR35nICSoZEXCd1n4hQAO46uHs4G4h+2qir0okpDoHq/XbWKLmeub933ZrprCLQkp4qm8VfcyX91LAm0fa0JEyAEqGTlknSoqprGVd2EY5gZsR2CZyyCZOhthO+DBEWpcFZYnN6n32YisADPlJss/VdifBLZ4cLweTGWcX9Lh8KKHeuMZOGH2a5Ue6H9AvCSqWwpgOWNJt9WnasUgCVty2E0e/1xA4KXKlfpagd+ufxmhK60AwoE6zK6tnXTU2ifUwiszFB3+I7uu9bFpJ2meUMqzI4MX2eT0VeNVO8ruzXD2R/l+K1rfWqBxJm/r38b/Umt4Tt0LByeRlML8XzDpr48QbDdu3HUSr9WLlIe/AJo1RfywmIWu/8Alxmbhup0+gbetSxDRDfmuAeUpO1A4MQNbHR4blnxGljQKVSA+P2rp2b9acKuAbXwEYxXS2uJLsCLQfwm1cZ6LlfS2TKGFSgorS7gSK0GecRNGJY66MHQAi/7zlhy4/2tJuCzAvYFX4LkYLID0MuBDrlR4FydF+41fdAOGJTelTiGorGpQGk2qGSEEFwktm9koDLG9X4tlenOZmm6AJYJKtu+JzA7YQiYzfnhVUc7dUQxrqJaOUI1W6mrtUzexbssnULy9/0KZWVKLHsOc6QcZlUC0WDGB3YUTU/1D2YGzJC3uzh+Plfue7ZUfdebdeyAGyk7IXtuAAeukKbIurFiHfety2cJ6rvrokCX11Fsl1GHjVW9pu5BKbbKbx/wSUoZS534/0DeVICN2SBimRJ9WzznEu5M9pHr23Ic1/1z3LCjUz3iRAjI37fkOI6lWa/VSn291c4ew96A8u7Be0Kwdh6JLXP2g7GnW6idEkjSjfgu9z9kHamZmvXhLTzNoy79B0H++GHPQ21R/slzrjcq2LR0XImHuXn+zcjjP/Y1JgIlOsDLJ9tFpn/GDVEZwsPIv0b3FYXHHUlmNmQkQnd3Nh56jgTa0buoFpGeB/O5fKeraApgm6BSt2gfzNSo5ZtTdlqr3y4QpF36M4Y0ZQhTR4xzs/H8KBoN3f4W15osfpkMfMMBnRvLR6qNsgCpMRs0yHczHZkeVbu1ETsSEa5UoHvmz46kVbYZJG/U696kp38KXSvtzwAzQQ3YWMg0DljvhwZqrFOWq/GGrExOiPfmqltYqidZzhDHu53VA6MTpP0/ItLOcbD+/A2gdpP0ifjdR1v+e8Nq045CSxFFO49hExArigUSVS2+7e6KhBmI9FsBQ+xMiLr0rU0JRhFcePFQPTzXaA0LHHTjmdxY8KC7Wp+g8KI8ycrEzBtvkv2AKFgpyh5TrGXM5ttNcwBqSUgdQ0aj4FCJIjRkocqUzcAIUA+0xXuGPRs0a+lOyDVJsjYUA1gt/HWRsbIRARQMxK2QeEAaMALVSx9FC3NgDOYZ/y4FLZEYVDsIjzinaH2B8V7k4O+X5/PDiIYFbdY/mXbOVY73x3mZPy1PRaBhPM4XvQTuzQRhPRrjnel9JhGNx1TXC0XMPVCwhJB8qkVX6fFUnPLhbbVzjmEI+QK1R0Ff5NgzfmdJRrNtZ+vUjW7SGyLkFwtapPYmnnl83AmoHE7/WfFiAES4H+GhUGmM2lAUXAOw=="
                    }
                  ],
                  "role": "model"
                },
                "finishReason": "STOP",
                "index": 0
              }
            ],
            "usageMetadata": {
              "promptTokenCount": 961,
              "candidatesTokenCount": 1652,
              "totalTokenCount": 3841,
              "promptTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 961
                }
              ],
              "thoughtsTokenCount": 1228
            },
            "modelVersion": "gemini-3-flash-preview",
            "responseId": "OxClaen0O8WyqtsPy9S26Qo"
          },
          "cached": false,
          "metadata": {}
        },
        "score": 0.9128000000000001,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.023393999999999998,
        "gradingResult": {
          "pass": true,
          "score": 0.93715,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2064,
            "prompt": 1642,
            "completion": 422,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9743,
              "reason": "change_detection=0.96 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=0.93 | json_valid=1.00 | property_extraction=0.98",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.9,
              "reason": "The output is very thorough and catches nearly all 9 key continuity changes:\n\n1. **Jacket damage** (✅): Detected with evidence quote about torn left sleeve and soaked through.\n2. **Blood on knuckles** (✅): Detected with evidence quote about dried blood on knuckles.\n3. **Oar broken** (✅): Detected with evidence quote 'The OAR lies broken in two pieces at his feet.' and correct previous value (intact, weathered oak).\n4. **Envelope opened/scattered** (✅): Detected with evidence quote 'The ENVELOPE is open, contents scattered in puddles.' and correct previous value (sealed).\n5. **Time/weather changes** (✅): Both time (day→night) and weather (windy→heavy rain) detected with evidence quotes.\n6. **Billy soaked through** (✅): Captured in costume and physical_condition properties.\n7. **Emotional state shift** (✅): flat/resigned → hollow detected with evidence quote.\n8. **Jane being gone** (❌): Not tracked as a separate entity or change event. This is the one notable miss — Jane's absence is not explicitly noted.\n\nThat's 8 out of 9 changes detected. All change events are backed by actual quotes from the scene. Previous values are correctly referenced (jacket zipped against wind, oar intact/weathered oak, envelope sealed, day→night, windy→heavy rain, flat/resigned→hollow). The confidence scores are reasonable and well-calibrated. The structure is clean and well-organized with separate entity tracking for character, location, and props.\n\nThe only significant gap is not tracking Jane's disappearance as a change event. Otherwise this is an excellent extraction.",
              "tokensUsed": {
                "total": 2064,
                "prompt": 1642,
                "completion": 422,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n{\\\"scene_id\\\":\\\"scene_003\\\",\\\"entity_states\\\":[{\\\"entity_key\\\":\\\"character:billy\\\",\\\"properties\\\":[{\\\"key\\\":\\\"costume\\\",\\\"value\\\":\\\"leather jacket; left sleeve torn; soaked through (wet from rain)\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"physical_condition\\\",\\\"value\\\":\\\"soaked through; dried blood visible on knuckles\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"emotional_state\\\",\\\"value\\\":\\\"hollow/empty, staring at the water\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"props_carried\\\",\\\"value\\\":\\\"none (oar is broken and on the ground at his feet)\\\",\\\"confidence\\\":0.85}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"costume\\\",\\\"previous_value\\\":\\\"leather jacket zipped against the wind\\\",\\\"new_value\\\":\\\"leather jacket torn at the left sleeve; soaked through\\\",\\\"reason\\\":\\\"Jacket now visibly damaged and wet in heavy rain.\\\",\\\"evidence\\\":\\\"BILLY sits on a coiled rope, soaked through. His leather jacket is torn at the left sleeve\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9},{\\\"property_key\\\":\\\"physical_condition\\\",\\\"previous_value\\\":null,\\\"new_value\\\":\\\"dried blood visible on knuckles; soaked through\\\",\\\"reason\\\":\\\"Newly described visible injury/blood and wetness.\\\",\\\"evidence\\\":\\\"— dried blood visible\\\\non his knuckles.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.85},{\\\"property_key\\\":\\\"emotional_state\\\",\\\"previous_value\\\":\\\"flat, resigned\\\",\\\"new_value\\\":\\\"hollow\\\",\\\"reason\\\":\\\"Emotional description changes from resigned to hollow.\\\",\\\"evidence\\\":\\\"BILLY stares at the dark water, expression hollow.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9},{\\\"property_key\\\":\\\"props_carried\\\",\\\"previous_value\\\":\\\"oar\\\",\\\"new_value\\\":\\\"none (oar broken at his feet)\\\",\\\"reason\\\":\\\"Oar is no longer carried/held; it is broken and on the ground.\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.85}],\\\"confidence\\\":0.9},{\\\"entity_key\\\":\\\"location:harbor_dock\\\",\\\"properties\\\":[{\\\"key\\\":\\\"time_of_day\\\",\\\"value\\\":\\\"night\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"lighting\\\",\\\"value\\\":\\\"dark/night lighting\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"weather\\\",\\\"value\\\":\\\"heavy rain\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"damage_or_changes\\\",\\\"value\\\":\\\"dock area wet with puddles; items scattered in puddles\\\",\\\"confidence\\\":0.8},{\\\"key\\\":\\\"atmosphere\\\",\\\"value\\\":\\\"bleak, harsh, desolate\\\",\\\"confidence\\\":0.75}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"time_of_day\\\",\\\"previous_value\\\":\\\"day\\\",\\\"new_value\\\":\\\"night\\\",\\\"reason\\\":\\\"Scene heading indicates a different time of day.\\\",\\\"evidence\\\":\\\"EXT. HARBOR DOCK - NIGHT\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"lighting\\\",\\\"previous_value\\\":\\\"daylight\\\",\\\"new_value\\\":\\\"dark/night lighting\\\",\\\"reason\\\":\\\"Night implies loss of daylight and darker environment.\\\",\\\"evidence\\\":\\\"EXT. HARBOR DOCK - NIGHT\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.9},{\\\"property_key\\\":\\\"weather\\\",\\\"previous_value\\\":\\\"windy\\\",\\\"new_value\\\":\\\"heavy rain\\\",\\\"reason\\\":\\\"Weather shifts from wind to heavy rain (wind not mentioned here).\\\",\\\"evidence\\\":\\\"Rain hammers the dock.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95}],\\\"confidence\\\":0.9},{\\\"entity_key\\\":\\\"prop:oar\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"broken in two pieces\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"at Billy's feet on the dock\\\",\\\"confidence\\\":1},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"Billy\\\",\\\"confidence\\\":0.85}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":\\\"intact, weathered oak with rope-wrapped grip\\\",\\\"new_value\\\":\\\"broken in two pieces\\\",\\\"reason\\\":\\\"Prop is explicitly described as broken.\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":1},{\\\"property_key\\\":\\\"position\\\",\\\"previous_value\\\":\\\"set against a piling\\\",\\\"new_value\\\":\\\"at Billy's feet on the dock\\\",\\\"reason\\\":\\\"Prop has moved from piling to the ground near Billy.\\\",\\\"evidence\\\":\\\"The OAR lies broken in two pieces at his feet.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95}],\\\"confidence\\\":0.95},{\\\"entity_key\\\":\\\"prop:envelope\\\",\\\"properties\\\":[{\\\"key\\\":\\\"condition\\\",\\\"value\\\":\\\"open; contents scattered (papers/contents wet in puddles)\\\",\\\"confidence\\\":0.95},{\\\"key\\\":\\\"position\\\",\\\"value\\\":\\\"on the dock with contents scattered in puddles\\\",\\\"confidence\\\":0.9},{\\\"key\\\":\\\"ownership\\\",\\\"value\\\":\\\"Billy (previously handed over; Jane is gone)\\\",\\\"confidence\\\":0.75}],\\\"change_events\\\":[{\\\"property_key\\\":\\\"condition\\\",\\\"previous_value\\\":\\\"sealed\\\",\\\"new_value\\\":\\\"open; contents scattered in puddles\\\",\\\"reason\\\":\\\"Envelope has been opened and emptied/spilled.\\\",\\\"evidence\\\":\\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\\"is_explicit\\\":true,\\\"confidence\\\":0.95}],\\\"confidence\\\":0.85}]}\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "2b8dadb6-1de7-4b43-8eb9-bddc9fd0b953",
        "latencyMs": 14551,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 9,
        "provider": {
          "id": "openai:gpt-5.2",
          "label": "GPT-5.2"
        },
        "response": {
          "output": "{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"leather jacket; left sleeve torn; soaked through (wet from rain)\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"soaked through; dried blood visible on knuckles\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"hollow/empty, staring at the water\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"none (oar is broken and on the ground at his feet)\",\n          \"confidence\": 0.85\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket torn at the left sleeve; soaked through\",\n          \"reason\": \"Jacket now visibly damaged and wet in heavy rain.\",\n          \"evidence\": \"BILLY sits on a coiled rope, soaked through. His leather jacket is torn at the left sleeve\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"dried blood visible on knuckles; soaked through\",\n          \"reason\": \"Newly described visible injury/blood and wetness.\",\n          \"evidence\": \"— dried blood visible\\non his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.85\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow\",\n          \"reason\": \"Emotional description changes from resigned to hollow.\",\n          \"evidence\": \"BILLY stares at the dark water, expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none (oar broken at his feet)\",\n          \"reason\": \"Oar is no longer carried/held; it is broken and on the ground.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.85\n        }\n      ],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"lighting\",\n          \"value\": \"dark/night lighting\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"heavy rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"dock area wet with puddles; items scattered in puddles\",\n          \"confidence\": 0.8\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"bleak, harsh, desolate\",\n          \"confidence\": 0.75\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"Scene heading indicates a different time of day.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"dark/night lighting\",\n          \"reason\": \"Night implies loss of daylight and darker environment.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"heavy rain\",\n          \"reason\": \"Weather shifts from wind to heavy rain (wind not mentioned here).\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.9\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"at Billy's feet on the dock\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.85\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"Prop is explicitly described as broken.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"at Billy's feet on the dock\",\n          \"reason\": \"Prop has moved from piling to the ground near Billy.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"open; contents scattered (papers/contents wet in puddles)\",\n          \"confidence\": 0.95\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"on the dock with contents scattered in puddles\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy (previously handed over; Jane is gone)\",\n          \"confidence\": 0.75\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open; contents scattered in puddles\",\n          \"reason\": \"Envelope has been opened and emptied/spilled.\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "tokenUsage": {
            "total": 2455,
            "prompt": 896,
            "completion": 1559,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 0,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cached": false,
          "latencyMs": 14551,
          "finishReason": "stop",
          "cost": 0.023393999999999998,
          "guardrails": {
            "flagged": false
          },
          "metadata": {
            "http": {
              "status": 200,
              "statusText": "OK",
              "headers": {
                "access-control-expose-headers": "X-Request-ID",
                "alt-svc": "h3=\":443\"; ma=86400",
                "cf-cache-status": "DYNAMIC",
                "cf-ray": "9d5d9cbe6b4688d9-YVR",
                "connection": "keep-alive",
                "content-encoding": "br",
                "content-type": "application/json",
                "date": "Mon, 02 Mar 2026 04:21:16 GMT",
                "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
                "openai-processing-ms": "14286",
                "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
                "openai-version": "2020-10-01",
                "server": "cloudflare",
                "set-cookie": "__cf_bm=AMlEHIIyVx4jeuiyRk5PX0urhjXHOFri10bTwY6vjx4-1772425261.824647-1.0.1.1-pv2DE8fEwVkQwgDYSy1qbt8uHKZU3QxznslsGgy0SX5Y5quJyZVxCHOBBRA80m1gH3IeU5xWOpQGrZNpBrz4vqho9dqnugHE7QSMnqHc0CJYAa9PPqSNuCW1vM0rXp8e; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:51:16 GMT",
                "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
                "transfer-encoding": "chunked",
                "x-content-type-options": "nosniff",
                "x-openai-proxy-wasm": "v0.1",
                "x-ratelimit-limit-requests": "10000",
                "x-ratelimit-limit-tokens": "4000000",
                "x-ratelimit-remaining-requests": "9999",
                "x-ratelimit-remaining-tokens": "3999134",
                "x-ratelimit-reset-requests": "6ms",
                "x-ratelimit-reset-tokens": "12ms",
                "x-request-id": "req_286e21d6bb4147beaa27d4b79d08ad00"
              }
            }
          }
        },
        "score": 0.93715,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "http": {
            "status": 200,
            "statusText": "OK",
            "headers": {
              "access-control-expose-headers": "X-Request-ID",
              "alt-svc": "h3=\":443\"; ma=86400",
              "cf-cache-status": "DYNAMIC",
              "cf-ray": "9d5d9cbe6b4688d9-YVR",
              "connection": "keep-alive",
              "content-encoding": "br",
              "content-type": "application/json",
              "date": "Mon, 02 Mar 2026 04:21:16 GMT",
              "openai-organization": "user-oqdrq8y0bphopngnvkyuu5wr",
              "openai-processing-ms": "14286",
              "openai-project": "proj_ZRoLLwXcJok6Xg2t6eKhI1pn",
              "openai-version": "2020-10-01",
              "server": "cloudflare",
              "set-cookie": "__cf_bm=AMlEHIIyVx4jeuiyRk5PX0urhjXHOFri10bTwY6vjx4-1772425261.824647-1.0.1.1-pv2DE8fEwVkQwgDYSy1qbt8uHKZU3QxznslsGgy0SX5Y5quJyZVxCHOBBRA80m1gH3IeU5xWOpQGrZNpBrz4vqho9dqnugHE7QSMnqHc0CJYAa9PPqSNuCW1vM0rXp8e; HttpOnly; Secure; Path=/; Domain=api.openai.com; Expires=Mon, 02 Mar 2026 04:51:16 GMT",
              "strict-transport-security": "max-age=31536000; includeSubDomains; preload",
              "transfer-encoding": "chunked",
              "x-content-type-options": "nosniff",
              "x-openai-proxy-wasm": "v0.1",
              "x-ratelimit-limit-requests": "10000",
              "x-ratelimit-limit-tokens": "4000000",
              "x-ratelimit-remaining-requests": "9999",
              "x-ratelimit-remaining-tokens": "3999134",
              "x-ratelimit-reset-requests": "6ms",
              "x-ratelimit-reset-tokens": "12ms",
              "x-request-id": "req_286e21d6bb4147beaa27d4b79d08ad00"
            }
          },
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.048400000000000006,
        "gradingResult": {
          "pass": true,
          "score": 0.93715,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2685,
            "prompt": 2241,
            "completion": 444,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9743,
              "reason": "change_detection=0.96 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=0.90 | property_extraction=0.98 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.9,
              "reason": "The output demonstrates excellent continuity extraction, catching nearly all of the 9 key changes:\n\n1. **Jacket damage** ✅ — Detected with evidence quote about torn left sleeve, previous value correctly noted as 'zipped against the wind'.\n2. **Blood on knuckles** ✅ — Detected as new physical condition with explicit evidence.\n3. **Emotional state shift** ✅ — Correctly tracks from 'flat, resigned' to 'hollow, despondent' with evidence quote.\n4. **Billy soaked through** ✅ — Noted in the costume property ('soaked through') as part of the jacket change event.\n5. **Oar broken** ✅ — Detected with condition change from 'intact, weathered oak with rope-wrapped grip' to 'broken in two pieces', with evidence quote.\n6. **Envelope opened/scattered** ✅ — Detected with condition change from 'sealed' to 'open, contents scattered in puddles', with evidence quote.\n7. **Jane gone** ❌ — Not explicitly tracked as a change event. There's a passing mention in envelope ownership ('Jane is gone') but no dedicated entity or change event for Jane's absence.\n8. **Weather change** ✅ — Detected from 'windy' to 'heavy rain' with evidence quote.\n9. **Time change** ✅ — Detected from 'day' to 'night' with evidence quote.\n\nThat's 8 out of 9 changes detected. All change events are backed by evidence quotes that appear to be actual scene text. Previous values are correctly referenced throughout. The only notable miss is not creating a dedicated entity/change event for Jane's disappearance from the scene. The structure is clean, confidence scores are reasonable, and the reasoning in each change event is sound.",
              "tokensUsed": {
                "total": 2685,
                "prompt": 2241,
                "completion": 444,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_003\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\\"key\\\": \\\"costume\\\", \\\"value\\\": \\\"leather jacket, torn at the left sleeve, soaked through\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"physical_condition\\\", \\\"value\\\": \\\"dried blood visible on knuckles\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"emotional_state\\\", \\\"value\\\": \\\"hollow, despondent\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"props_carried\\\", \\\"value\\\": \\\"none (oar is broken at his feet, not carried)\\\", \\\"confidence\\\": 0.9},\\n        {\\\"key\\\": \\\"position\\\", \\\"value\\\": \\\"sitting on a coiled rope on the dock\\\", \\\"confidence\\\": 1.0}\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"new_value\\\": \\\"leather jacket torn at the left sleeve, soaked through\\\",\\n          \\\"reason\\\": \\\"Jacket has been damaged (torn sleeve) and Billy is soaked from the rain\\\",\\n          \\\"evidence\\\": \\\"His leather jacket is torn at the left sleeve\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"physical_condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"dried blood visible on knuckles\\\",\\n          \\\"reason\\\": \\\"Billy has been in some kind of physical altercation or incident between scenes\\\",\\n          \\\"evidence\\\": \\\"dried blood visible on his knuckles\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"flat, resigned\\\",\\n          \\\"new_value\\\": \\\"hollow, despondent\\\",\\n          \\\"reason\\\": \\\"Billy's emotional state has deepened from resigned to hollow, staring at dark water\\\",\\n          \\\"evidence\\\": \\\"BILLY stares at the dark water, expression hollow.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": \\\"oar\\\",\\n          \\\"new_value\\\": \\\"none\\\",\\n          \\\"reason\\\": \\\"The oar is now broken in two pieces at his feet, no longer carried\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\\"key\\\": \\\"time_of_day\\\", \\\"value\\\": \\\"night\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"weather\\\", \\\"value\\\": \\\"heavy rain\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"lighting\\\", \\\"value\\\": \\\"dark, nighttime\\\", \\\"confidence\\\": 0.9},\\n        {\\\"key\\\": \\\"atmosphere\\\", \\\"value\\\": \\\"bleak, desolate, rain-soaked\\\", \\\"confidence\\\": 0.9}\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"time_of_day\\\",\\n          \\\"previous_value\\\": \\\"day\\\",\\n          \\\"new_value\\\": \\\"night\\\",\\n          \\\"reason\\\": \\\"Scene has moved from daytime to nighttime\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": \\\"windy\\\",\\n          \\\"new_value\\\": \\\"heavy rain\\\",\\n          \\\"reason\\\": \\\"Weather has changed from windy to hammering rain\\\",\\n          \\\"evidence\\\": \\\"Rain hammers the dock.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"lighting\\\",\\n          \\\"previous_value\\\": \\\"daylight\\\",\\n          \\\"new_value\\\": \\\"dark, nighttime\\\",\\n          \\\"reason\\\": \\\"Time has shifted to night, so lighting is now dark\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"confidence\\\": 0.93\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\\"key\\\": \\\"condition\\\", \\\"value\\\": \\\"broken in two pieces\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"position\\\", \\\"value\\\": \\\"at Billy's feet on the dock\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"ownership\\\", \\\"value\\\": \\\"Billy\\\", \\\"confidence\\\": 0.9}\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"intact, weathered oak with rope-wrapped grip\\\",\\n          \\\"new_value\\\": \\\"broken in two pieces\\\",\\n          \\\"reason\\\": \\\"The oar has been broken, likely during an altercation between scenes\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"set against a piling\\\",\\n          \\\"new_value\\\": \\\"at Billy's feet on the dock\\\",\\n          \\\"reason\\\": \\\"The oar is now on the ground at Billy's feet rather than leaning against a piling\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\\"key\\\": \\\"condition\\\", \\\"value\\\": \\\"open, contents scattered in puddles\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"position\\\", \\\"value\\\": \\\"on the dock, contents scattered in puddles\\\", \\\"confidence\\\": 1.0},\\n        {\\\"key\\\": \\\"ownership\\\", \\\"value\\\": \\\"abandoned / Billy's (Jane is gone)\\\", \\\"confidence\\\": 0.8}\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"sealed\\\",\\n          \\\"new_value\\\": \\\"open, contents scattered in puddles\\\",\\n          \\\"reason\\\": \\\"The envelope has been opened and its contents have spilled out into the rain puddles\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"on the dock, contents scattered in puddles\\\",\\n          \\\"reason\\\": \\\"The envelope and its contents are now strewn across the wet dock\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"confidence\\\": 0.92\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "3bab5c38-14e2-4b74-8a6d-f55be24d909d",
        "latencyMs": 19361,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 10,
        "provider": {
          "id": "anthropic:messages:claude-opus-4-6",
          "label": "Claude Opus 4.6"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"leather jacket, torn at the left sleeve, soaked through\", \"confidence\": 1.0},\n        {\"key\": \"physical_condition\", \"value\": \"dried blood visible on knuckles\", \"confidence\": 1.0},\n        {\"key\": \"emotional_state\", \"value\": \"hollow, despondent\", \"confidence\": 1.0},\n        {\"key\": \"props_carried\", \"value\": \"none (oar is broken at his feet, not carried)\", \"confidence\": 0.9},\n        {\"key\": \"position\", \"value\": \"sitting on a coiled rope on the dock\", \"confidence\": 1.0}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"leather jacket torn at the left sleeve, soaked through\",\n          \"reason\": \"Jacket has been damaged (torn sleeve) and Billy is soaked from the rain\",\n          \"evidence\": \"His leather jacket is torn at the left sleeve\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"dried blood visible on knuckles\",\n          \"reason\": \"Billy has been in some kind of physical altercation or incident between scenes\",\n          \"evidence\": \"dried blood visible on his knuckles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"hollow, despondent\",\n          \"reason\": \"Billy's emotional state has deepened from resigned to hollow, staring at dark water\",\n          \"evidence\": \"BILLY stares at the dark water, expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"none\",\n          \"reason\": \"The oar is now broken in two pieces at his feet, no longer carried\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\"key\": \"time_of_day\", \"value\": \"night\", \"confidence\": 1.0},\n        {\"key\": \"weather\", \"value\": \"heavy rain\", \"confidence\": 1.0},\n        {\"key\": \"lighting\", \"value\": \"dark, nighttime\", \"confidence\": 0.9},\n        {\"key\": \"atmosphere\", \"value\": \"bleak, desolate, rain-soaked\", \"confidence\": 0.9}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"night\",\n          \"reason\": \"Scene has moved from daytime to nighttime\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"heavy rain\",\n          \"reason\": \"Weather has changed from windy to hammering rain\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"dark, nighttime\",\n          \"reason\": \"Time has shifted to night, so lighting is now dark\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.93\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\"key\": \"condition\", \"value\": \"broken in two pieces\", \"confidence\": 1.0},\n        {\"key\": \"position\", \"value\": \"at Billy's feet on the dock\", \"confidence\": 1.0},\n        {\"key\": \"ownership\", \"value\": \"Billy\", \"confidence\": 0.9}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"broken in two pieces\",\n          \"reason\": \"The oar has been broken, likely during an altercation between scenes\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"at Billy's feet on the dock\",\n          \"reason\": \"The oar is now on the ground at Billy's feet rather than leaning against a piling\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\"key\": \"condition\", \"value\": \"open, contents scattered in puddles\", \"confidence\": 1.0},\n        {\"key\": \"position\", \"value\": \"on the dock, contents scattered in puddles\", \"confidence\": 1.0},\n        {\"key\": \"ownership\", \"value\": \"abandoned / Billy's (Jane is gone)\", \"confidence\": 0.8}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"open, contents scattered in puddles\",\n          \"reason\": \"The envelope has been opened and its contents have spilled out into the rain puddles\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"on the dock, contents scattered in puddles\",\n          \"reason\": \"The envelope and its contents are now strewn across the wet dock\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.92\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "total": 2688,
            "prompt": 940,
            "completion": 1748
          },
          "finishReason": "stop",
          "cost": 0.048400000000000006
        },
        "score": 0.93715,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.044201250000000004,
        "gradingResult": {
          "pass": true,
          "score": 0.9128000000000001,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2927,
            "prompt": 2363,
            "completion": 564,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9456,
              "reason": "change_detection=0.94 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=0.90 | property_extraction=0.88 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.88,
              "reason": "The output comprehensively covers the continuity changes:\n\n1. **Jacket damage** (✅): Detected with change event from 'leather jacket zipped against the wind' to 'Soaked leather jacket, torn at the left sleeve.' Evidence: 'soaked through. His leather jacket is torn at the left sleeve'.\n\n2. **Physical injury/blood on knuckles** (✅): Detected as a new physical_condition change event with evidence 'dried blood visible on his knuckles.'\n\n3. **Emotional state shift** (✅): Detected from 'flat, resigned' to 'Hollow.' with evidence 'expression hollow.'\n\n4. **Billy soaked through** (✅): Captured in the physical_condition property and costume description, though it's somewhat merged with other properties rather than being its own distinct change event.\n\n5. **Oar broken** (✅): Detected with change from 'intact, weathered oak with rope-wrapped grip' to 'Broken in two pieces.' Evidence: 'The OAR lies broken in two pieces'.\n\n6. **Envelope opened/scattered** (✅): Detected with change from 'sealed' to 'Open, contents scattered.' Evidence: 'The ENVELOPE is open, contents scattered in puddles.'\n\n7. **Jane's absence** (❌): Not mentioned at all. This is a notable omission — a character who was present in the previous scene is now gone, which is a significant continuity point.\n\n8. **Weather change** (✅): Detected from 'windy' to 'Heavy rain.' Evidence: 'Rain hammers the dock.'\n\n9. **Time change** (✅): Detected from 'day' to 'Night.' Evidence: 'EXT. HARBOR DOCK - NIGHT'.\n\nThat's 8 out of 9 changes detected. The only miss is Jane's absence.\n\nAll change events are backed by evidence quotes that appear to be actual text from the scene. Previous values are referenced correctly and plausibly. The props_carried change (oar → None) is a nice additional inference. Confidence scores are reasonable.\n\nThe structure is well-organized with entities properly separated. The output is thorough and accurate, missing only one change (Jane's departure).",
              "tokensUsed": {
                "total": 2927,
                "prompt": 2363,
                "completion": 564,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_003\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"Soaked leather jacket, torn at the left sleeve.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"Soaked through, with dried blood on his knuckles.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"Hollow.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"None.\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"new_value\\\": \\\"Soaked leather jacket, torn at the left sleeve.\\\",\\n          \\\"reason\\\": \\\"Caught in the rain and involved in a physical altercation.\\\",\\n          \\\"evidence\\\": \\\"soaked through. His leather jacket is torn at the left sleeve\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"physical_condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Dried blood on his knuckles.\\\",\\n          \\\"reason\\\": \\\"A new injury is visible, likely from an off-screen fight.\\\",\\n          \\\"evidence\\\": \\\"dried blood visible on his knuckles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"flat, resigned\\\",\\n          \\\"new_value\\\": \\\"Hollow.\\\",\\n          \\\"reason\\\": \\\"Emotional state has worsened due to off-screen events.\\\",\\n          \\\"evidence\\\": \\\"expression hollow.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": \\\"oar\\\",\\n          \\\"new_value\\\": \\\"None.\\\",\\n          \\\"reason\\\": \\\"The oar he was carrying is now broken and on the ground.\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"confidence\\\": 0.98\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"Night.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"Night.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"Heavy rain.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"damage_or_changes\\\",\\n          \\\"value\\\": \\\"Covered in puddles, with scattered papers.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"Bleak, somber.\\\",\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"time_of_day\\\",\\n          \\\"previous_value\\\": \\\"day\\\",\\n          \\\"new_value\\\": \\\"Night.\\\",\\n          \\\"reason\\\": \\\"Passage of time.\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": \\\"windy\\\",\\n          \\\"new_value\\\": \\\"Heavy rain.\\\",\\n          \\\"reason\\\": \\\"The weather has changed.\\\",\\n          \\\"evidence\\\": \\\"Rain hammers the dock.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"lighting\\\",\\n          \\\"previous_value\\\": \\\"daylight\\\",\\n          \\\"new_value\\\": \\\"Night.\\\",\\n          \\\"reason\\\": \\\"Passage of time from day to night.\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"Broken in two pieces.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"At Billy's feet.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Billy\\\",\\n          \\\"confidence\\\": 0.9\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"intact, weathered oak with rope-wrapped grip\\\",\\n          \\\"new_value\\\": \\\"Broken in two pieces.\\\",\\n          \\\"reason\\\": \\\"The oar was damaged in an off-screen event.\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"set against a piling\\\",\\n          \\\"new_value\\\": \\\"At Billy's feet.\\\",\\n          \\\"reason\\\": \\\"The oar has been moved and dropped.\\\",\\n          \\\"evidence\\\": \\\"at his feet.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"Open, contents scattered and wet.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"On the dock, with contents in puddles.\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"ownership\\\",\\n          \\\"value\\\": \\\"Abandoned.\\\",\\n          \\\"confidence\\\": 0.8\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"sealed\\\",\\n          \\\"new_value\\\": \\\"Open, contents scattered.\\\",\\n          \\\"reason\\\": \\\"The envelope has been opened and its contents discarded.\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"ownership\\\",\\n          \\\"previous_value\\\": \\\"Jane → Billy (handed over)\\\",\\n          \\\"new_value\\\": \\\"Abandoned.\\\",\\n          \\\"reason\\\": \\\"The envelope and its contents are on the ground, not possessed by anyone.\\\",\\n          \\\"evidence\\\": \\\"contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.85\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"On the dock, with contents in puddles.\\\",\\n          \\\"reason\\\": \\\"The envelope was previously held and has now been dropped/discarded.\\\",\\n          \\\"evidence\\\": \\\"contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 0.95\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "693cec31-cdf9-4bca-b129-521611b8c334",
        "latencyMs": 29645,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 11,
        "provider": {
          "id": "google:gemini-2.5-pro",
          "label": "Gemini 2.5 Pro"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"Soaked leather jacket, torn at the left sleeve.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"Soaked through, with dried blood on his knuckles.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"Hollow.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"None.\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"Soaked leather jacket, torn at the left sleeve.\",\n          \"reason\": \"Caught in the rain and involved in a physical altercation.\",\n          \"evidence\": \"soaked through. His leather jacket is torn at the left sleeve\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"Dried blood on his knuckles.\",\n          \"reason\": \"A new injury is visible, likely from an off-screen fight.\",\n          \"evidence\": \"dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"Hollow.\",\n          \"reason\": \"Emotional state has worsened due to off-screen events.\",\n          \"evidence\": \"expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"None.\",\n          \"reason\": \"The oar he was carrying is now broken and on the ground.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.98\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"Night.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"Night.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"Heavy rain.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"Covered in puddles, with scattered papers.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"Bleak, somber.\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"Night.\",\n          \"reason\": \"Passage of time.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"Heavy rain.\",\n          \"reason\": \"The weather has changed.\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"Night.\",\n          \"reason\": \"Passage of time from day to night.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Broken in two pieces.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"At Billy's feet.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"Broken in two pieces.\",\n          \"reason\": \"The oar was damaged in an off-screen event.\",\n          \"evidence\": \"The OAR lies broken in two pieces\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"At Billy's feet.\",\n          \"reason\": \"The oar has been moved and dropped.\",\n          \"evidence\": \"at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Open, contents scattered and wet.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"On the dock, with contents in puddles.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Abandoned.\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"Open, contents scattered.\",\n          \"reason\": \"The envelope has been opened and its contents discarded.\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": \"Jane → Billy (handed over)\",\n          \"new_value\": \"Abandoned.\",\n          \"reason\": \"The envelope and its contents are on the ground, not possessed by anyone.\",\n          \"evidence\": \"contents scattered in puddles.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.85\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"On the dock, with contents in puddles.\",\n          \"reason\": \"The envelope was previously held and has now been dropped/discarded.\",\n          \"evidence\": \"contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "prompt": 961,
            "completion": 1849,
            "total": 5261,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 2451,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cost": 0.044201250000000004,
          "raw": {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"Soaked leather jacket, torn at the left sleeve.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"Soaked through, with dried blood on his knuckles.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"Hollow.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"None.\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"Soaked leather jacket, torn at the left sleeve.\",\n          \"reason\": \"Caught in the rain and involved in a physical altercation.\",\n          \"evidence\": \"soaked through. His leather jacket is torn at the left sleeve\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"Dried blood on his knuckles.\",\n          \"reason\": \"A new injury is visible, likely from an off-screen fight.\",\n          \"evidence\": \"dried blood visible on his knuckles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"Hollow.\",\n          \"reason\": \"Emotional state has worsened due to off-screen events.\",\n          \"evidence\": \"expression hollow.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"None.\",\n          \"reason\": \"The oar he was carrying is now broken and on the ground.\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 0.98\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"lighting\",\n          \"value\": \"Night.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"Night.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"Heavy rain.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"damage_or_changes\",\n          \"value\": \"Covered in puddles, with scattered papers.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"Bleak, somber.\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"Night.\",\n          \"reason\": \"Passage of time.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"Heavy rain.\",\n          \"reason\": \"The weather has changed.\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"Night.\",\n          \"reason\": \"Passage of time from day to night.\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Broken in two pieces.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"At Billy's feet.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Billy\",\n          \"confidence\": 0.9\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"Broken in two pieces.\",\n          \"reason\": \"The oar was damaged in an off-screen event.\",\n          \"evidence\": \"The OAR lies broken in two pieces\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"At Billy's feet.\",\n          \"reason\": \"The oar has been moved and dropped.\",\n          \"evidence\": \"at his feet.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Open, contents scattered and wet.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"On the dock, with contents in puddles.\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"ownership\",\n          \"value\": \"Abandoned.\",\n          \"confidence\": 0.8\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"Open, contents scattered.\",\n          \"reason\": \"The envelope has been opened and its contents discarded.\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"ownership\",\n          \"previous_value\": \"Jane → Billy (handed over)\",\n          \"new_value\": \"Abandoned.\",\n          \"reason\": \"The envelope and its contents are on the ground, not possessed by anyone.\",\n          \"evidence\": \"contents scattered in puddles.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.85\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": null,\n          \"new_value\": \"On the dock, with contents in puddles.\",\n          \"reason\": \"The envelope was previously held and has now been dropped/discarded.\",\n          \"evidence\": \"contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 0.95\n    }\n  ]\n}\n```"
                    }
                  ],
                  "role": "model"
                },
                "finishReason": "STOP",
                "index": 0
              }
            ],
            "usageMetadata": {
              "promptTokenCount": 961,
              "candidatesTokenCount": 1849,
              "totalTokenCount": 5261,
              "promptTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 961
                }
              ],
              "thoughtsTokenCount": 2451
            },
            "modelVersion": "gemini-2.5-pro",
            "responseId": "YhClae6_MbbCqtsPmu7HwQM"
          },
          "cached": false,
          "metadata": {}
        },
        "score": 0.9128000000000001,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      },
      {
        "cost": 0.04055,
        "gradingResult": {
          "pass": true,
          "score": 0.9128000000000001,
          "reason": "All assertions passed",
          "namedScores": {},
          "tokensUsed": {
            "total": 2547,
            "prompt": 2111,
            "completion": 436,
            "cached": 0,
            "numRequests": 0
          },
          "componentResults": [
            {
              "pass": true,
              "score": 0.9456,
              "reason": "change_detection=0.94 | confidence_calibration=1.00 | entity_coverage=1.00 | evidence_quality=1.00 | json_valid=0.90 | property_extraction=0.88 | JSON extracted from code block",
              "assertion": {
                "type": "python",
                "value": "file://../scorers/continuity_extraction_scorer.py"
              }
            },
            {
              "assertion": {
                "type": "llm-rubric",
                "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
              },
              "pass": true,
              "score": 0.88,
              "reason": "The output demonstrates strong continuity extraction across nearly all the key changes:\n\n1. **Jacket damage** (✅): Detected with evidence quote 'soaked through. His leather jacket is torn at the left sleeve', previous value 'leather jacket zipped against the wind'.\n2. **Blood on knuckles** (✅): Detected with evidence 'dried blood visible on his knuckles', previous value null.\n3. **Oar broken** (✅): Detected with evidence 'The OAR lies broken in two pieces', previous value 'intact, weathered oak with rope-wrapped grip'.\n4. **Envelope opened/scattered** (✅): Detected with evidence 'The ENVELOPE is open, contents scattered in puddles.', previous value 'sealed'.\n5. **Time change** (✅): Day → Night detected with evidence 'EXT. HARBOR DOCK - NIGHT'.\n6. **Weather change** (✅): Windy → Heavy rain detected with evidence 'Rain hammers the dock.'\n7. **Emotional state shift** (✅): Flat/resigned → Hollow detected with evidence 'expression hollow'.\n8. **Billy soaked** (✅): Captured within the costume property change.\n9. **Jane missing** (❌): Not detected. This is a notable omission — the absence of a previously present character is an important continuity point.\n\nAll change events are backed by actual evidence quotes that appear plausible. Previous values are correctly referenced (jacket zipped, oar intact with rope-wrapped grip, envelope sealed, etc.). The confidence scores are reasonable. The structure is well-organized with separate entity tracking.\n\nThe output catches 8 of 9 changes with accurate evidence. The only miss is Jane's absence. This is a very strong extraction.",
              "tokensUsed": {
                "total": 2547,
                "prompt": 2111,
                "completion": 436,
                "cached": 0,
                "numRequests": 0,
                "completionDetails": {
                  "reasoning": 0,
                  "acceptedPrediction": 0,
                  "rejectedPrediction": 0
                }
              },
              "metadata": {
                "renderedGradingPrompt": "[{\"role\":\"system\",\"content\":\"You are grading output according to a user-specified rubric. If the statement in the rubric is true, then the output passes the test. You respond with a JSON object with this structure: {reason: string, pass: boolean, score: number}\\n\\nExamples:\\n\\n<Output>Hello world</Output>\\n<Rubric>Content contains a greeting</Rubric>\\n{\\\"reason\\\": \\\"the content contains the word 'Hello'\\\", \\\"pass\\\": true, \\\"score\\\": 1.0}\\n\\n<Output>Avast ye swabs, repel the invaders!</Output>\\n<Rubric>Does not speak like a pirate</Rubric>\\n{\\\"reason\\\": \\\"'avast ye' is a common pirate term\\\", \\\"pass\\\": false, \\\"score\\\": 0.0}\"},{\"role\":\"user\",\"content\":\"<Output>\\n```json\\n{\\n  \\\"scene_id\\\": \\\"scene_003\\\",\\n  \\\"entity_states\\\": [\\n    {\\n      \\\"entity_key\\\": \\\"character:billy\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"costume\\\",\\n          \\\"value\\\": \\\"Leather jacket torn at left sleeve, soaked through\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"physical_condition\\\",\\n          \\\"value\\\": \\\"Dried blood on knuckles, soaked\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"emotional_state\\\",\\n          \\\"value\\\": \\\"Hollow\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"props_carried\\\",\\n          \\\"value\\\": \\\"None\\\",\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"costume\\\",\\n          \\\"previous_value\\\": \\\"leather jacket zipped against the wind\\\",\\n          \\\"new_value\\\": \\\"Leather jacket torn at left sleeve, soaked through\\\",\\n          \\\"reason\\\": \\\"Character has been involved in a struggle and exposed to rain\\\",\\n          \\\"evidence\\\": \\\"soaked through. His leather jacket is torn at the left sleeve\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"physical_condition\\\",\\n          \\\"previous_value\\\": null,\\n          \\\"new_value\\\": \\\"Dried blood on knuckles\\\",\\n          \\\"reason\\\": \\\"New injury visible\\\",\\n          \\\"evidence\\\": \\\"dried blood visible on his knuckles\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"emotional_state\\\",\\n          \\\"previous_value\\\": \\\"flat, resigned\\\",\\n          \\\"new_value\\\": \\\"Hollow\\\",\\n          \\\"reason\\\": \\\"Emotional shift following off-screen events\\\",\\n          \\\"evidence\\\": \\\"expression hollow\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"props_carried\\\",\\n          \\\"previous_value\\\": \\\"oar\\\",\\n          \\\"new_value\\\": \\\"None\\\",\\n          \\\"reason\\\": \\\"Item dropped/discarded\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces at his feet.\\\",\\n          \\\"is_explicit\\\": false,\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"location:harbor_dock\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"time_of_day\\\",\\n          \\\"value\\\": \\\"Night\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"weather\\\",\\n          \\\"value\\\": \\\"Heavy rain\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"lighting\\\",\\n          \\\"value\\\": \\\"Dark\\\",\\n          \\\"confidence\\\": 0.9\\n        },\\n        {\\n          \\\"key\\\": \\\"atmosphere\\\",\\n          \\\"value\\\": \\\"Dark, wet, ominous\\\",\\n          \\\"confidence\\\": 0.85\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"time_of_day\\\",\\n          \\\"previous_value\\\": \\\"day\\\",\\n          \\\"new_value\\\": \\\"Night\\\",\\n          \\\"reason\\\": \\\"Time progression\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"weather\\\",\\n          \\\"previous_value\\\": \\\"windy\\\",\\n          \\\"new_value\\\": \\\"Heavy rain\\\",\\n          \\\"reason\\\": \\\"Weather change\\\",\\n          \\\"evidence\\\": \\\"Rain hammers the dock.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"lighting\\\",\\n          \\\"previous_value\\\": \\\"daylight\\\",\\n          \\\"new_value\\\": \\\"Dark\\\",\\n          \\\"reason\\\": \\\"Time change to night\\\",\\n          \\\"evidence\\\": \\\"EXT. HARBOR DOCK - NIGHT ... dark water\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:oar\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"Broken in two pieces\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"Lying at Billy's feet\\\",\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"intact, weathered oak with rope-wrapped grip\\\",\\n          \\\"new_value\\\": \\\"Broken in two pieces\\\",\\n          \\\"reason\\\": \\\"Object destroyed\\\",\\n          \\\"evidence\\\": \\\"The OAR lies broken in two pieces\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"set against a piling\\\",\\n          \\\"new_value\\\": \\\"Lying at Billy's feet\\\",\\n          \\\"reason\\\": \\\"Object moved/dropped\\\",\\n          \\\"evidence\\\": \\\"lies broken in two pieces at his feet\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    },\\n    {\\n      \\\"entity_key\\\": \\\"prop:envelope\\\",\\n      \\\"properties\\\": [\\n        {\\n          \\\"key\\\": \\\"condition\\\",\\n          \\\"value\\\": \\\"Open, contents scattered\\\",\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"key\\\": \\\"position\\\",\\n          \\\"value\\\": \\\"In puddles on the dock\\\",\\n          \\\"confidence\\\": 0.95\\n        }\\n      ],\\n      \\\"change_events\\\": [\\n        {\\n          \\\"property_key\\\": \\\"condition\\\",\\n          \\\"previous_value\\\": \\\"sealed\\\",\\n          \\\"new_value\\\": \\\"Open, contents scattered\\\",\\n          \\\"reason\\\": \\\"Object opened and discarded\\\",\\n          \\\"evidence\\\": \\\"The ENVELOPE is open, contents scattered in puddles.\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        },\\n        {\\n          \\\"property_key\\\": \\\"position\\\",\\n          \\\"previous_value\\\": \\\"Billy (handed over)\\\",\\n          \\\"new_value\\\": \\\"In puddles on the dock\\\",\\n          \\\"reason\\\": \\\"Dropped/Discarded\\\",\\n          \\\"evidence\\\": \\\"contents scattered in puddles\\\",\\n          \\\"is_explicit\\\": true,\\n          \\\"confidence\\\": 1.0\\n        }\\n      ],\\n      \\\"confidence\\\": 1.0\\n    }\\n  ]\\n}\\n```\\n</Output>\\n<Rubric>\\nEvaluate the continuity extraction for a harbor dock NIGHT scene — the\\naftermath of something violent that happened between scenes.\\n\\nKey continuity changes from previous scene (day → night):\\n1. Billy's leather jacket is now TORN at the left sleeve\\n2. Billy has dried blood on his knuckles (new injury)\\n3. Billy's emotional state shifted from flat to hollow/defeated\\n4. Billy is soaked through (new physical state)\\n5. The OAR is now BROKEN in two pieces (was intact)\\n6. The ENVELOPE is open with contents scattered (was sealed)\\n7. JANE is gone (was present)\\n8. Weather changed from windy to heavy rain\\n9. Time changed from day to night\\n\\nCritical evaluation criteria:\\n1. Does it detect the jacket damage change event with evidence?\\n2. Does it detect the physical injury (blood on knuckles)?\\n3. Does it detect the oar being broken?\\n4. Does it detect the envelope being opened/scattered?\\n5. Does it note the time/weather changes for the location?\\n6. Are all change events backed by actual quotes from the scene?\\n7. Does it correctly reference previous values?\\n\\nThis is the harder test case. Score strictly: a strong model catches\\nat least 5 of the 9 changes with accurate evidence quotes.\\n\\n</Rubric>\"}]"
              }
            }
          ]
        },
        "id": "d46f102f-e215-4a6a-9671-9372c108f608",
        "latencyMs": 35817,
        "namedScores": {},
        "prompt": {
          "raw": "You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene 3: EXT. HARBOR DOCK - NIGHT\nScene ID: scene_003\n\n```\nEXT. HARBOR DOCK - NIGHT\n\nRain hammers the dock. BILLY sits on a coiled rope, soaked through.\nHis leather jacket is torn at the left sleeve — dried blood visible\non his knuckles. The OAR lies broken in two pieces at his feet.\n\nJANE is gone. The ENVELOPE is open, contents scattered in puddles.\n\nBILLY stares at the dark water, expression hollow.\n```\n\n## Entities Present\n\n### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: scene_003\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "label": "prompts/continuity-extraction.txt: You are a Script Supervisor analyzing continuity for a screenplay.\n\nYour job: read the scene text and for each entity present, extract\ntheir current observable state and detect changes from previous state.\n\n## Scene\nScene {{scene_number}}: {{scene_heading}}\nScene ID: {{scene_id}}\n\n```\n{{scene_text}}\n```\n\n## Entities Present\n\n{{entities_block}}\n\n## Instructions\n\nFor each entity, return a JSON object with:\n\n1. **properties** — only include properties observable or inferable from this scene. Each property needs:\n   - `key`: property name (e.g. \"costume\", \"emotional_state\")\n   - `value`: current value as a concise description\n   - `confidence`: 0.0-1.0 (1.0 = explicit in script, 0.5-0.8 = inferred, <0.5 = guessing)\n\n2. **change_events** — if a property differs from the previous state, record:\n   - `property_key`: which property changed\n   - `previous_value`: what it was before (null if first appearance)\n   - `new_value`: what it is now\n   - `reason`: why it changed (brief)\n   - `evidence`: exact quote from the scene text\n   - `is_explicit`: true if stated in script, false if inferred\n   - `confidence`: how certain you are about this change\n\n3. **confidence** — overall confidence in the accuracy of this entity's state extraction (0.0-1.0).\n\nImportant:\n- Only extract properties with evidence in this scene. Do not invent state.\n- If a property from the previous state is not mentioned, carry it forward unchanged (not a change event).\n- Use the exact entity_key values provided (e.g. \"character:billy\", \"location:harbor_dock\").\n- The scene_id in your response must be: {{scene_id}}\n\nReturn valid JSON in this exact format:\n{\n  \"scene_id\": \"{{scene_id}}\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\"key\": \"costume\", \"value\": \"...\", \"confidence\": 0.95}\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"...\",\n          \"new_value\": \"...\",\n          \"reason\": \"...\",\n          \"evidence\": \"exact quote from scene\",\n          \"is_explicit\": true,\n          \"confidence\": 0.9\n        }\n      ],\n      \"confidence\": 0.85\n    }\n  ]\n}",
          "config": {
            "provider": "anthropic:messages:claude-opus-4-6"
          }
        },
        "promptId": "0692b33e2b1edb7acef2dd4e19ad1bd5d8a11f5f02a357c0709906a1a15548f4",
        "promptIdx": 12,
        "provider": {
          "id": "google:gemini-3-pro-preview",
          "label": "Gemini 3 Pro"
        },
        "response": {
          "output": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"Leather jacket torn at left sleeve, soaked through\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"Dried blood on knuckles, soaked\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"Hollow\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"None\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"Leather jacket torn at left sleeve, soaked through\",\n          \"reason\": \"Character has been involved in a struggle and exposed to rain\",\n          \"evidence\": \"soaked through. His leather jacket is torn at the left sleeve\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"Dried blood on knuckles\",\n          \"reason\": \"New injury visible\",\n          \"evidence\": \"dried blood visible on his knuckles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"Hollow\",\n          \"reason\": \"Emotional shift following off-screen events\",\n          \"evidence\": \"expression hollow\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"None\",\n          \"reason\": \"Item dropped/discarded\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"Night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"Heavy rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"lighting\",\n          \"value\": \"Dark\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"Dark, wet, ominous\",\n          \"confidence\": 0.85\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"Night\",\n          \"reason\": \"Time progression\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"Heavy rain\",\n          \"reason\": \"Weather change\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"Dark\",\n          \"reason\": \"Time change to night\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT ... dark water\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"Lying at Billy's feet\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"Broken in two pieces\",\n          \"reason\": \"Object destroyed\",\n          \"evidence\": \"The OAR lies broken in two pieces\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"Lying at Billy's feet\",\n          \"reason\": \"Object moved/dropped\",\n          \"evidence\": \"lies broken in two pieces at his feet\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Open, contents scattered\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"In puddles on the dock\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"Open, contents scattered\",\n          \"reason\": \"Object opened and discarded\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"Billy (handed over)\",\n          \"new_value\": \"In puddles on the dock\",\n          \"reason\": \"Dropped/Discarded\",\n          \"evidence\": \"contents scattered in puddles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```",
          "tokenUsage": {
            "prompt": 961,
            "completion": 1597,
            "total": 4180,
            "numRequests": 1,
            "completionDetails": {
              "reasoning": 1622,
              "acceptedPrediction": 0,
              "rejectedPrediction": 0
            }
          },
          "cost": 0.04055,
          "raw": {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "```json\n{\n  \"scene_id\": \"scene_003\",\n  \"entity_states\": [\n    {\n      \"entity_key\": \"character:billy\",\n      \"properties\": [\n        {\n          \"key\": \"costume\",\n          \"value\": \"Leather jacket torn at left sleeve, soaked through\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"physical_condition\",\n          \"value\": \"Dried blood on knuckles, soaked\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"emotional_state\",\n          \"value\": \"Hollow\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"props_carried\",\n          \"value\": \"None\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"costume\",\n          \"previous_value\": \"leather jacket zipped against the wind\",\n          \"new_value\": \"Leather jacket torn at left sleeve, soaked through\",\n          \"reason\": \"Character has been involved in a struggle and exposed to rain\",\n          \"evidence\": \"soaked through. His leather jacket is torn at the left sleeve\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"physical_condition\",\n          \"previous_value\": null,\n          \"new_value\": \"Dried blood on knuckles\",\n          \"reason\": \"New injury visible\",\n          \"evidence\": \"dried blood visible on his knuckles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"emotional_state\",\n          \"previous_value\": \"flat, resigned\",\n          \"new_value\": \"Hollow\",\n          \"reason\": \"Emotional shift following off-screen events\",\n          \"evidence\": \"expression hollow\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"props_carried\",\n          \"previous_value\": \"oar\",\n          \"new_value\": \"None\",\n          \"reason\": \"Item dropped/discarded\",\n          \"evidence\": \"The OAR lies broken in two pieces at his feet.\",\n          \"is_explicit\": false,\n          \"confidence\": 0.95\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"location:harbor_dock\",\n      \"properties\": [\n        {\n          \"key\": \"time_of_day\",\n          \"value\": \"Night\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"weather\",\n          \"value\": \"Heavy rain\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"lighting\",\n          \"value\": \"Dark\",\n          \"confidence\": 0.9\n        },\n        {\n          \"key\": \"atmosphere\",\n          \"value\": \"Dark, wet, ominous\",\n          \"confidence\": 0.85\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"time_of_day\",\n          \"previous_value\": \"day\",\n          \"new_value\": \"Night\",\n          \"reason\": \"Time progression\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"weather\",\n          \"previous_value\": \"windy\",\n          \"new_value\": \"Heavy rain\",\n          \"reason\": \"Weather change\",\n          \"evidence\": \"Rain hammers the dock.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"lighting\",\n          \"previous_value\": \"daylight\",\n          \"new_value\": \"Dark\",\n          \"reason\": \"Time change to night\",\n          \"evidence\": \"EXT. HARBOR DOCK - NIGHT ... dark water\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:oar\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Broken in two pieces\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"Lying at Billy's feet\",\n          \"confidence\": 1.0\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"intact, weathered oak with rope-wrapped grip\",\n          \"new_value\": \"Broken in two pieces\",\n          \"reason\": \"Object destroyed\",\n          \"evidence\": \"The OAR lies broken in two pieces\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"set against a piling\",\n          \"new_value\": \"Lying at Billy's feet\",\n          \"reason\": \"Object moved/dropped\",\n          \"evidence\": \"lies broken in two pieces at his feet\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    },\n    {\n      \"entity_key\": \"prop:envelope\",\n      \"properties\": [\n        {\n          \"key\": \"condition\",\n          \"value\": \"Open, contents scattered\",\n          \"confidence\": 1.0\n        },\n        {\n          \"key\": \"position\",\n          \"value\": \"In puddles on the dock\",\n          \"confidence\": 0.95\n        }\n      ],\n      \"change_events\": [\n        {\n          \"property_key\": \"condition\",\n          \"previous_value\": \"sealed\",\n          \"new_value\": \"Open, contents scattered\",\n          \"reason\": \"Object opened and discarded\",\n          \"evidence\": \"The ENVELOPE is open, contents scattered in puddles.\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        },\n        {\n          \"property_key\": \"position\",\n          \"previous_value\": \"Billy (handed over)\",\n          \"new_value\": \"In puddles on the dock\",\n          \"reason\": \"Dropped/Discarded\",\n          \"evidence\": \"contents scattered in puddles\",\n          \"is_explicit\": true,\n          \"confidence\": 1.0\n        }\n      ],\n      \"confidence\": 1.0\n    }\n  ]\n}\n```",
                      "thoughtSignature": "Eq4wCqswAb4+9vuqFrqkmlL/bxBG8k+rUXX/SAsjYn/KOSiY6m6W2brpFmPnujkTI/h3kuMfgoryb4bedf0TlvbonPmM2vThAdclses3MDdTUfjKP9O4dWxt+6lEiVL9Ulub7BzzdcmNibj3wUdu4zRPf3rLuaf+FCUFeneKU6bHkljKxLx5hLNKbZFkmIYzWMTO1WtlmG8hdN4P4Zvom9HqPWd3BuLH+V1ByfstqtUxEEasv0/bo1b5sOuNpbpo+8OYAQ4ML1ifYAviRamoDThSwGJMhEbKMmutFz+oQhUkWTA7OpdWG53lj8o3bsHb+nouT6BhDNVYimfiualydEjSr+M20kw9vFZQcbj1bCv4/DLvsqeqa7G9E4GtOAapiIcEmAgoBlcSYj35oY9n+dTJoeNrYUzTLk99sfnFFVQUmoO4Fbh8V5sqy1ds9eY8pgqiL5t2CBLdXbpjxY9qUKmMghxSzAH8EkGaIwm7O4pdr0YbzULBypgXzVW7/M2Adi075rHZ/JjS0i0skktOGjJyhjkcr5aeb3ymbl4X+wPjHVZSuqefZKVxFHk+rmLqMOY6+1XacNU9mTYh/S+dpr0XIx/PHl+McrjNtelz/4G7L+i3RN8p9jfTHzsVzJucgLlxpXSqtcJeHOQjEQGU1SkbGW6WPV7SVYgFEVPECaejI1Ayr3x9s9X3sUq90yICQf/zHyjEZis2mTlAroXeAWaQKeUcUjuqR2A8K+39P4dxu8PXUOeBFASKwJCt6MsfLSBewxF3m5a3G0dWHfYYQqDEb8kAuKi9Pfq3p6xQqPYCwAN75uGoGxFm5mJIT5UYqg3E0VgA/vr8kwWMc7zQI0Oj/om4XnsLhztpWL1+vf3npMsk7CsXH+nygfj8ouW7/kx1lqNbkf13MRzpUif5GaYQdYHhiVvL2goRY5nWDvi4MoVpAbMv3oaVA5TBBMGyUf8JPO1eg0WbpzZAHqXG2qy/KwK85EPdw3N408XA4GXsI6v+ZnMMs0VOO5ZjHuZHL6sixFLp7SAQCoQQXMCrVN9MIUnqHTF0COEoIW7PVdObShzxhJiDYur4VEPI4UKNjY/EFdC/Hd137Pi4ytWR8TQXpemf8cBSAFehYWUqsbL3gnv8hi7HcysDMNfjdp71erSgCZ5PlV01bY14AzAUJB9dste/M+FLEqII89JROKnbDJD8ZGvpz6tcL38RMFwIQqnPdzF9zgiGk7r/kw8iq+KSoZ3sfKJVFo7l9DkTiLJU8Oi0H8ypymo1VORzDz1NhbWlB98jUMz5l5Tnm5IEJu3Am/KpfvI5BgrZu6mdnFXf5bSsbDEf8foThuTPQMTk13y4D2v0w+A/EukxrTwh538aNHmFCf2lAKtnEeQ+gBrxbNwI1cGlMGaq0K4DIuJaKbUJLPV29GYt+W1i/RoY11Sttd6jhrZeifR4RjRRU/Gz9a6vIrrgCsAbkFZPgcxNlNE6P12cy+4gjMsRC2nZ0jqTbec6Kn35VhEf7YixROg3JkIy6VUWzNLjSfn/SUPKpPbQJnakrE5EnT738gi/BQuMNXXDG+2gjkgf4+JW59wnSsYqJNkgRKWxNOaV0s+0mI1485qaPaj1zRcNntPLD4lUEZqs+UbrCgUIGOoK7kEaX7yYNFq820Cvpl0xhNPm8dUI7PBFI8XYqgZfgBYdcWSLtqf7GSgv+a219AbZgx6Nlvx0R3BsBHCH+lcGKr0ozwUMFeCfhiCrh0JgVaiQuztAuiqY3jP+cLFG4D0TWXcvT57CwRD21amAL/uVrsflG/5R/1KFMEhBWrcofxEg3eKY+QEbfnTv4LB5EDKqp1730vpWxCOKCccTmhpC1t9WH8DXBRmy50acQx+1GK+Vsx3A3cIFrRq0kJbx0Wa2zD+kNxvawBpaup9KtFfLeFJt91SWtxxMlP5aiCW/SlSDvMrYPO0XlE14H5Jm7hWEih3FNEaopEWOYo+lpKiNJpeq6QCDqvGw5o+a6c01Ag3SMreJwtlsR1HyG2YDZdn4xu+14wIMHDYbPtiNh32DJ7Hg8S+mFNEUM4qrYPsEbflXxBPlRDVokZzuxhlGzsrOQAzpKKAwr5KDrbXlWhqJCKzcE4CId4zDCLAvnmbcvd5P67da/hBg6Y8rPPjRJ72t7Vq/iGJZSawpARftrVWLxzVZZMHKN3ExH9d7TYL3d1M7VeWZQB5d8/NxQhZDSNFDqg+3VoMsLZXB+UIvGzr7xUq2acCVlzPJUX3h7AAXFJFJFSwybOoMp8S7b7cITJvBckTtmPNLmWvHF09APW68kDeWPgNRHn9n5S4utV2IW6tf/5IJbjzqLtW5LzrE9MAz0CRRnb2faIbnPWNf0F7k2vbskXlX87ifRQPhlMdXRp68LpbD5AD1rA8LcFZA3CY0S+XcOsiobz6TVPnbZd231YKaZJEX6Qo9fS+3vDTLWeyoZB8jZAW1bYOCrqDyjM7wxfyELGVa0l5Fm6FLtR1DzDXXv+00EW0xF9isLSB7pabkK5XSCvO6RYWUe0gomLFoaH83GuJewF4WP3JHAVVIcQZXEm8PJfbYdPMMZCFxVMjjqqnc5hsf5sNCuhjpUOIi1XC33+oBam2Ni9HSPCMcGuE7S6gMO16OzLretnoj0BSzouqXA6yjnq61GEIIeWbqYda2i727Nfqp97/rCennhaaw7rMB8mRWrV1iNQy2I8eBKlVz6Atw7XtTIaL/5EzSk/GIlb+XZ3+WCtT1smNbxMoZMgNsumc5HW1HArOjTNHUBSJcQEVDFUb30SxSKKOLcMZrpNDZFJPYjWp6BuxiohitI89UgFaV+vfYotDO0jHP8gfSg1dMQDn2uvJJ01MaI8q+Zgu8pDl3PLMo+k7w2RMkZKoqHK8V59mIkud6OEGDDWQ49gaGj77bgF6z5aR0/Jg2bsmU7m4wXOdc0sLb/muh+l4FgE/WTvJrvhisFqJh6AedS+WA9S+yMVQ6McqOwg8rrAokzZLA8q+pgUqOH+CVQU68jWy9abDPIEVtlr9Zx0/ftmNyB0c380xeI2C7Spri1eC7U4yOayksJEery6xqV5LyDupqsRZ7jQNrYg0+7a3su5fGnwCAO/cPFjSpoFkioilA/ZbmqD1Lgm2eyuF3S2NusWBhdm+iH9TxB9eBg2QnbzaC6MesWM/Karq4FlCC/Uw1CQTTqdqzLk9KcmEjjDe6YD3YfFI+hr2VRhwbbWjekTW8JLD26DHulyzdwVOUf1RxCXjsqFp/cht9LLvyWTRts6hv1W7I5K+eDp874f4LRQo+0TjHfLPrkw9hOSAF/O/BZRIVVcNk4/fZuUP3heX8pw9GNLgXhVq15iOs1kppbmzAvCIhq2dbDpzgRs0zdGal2Z5iqwt8kkWoJ993rZuQ3uQBbtdwKMPdc43LRocWJqf3fh3wWJkva9mZVWIyQdEL8M9WKotukYfXzxhnB4NeIx+QSRT087ePPDyqBOfmHqYKgxKJYPYZ1DdJ3aPnCUDuS/xtsgdmBxLnxa2ubHuRnRpx2PCH8H29NRg8UyU9wFLMy2XX7A4TysbpR2Okk5+XNFTPSuxyMyxZydtU/Anp3xTUi/ulC12hDE2OKK8LdToz/1c/d/xxN4x6zBA08+azRW7Q1s5gVu7bCpeWanugaKWaOqv1lu9vi4fdBa9uQyja2mB1AxmZL26WicL27JKFIlD8yzU8Zx7k6oG6xNm43dTNDZ+K1YAj6JM6z4hNbIzDscWAD8ypVn8L4tvYiOMtY/2Fxel1gQ86eu93s8plyx5mTPwYjZsUszG1Nl+is3tp7M2vM4s40yl07TJ1CC9NVEeoRHjeJlFWEQnLuQUz4/m4M5iqXJc9CRtIn4JBGOxrtthLlTlNxGS3ukATqSNRinkOvprX9AO+r+eaCJFJsEmvcUKeKdqZ6GdIJeJuehY9V+43ITJEYBKOA8s8HwNcYvtW5XUPZdPcUy8F32TACGbZg8JCe0djPJOjSPUFb/vu8s4fWmm38/MrK8qa4CZ6fA8r2J7C2iVfhsZvNU/vzAvSPUzkBSgSJxwNAeDOS+EAIcU3QRSub4MI+ClrcI2csVnRnIfkrphc/ibcFrG5AWgROnrhy+yruBVbn8ibA6BB0oQLOlv+ZhXRzOFFG/mnvLl5Q3r0k5lGbJWUMeC46QnmOKPorJsVt1hx0OcY/H1azEacyH7nm8sHa6IJwHlQSbvUhDAY/CDKb8NKyA6QemEcxzwL6vvaZF7U7ePIWzGsd8AB3pf5Zko/AJopXLda8mnATgaKpxMoyGrl5fwer8fM2VZ3ol9r9BnHpgHu6ZmvB25T9M3dWpdAVUdHPNbVFovtN+pVD33i7LT6fRa0bSmmTbVLerkI17R3x+pJrgd9qRY5QCCz2AdTqUWMSZDn19UwZl6vF9jdf+dim7TmsEaFY5Ma4JcmX7esYH6VDbcqDngGhvhKO3x46DPtdpcAz31taco8pTEzwohxXbre9vELVz019Yxy2PsGWGl6bsvzCj1IOS0XUxlUqLE5ZuUsRh/5IVnbk9ZQYWfXpFzW7RsWEq4zMAmS4HsFw9f1o3C9FsxptVu3E4JmcLzI6WmOQQSxgsKTx26dubXUl/D1erDU3po21O3kUStFItqWRuvYkRgY+T9zgIrgcg097s8kfhOayRkRUk+iX0e2Os/FNKbYlaG2kl/WNo8nKCkOiu3l9BBvXZSx/nBW6Z/azCeDiHPtudtTOqQbyNhA/PMMiqKPVXJNi2kgzbkxBMoIhrQ4G+KnQSYm87qZsnTXG5b5jjKUSGwC1C/n/4y10bdWR/OHOhsbpB+INpp59I1EVHa+k209Z+MrTIcAsIQK6aCL6NIp1msTdiRNx3OCpRBC8vrEzZ2+aqSZZ01avyrBPujh/5zR7OQOVT2AetQF8uQtQwFIBlYegrXVz2YOkaTUDJFeQvrMLfmv2Hg7zpcIZcbMSt18hJ8UdS3vmZVck6reMgrSNWm5Tl2TWH3L7kQ+2oZDu3r7eGgfRX8bBv0M1w1hRzfoz0Ovcj4SlmogxQlrFDS5oCo+ROPvjEd61Sf/If6NWaziz04P8DJcOzN4KmFPDVOP034/KWL+SEs+j0qM2lYZ1eyfF0X+7ZtllJ2VrqADEpBDHO7ogr1sA9T7oyeye+C+cXoE2yEupI/ou+fAmPYmI+bqDbfJkVIUw5gIzZWdGrrnSqgicmm/4wq3lAWOeV0+WDsXPSW6iLeSTAaV/wAZ0S3zvJ+sVu9BG1Z0dgZ7pSyLFXL5k9FYRLSMmyumucnUqqtfZpF1aP7s06RlchCDicqI+BMkABqrgH5jLS66gCc/byaOY6uZTg5XOX2OdYNXMsxZN8ue8J+IB5RglxE68GEa0LanbsX8rR2zKCzmRb/wDE4/Mx0ckLIce5LU53v5EGNPACXk63ViUAW6ht4YVxK4nE9RDjdqHlNEc/KM+Q8Lzrtei9J83tKlNDcpH1/EjxqjM7rWchcu5l+iHwWHlBLAQip2p9vfBIdA8GAys5rVgmTiEuPQ7nnwC27VorsrD4vG3i/A9WKnPJVOxo53B/cQGc5LqhNORJS5uAzOGEQuOGQ/+pl+pTV26HciuXRd0wEHiGlA7nXrC8WXDgdHomke4yvVH3Z3Srq8BEpP0YFEgN15GVhcOlK2tOdVbwn4X4uNPElEunbuN/d0FdLfpSS75FVMYqAd2ukdMULCOCBZdJ/yjmlRoGYarh7VwETtAJo2waZpwV+SgtXOeaNUmdY/9YOvoOwkYe2Nc4fWdlsPh16A3mauLjMR2y0Zav3vDaAWmSDB0dyCGpPbE4oneTOTuAtfkt9EkR59CZdGGpf7WUqErboY6bVxjDmnxYyte4orRbCNbFq+cE3kcyRM455UwwOHznuD55SgnZItNyy29kQxTiM/ZHHXlNtHS2vlIiM05t8R+6v4FCxPzPvdeMHvzPnRLfyLX7n8dDCzyW7SiPTWXKFG8gREjNEnnKmzkGnORWveycZ536TIaCQDhcUiO5c/o2mohoFSlFRwl8IdtDWvfdmtPDKzHDDOZwWN6MMjcbe034qCOozFA2eYNn975l384kSNKEFNwFEc0oGQik/MWX/rKJQg14KW7Oy2SUaN5ligltRrK4eGTKJtOypomD0Udi6TY6HeKXlAj5BJL14XcwmqlC1q4YIRndTDn6W50HERxx2wQO2mqYv0eKigMKkuqmqHr6Do3IoSYhhetkF7u5Nau3/2c1vag/9AOe2Tg+TuImR3oDM54Q6q3gBnhD/t3w8qg6hwwreMt95hNAIEUq7xu6zt6DHi5FzLsGeazPlvxHMAfRDkO+Cxxmfez4qcbf58BPz7Bnj4M5ryJkBcMeMaO1ytl56bRzQNoVLBQfohlCsV07NlomUccOmEcaD2HksJZKt/xma2gOHmsttnd5QFp7wHd7bYcBjvZeAQEx49tBMwMGouRhgjV6HnQepUONHlOOAOt1uwTXmf49HwEdZua65At9hW1B4Nnopj0Eohdvm3h9w/Q8OkKf7FXFnbsdYI5qcAMCa7qoldXrFIQmYyJb+j7PAaEBvKLNsIOQMvPczaqNcz9yEoBuJXl8eoUD7VPjJG1vQwr1XushaLW4uW6AfbHnJYsDvenfyukjG5SBx6SXU07bRwZWv0gE70cto0/B0BkS0ksLh/8Ka/ojdYhX0A99DKuBXPsYlDIK1Kstrpbj/bZoSDPyEGFhKu67EY7Cs/6kmDo/TVw0b9JCNCttNFyisIPJ/Es5/9tSXVe7Zcxj+pLup4+mOoilHNGRo1urKlx61J8a/lFwgd33KWIxKcLuDNpCiZD8P5qd9634nJGI+fxwMl+xHgzgm7GORZhZwtVMarqQyXOpdzPjVpdRgfji71GBEc/iN/1cUiIwBUFXDtHGWMRLWU2C/+v5E4k0WYsMmp7sVTmKScneTGpHMq+LWfeB7PvCdOTjoadCcV81kvfm8b1TWU1d118LqFUT5ZDLfD5MBUm/Qjk4oBXD9nv1MRJiVi19rHBx1JPV/3r6wY57IFf8Eg4HJaOJ974BxmZdpMbfLtkfucYSq9blQ+F96iuOfLOQfgZiemmqcrAqYh/OvxsnhzPeFw4FX5JXkLvRNrgcWgA0OYK5sInAt1xQXhZhuzbInGEcqnAHD7wd62kvL6LPQ+ghd6Tnndb+P8l0YVQUxWBiSYLNszCjF4qluNTfYeMvQRVKCK0DeU1zHN1qidcv69/TzmQIk3EWHFj411iq0iqU5S7qM5mwOFdnL2jQU0idtuBNGD133tOHgauie0FlLSK9bGLkqYBmT1fx8Kg6CWqVyqbmbT+E8cWwzDzwUYJYYArVWolQAgIakYuyDccTIFQfZeKWs+8aBw+L08I41+jDedmSEMryRfzZPs4Skcjp4BmLllzJfKlODbyW7Z3e7U5VADsf3Sj6KJKuPqQxjn6Y+PiaLFy52iZyrMmAWdPsqCGVByfgj64uKDrDJdsOipDkIh4tkL203j7g8/CpAevT00yiQQCuK81W+5QpFs6YUBVILV3JUbOldMz1pWE3GvesLTq0ziBgsojKxLPLRZ1UJjTwgoRU497At4atjzlDEkEse9ZzJB+tqELCKWkxgj2iB1tvA5+mA8buWyTuwM6ok+Gkgjmh8xHqVbjRoUlVs8PIF3xiRMiQY78nCJcwHq0KrBFdiZFWBYxvdMHWMCbmJKrDzcjs5CuvYV9eho687yVajxO7+11ySItcpMRRXnVYTppBe7fl5GY9Zm33cImZWzrLnmhvDvOHXm4jIjLzvacLUEu0IIGbRIRV0572sTYNz3CMedi5wG2Hh5cx3HuknVZCjwuNIsv9a4+k6c597oZrQl9aiTQR9dzotDhvMr8xrXVqY7lEGAR36P/aHiqQMGQamY1KE9go6PmsQ8K5URG8QpFFTJh8d71u2xQkkDXN+YE6jQ/JWbwNy212s2OweQlvtX8e0nvnQDz7vAyyiMQ1T/PD/rB3j4DTHb/v9XII8yUDcCKXcreLqT9vBct0tQDAZvvpFTHCvqXHjubnSfvH9i3W4wsq4TOTpAlpA7dHl+duNS9sMpqLhxNpsp5VuoR3wCapYWHbOoeZoSOr5zfJwuux1qB71BcQbDA1IHUMcLjAIncBJyGyg0RbKVp8FRl8UGzWWnUrmyv3LUCUn816jlPu4bn55YnkPy0jARPlr54+gK+nK9CRmVXVLS6811IEqexjgAp+bexe80mVsR+v2czWkRt0VpUSIgJ3OSxNCmTYU/Zg=="
                    }
                  ],
                  "role": "model"
                },
                "finishReason": "STOP",
                "index": 0
              }
            ],
            "usageMetadata": {
              "promptTokenCount": 961,
              "candidatesTokenCount": 1597,
              "totalTokenCount": 4180,
              "promptTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 961
                }
              ],
              "thoughtsTokenCount": 1622
            },
            "modelVersion": "gemini-3-pro-preview",
            "responseId": "ahClad6tC9CwqtsPobKTgAM"
          },
          "cached": false,
          "metadata": {}
        },
        "score": 0.9128000000000001,
        "success": true,
        "testCase": {
          "vars": {
            "scene_text": "file://../input/continuity-scene-dock-night.txt",
            "scene_heading": "EXT. HARBOR DOCK - NIGHT",
            "scene_number": "3",
            "scene_id": "scene_003",
            "golden_path": "golden/continuity-extraction-golden.json",
            "scene_key": "dock_night",
            "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
          },
          "assert": [
            {
              "type": "python",
              "value": "file://../scorers/continuity_extraction_scorer.py"
            },
            {
              "type": "llm-rubric",
              "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
            }
          ],
          "options": {
            "provider": "anthropic:messages:claude-opus-4-6"
          },
          "metadata": {}
        },
        "testIdx": 1,
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "metadata": {
          "_promptfooFileMetadata": {}
        },
        "failureReason": 0
      }
    ],
    "stats": {
      "successes": 26,
      "failures": 0,
      "errors": 0,
      "tokenUsage": {
        "prompt": 24780,
        "completion": 43218,
        "cached": 0,
        "total": 84408,
        "numRequests": 26,
        "completionDetails": {
          "reasoning": 16410,
          "acceptedPrediction": 0,
          "rejectedPrediction": 0
        },
        "assertions": {
          "total": 65178,
          "prompt": 51965,
          "completion": 13213,
          "cached": 0,
          "numRequests": 0,
          "completionDetails": {
            "reasoning": 0,
            "acceptedPrediction": 0,
            "rejectedPrediction": 0
          }
        }
      },
      "durationMs": 268663
    }
  },
  "config": {
    "tags": {},
    "description": "Continuity extraction — entity state tracking and change detection",
    "prompts": [
      "file:///Users/cam/Documents/Projects/cine-forge/benchmarks/prompts/continuity-extraction.txt"
    ],
    "providers": [
      {
        "id": "openai:gpt-4.1-nano",
        "label": "GPT-4.1 Nano",
        "config": {
          "temperature": 0,
          "max_tokens": 4096,
          "response_format": {
            "type": "json_object"
          }
        }
      },
      {
        "id": "openai:gpt-4.1-mini",
        "label": "GPT-4.1 Mini",
        "config": {
          "temperature": 0,
          "max_tokens": 4096,
          "response_format": {
            "type": "json_object"
          }
        }
      },
      {
        "id": "google:gemini-2.5-flash-lite",
        "label": "Gemini 2.5 Flash Lite",
        "config": {
          "temperature": 0,
          "maxOutputTokens": 16384
        }
      },
      {
        "id": "openai:gpt-4.1",
        "label": "GPT-4.1",
        "config": {
          "temperature": 0,
          "max_tokens": 4096,
          "response_format": {
            "type": "json_object"
          }
        }
      },
      {
        "id": "anthropic:messages:claude-haiku-4-5-20251001",
        "label": "Claude Haiku 4.5",
        "config": {
          "temperature": 0,
          "max_tokens": 4096
        }
      },
      {
        "id": "anthropic:messages:claude-sonnet-4-5-20250929",
        "label": "Claude Sonnet 4.5",
        "config": {
          "temperature": 0,
          "max_tokens": 4096
        }
      },
      {
        "id": "anthropic:messages:claude-sonnet-4-6",
        "label": "Claude Sonnet 4.6",
        "config": {
          "temperature": 0,
          "max_tokens": 4096
        }
      },
      {
        "id": "google:gemini-2.5-flash",
        "label": "Gemini 2.5 Flash",
        "config": {
          "temperature": 0,
          "maxOutputTokens": 16384
        }
      },
      {
        "id": "google:gemini-3-flash-preview",
        "label": "Gemini 3 Flash",
        "config": {
          "temperature": 0,
          "maxOutputTokens": 16384
        }
      },
      {
        "id": "openai:gpt-5.2",
        "label": "GPT-5.2",
        "config": {
          "temperature": 0,
          "max_tokens": 4096,
          "response_format": {
            "type": "json_object"
          }
        }
      },
      {
        "id": "anthropic:messages:claude-opus-4-6",
        "label": "Claude Opus 4.6",
        "config": {
          "temperature": 0,
          "max_tokens": 4096
        }
      },
      {
        "id": "google:gemini-2.5-pro",
        "label": "Gemini 2.5 Pro",
        "config": {
          "temperature": 0,
          "maxOutputTokens": 16384
        }
      },
      {
        "id": "google:gemini-3-pro-preview",
        "label": "Gemini 3 Pro",
        "config": {
          "temperature": 0,
          "maxOutputTokens": 16384
        }
      }
    ],
    "tests": [
      {
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-day.txt",
          "scene_heading": "EXT. HARBOR DOCK - DAY",
          "scene_number": "2",
          "scene_id": "scene_002",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_day",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: faded flannel shirt and worn jeans\n  - emotional_state: tense, jaw tight\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Character: JANE (key: character:jane)\nPrevious state:\n  (First appearance — no previous state)\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  (First appearance — no previous state)\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  (First appearance — no previous state)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "assert": [
          {
            "type": "python",
            "value": "file://../scorers/continuity_extraction_scorer.py"
          },
          {
            "type": "llm-rubric",
            "value": "Evaluate the continuity extraction for a harbor dock daytime scene.\n\nBILLY arrives at a dock wearing a leather jacket (changed from flannel\nshirt in previous scene). He carries his father's weathered oak OAR.\nHe meets JANE (30s, rain jacket) who holds a sealed ENVELOPE. BILLY's\ntone is flat and resigned.\n\nCritical evaluation criteria:\n1. Does it identify all 5 entities (Billy, Jane, dock, oar, envelope)?\n2. Does it correctly extract Billy's costume as leather jacket?\n3. Does it detect Billy's costume CHANGE from flannel shirt to leather jacket?\n4. Does it note Jane's rain jacket and the sealed envelope?\n5. Does it capture Billy's flat/resigned emotional state?\n6. Are change events supported by actual scene text quotes as evidence?\n7. Are confidence scores reasonable (high for explicit text, lower for inferred)?\n\nScore strictly: good continuity extraction catches state changes with\nevidence, not just current state descriptions.\n"
          }
        ]
      },
      {
        "vars": {
          "scene_text": "file://../input/continuity-scene-dock-night.txt",
          "scene_heading": "EXT. HARBOR DOCK - NIGHT",
          "scene_number": "3",
          "scene_id": "scene_003",
          "golden_path": "golden/continuity-extraction-golden.json",
          "scene_key": "dock_night",
          "entities_block": "### Character: BILLY (key: character:billy)\nPrevious state:\n  - costume: leather jacket zipped against the wind\n  - emotional_state: flat, resigned\n  - props_carried: oar\nExtract: costume/wardrobe, physical_condition (injuries, visible changes), emotional_state, props_carried (items they have)\n\n### Location: HARBOR DOCK (key: location:harbor_dock)\nPrevious state:\n  - time_of_day: day\n  - weather: windy\n  - lighting: daylight\nExtract: lighting, time_of_day, weather, damage_or_changes, atmosphere (mood of the space)\n\n### Prop: OAR (key: prop:oar)\nPrevious state:\n  - condition: intact, weathered oak with rope-wrapped grip\n  - position: set against a piling\n  - ownership: Billy\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n\n### Prop: ENVELOPE (key: prop:envelope)\nPrevious state:\n  - condition: sealed\n  - ownership: Jane → Billy (handed over)\nExtract: condition (intact/damaged/destroyed), position (where it is), ownership (who has it)\n"
        },
        "assert": [
          {
            "type": "python",
            "value": "file://../scorers/continuity_extraction_scorer.py"
          },
          {
            "type": "llm-rubric",
            "value": "Evaluate the continuity extraction for a harbor dock NIGHT scene — the\naftermath of something violent that happened between scenes.\n\nKey continuity changes from previous scene (day → night):\n1. Billy's leather jacket is now TORN at the left sleeve\n2. Billy has dried blood on his knuckles (new injury)\n3. Billy's emotional state shifted from flat to hollow/defeated\n4. Billy is soaked through (new physical state)\n5. The OAR is now BROKEN in two pieces (was intact)\n6. The ENVELOPE is open with contents scattered (was sealed)\n7. JANE is gone (was present)\n8. Weather changed from windy to heavy rain\n9. Time changed from day to night\n\nCritical evaluation criteria:\n1. Does it detect the jacket damage change event with evidence?\n2. Does it detect the physical injury (blood on knuckles)?\n3. Does it detect the oar being broken?\n4. Does it detect the envelope being opened/scattered?\n5. Does it note the time/weather changes for the location?\n6. Are all change events backed by actual quotes from the scene?\n7. Does it correctly reference previous values?\n\nThis is the harder test case. Score strictly: a strong model catches\nat least 5 of the 9 changes with accurate evidence quotes.\n"
          }
        ]
      }
    ],
    "scenarios": [],
    "env": {},
    "defaultTest": {
      "options": {
        "provider": "anthropic:messages:claude-opus-4-6"
      },
      "vars": {},
      "assert": [],
      "metadata": {}
    },
    "outputPath": [
      "results/continuity-extraction-post-golden-verify.json"
    ],
    "extensions": [],
    "metadata": {},
    "evaluateOptions": {}
  },
  "shareableUrl": null,
  "metadata": {
    "promptfooVersion": "0.120.24",
    "nodeVersion": "v24.13.1",
    "platform": "darwin",
    "arch": "arm64",
    "exportedAt": "2026-03-02T04:22:12.638Z",
    "evaluationCreatedAt": "2026-03-02T04:17:41.974Z"
  }
}