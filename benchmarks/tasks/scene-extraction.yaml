# Scene Extraction Benchmark
# Evaluates models on extracting structured scene data from a screenplay.
#
# Usage: cd benchmarks && promptfoo eval -c tasks/scene-extraction.yaml
# View:  promptfoo view

description: "Scene extraction from screenplay — The Mariner"

# Use Opus as judge — strongest reasoning, cross-provider for OpenAI models
defaultTest:
  options:
    provider: anthropic:messages:claude-opus-4-6

prompts:
  - file://../prompts/scene-extraction.txt

providers:
  # --- Cheap tier ---
  - id: openai:gpt-4.1-nano
    label: "GPT-4.1 Nano"
    config:
      temperature: 0
      max_tokens: 8192
      response_format: { type: "json_object" }

  - id: openai:gpt-4.1-mini
    label: "GPT-4.1 Mini"
    config:
      temperature: 0
      max_tokens: 8192
      response_format: { type: "json_object" }

  # --- Mid tier ---
  - id: openai:gpt-4.1
    label: "GPT-4.1"
    config:
      temperature: 0
      max_tokens: 8192
      response_format: { type: "json_object" }

  - id: anthropic:messages:claude-haiku-4-5-20251001
    label: "Claude Haiku 4.5"
    config:
      temperature: 0
      max_tokens: 8192

  - id: anthropic:messages:claude-sonnet-4-5-20250929
    label: "Claude Sonnet 4.5"
    config:
      temperature: 0
      max_tokens: 8192

  # --- SOTA tier ---
  - id: openai:gpt-5.2
    label: "GPT-5.2"
    config:
      temperature: 0
      max_tokens: 8192
      response_format: { type: "json_object" }

  - id: anthropic:messages:claude-opus-4-6
    label: "Claude Opus 4.6"
    config:
      temperature: 0
      max_tokens: 8192

tests:
  - vars:
      screenplay: file://../input/the-mariner.md
      golden_path: golden/the-mariner-scenes.json
    assert:
      # Code-based scorer: structural quality
      - type: python
        value: file://../scorers/scene_extraction_scorer.py
      # AI judge: semantic quality of summaries and character identification
      - type: llm-rubric
        value: |
          Evaluate the scene extraction output for the screenplay "The Mariner."

          The screenplay has approximately 13-15 scenes including embedded flashbacks.
          Key quality criteria:
          1. Are all scenes identified, including embedded flashbacks (BEGIN FLASHBACK / END FLASHBACK)?
          2. Are scene headings accurate and complete?
          3. Are INT/EXT designations correct?
          4. Are character names correctly identified for each scene (including O.S. characters)?
          5. Are summaries meaningful — capturing the key action, not just restating the heading?
          6. Is the time_of_day correct (NIGHT for present-day scenes, DAY for flashbacks)?
          7. Are the flashback scenes properly distinguished from present-day scenes?

          Score strictly: partial credit for close but imperfect extraction.
